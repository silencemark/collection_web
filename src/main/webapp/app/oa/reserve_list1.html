<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>备用金申请</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" >
<link type="text/css" rel="stylesheet" href="../appcssjs/style/public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/page_public.css">
<script type="text/javascript" src="../appcssjs/script/jquery-1.10.2.min.js"></script>
<link rel="stylesheet" href="../appcssjs/sweetalert/dist/sweetalert.css">
<script src="../appcssjs/sweetalert/dist/sweetalert-dev.js"></script>  
<script type="text/javascript" src="../appcssjs/script/tab.js"></script>
<script type="text/javascript" src="../appcssjs/script/page.js"></script>

<script type="text/javascript" src="../appcssjs/script/appendjs.js"></script>
<script type="text/javascript" src="../appcssjs/script/appbase.js"></script>
<script type="text/javascript" src="../appcssjs/script/cache.js"></script>
<script type="text/javascript" src="../appcssjs/script/constant.js"></script>
<link href="../appcssjs/style/mobiscroll.custom-2.6.2.min.css" type="text/css" rel="stylesheet"> 
<script src="../appcssjs/script/mobiscroll.custom-2.6.2.min.js"></script> 
</head>
<script type="text/javascript">
var nodata = '<div class="list_none"><span><i class="yellow">Hello,我是大狮！</i><br>还没有申请备用金呢，赶紧添加一条吧~</span><b><img src="'+notDataImageUrl_havepower+'"></b></div>';
var userInfo;
JianKangCache.getGlobalData('userinfo',function(data){
		userInfo=data;
})
var stime="";
var etime="";
function onloadData(starttime,endtime){
	stime=starttime;
	etime=endtime;
	$.ajax({
		type:'post',
		dataType:'json',
		url:projectpath+'/app/getReserveAmountByDate?userid='+userInfo.userid+'&status=1&companyid='+userInfo.companyid+'&starttime='+starttime+'&endtime='+endtime,
		success:function(data){
			if(data.status==1){
				swal({
					title : "",
					text : data.message,
					type : "error",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					
				});
			}else{
				$('#starttime').val(data.map.starttime);
				$('#endtime').val(data.map.endtime);
				
				if(data.list.length > 0){
					$(".list_none").remove();
					var temp="";
					for(var i=0;i<data.list.length;i++){
						temp+="<div class=\"time_name\" id=\""+data.list[i].createtime+"_div\"><span>"+data.list[i].createtime+"<i>"+data.list[i].orderlist.length+"</i><em>点</em></span>"
						if(i==0){
							temp+="<b class=\"up\"  onclick=\"changeisshow(this)\">隐藏</b></div><ul id=\""+data.list[i].createtime+"_ul\">"
						}else{
							temp+="<b class=\"down\" onclick=\"changeisshow(this)\">展开</b></div><ul id=\""+data.list[i].createtime+"_ul\" style=\"display:none\">";
						}
						for(var j=0;j<data.list[i].orderlist.length;j++){
							if(userInfo.userid==data.list[i].orderlist[j].examineuserid && data.list[i].orderlist[j].status==0){
								temp+="<li class=\"li_del\" style=\"height:127px;\" onclick=\"location.href=\'reserve_check.html?reserveamountid="+data.list[i].orderlist[j].reserveamountid+"&createid="+data.list[i].orderlist[j].forwarduserid+"\'\">";
							}else{
								temp+="<li class=\"li_del\" style=\"height:127px;\" onclick=\"location.href=\'reserve_detail.html?reserveamountid="+data.list[i].orderlist[j].reserveamountid+"&createid="+data.list[i].orderlist[j].forwarduserid+"\'\">";
							}
							temp += '<div class="li_box" id="'+data.list[i].orderlist[j].forwarduserid+'_libox">';
							if(data.list[i].orderlist[j].isread==0){
								temp+="<div class=\"xx_01\"><span class=\"new\">";
							}else{
								temp+="<div class=\"xx_01\"><span>";
							}
							var result = data.list[i].orderlist[j].result;
							var resulthtml = "";
							if(result == 1){
								resulthtml = '<em class="green">同意</em>';
							}else{
								resulthtml = '<em class="red">拒绝</em>';
							}
							temp+=data.list[i].orderlist[j].createname+"的备用金申请</span>"+resulthtml+"</div>"+
				            "<div class=\"txt\" style=\"overflow:hidden;text-overflow:ellipsis;\"><nobr>"+data.list[i].orderlist[j].reason+"</nobr></div>";
				            temp += '</div>'+
				            '<a class="del_btn" style="width:0px;" onclick="deleteForwardUserInfo(this)" id="'+data.list[i].orderlist[j].forwarduserid+'_delbtn">删除</a>'+
				        	'<div class="clear"></div>';
				            if(data.list[i].orderlist[j].urgentlevel==1){
				            	temp+="<div class=\"xx_02\" style=\"padding:0px 15px;\"><span class=\"num w_green\">普通</span>";
				            }else if(data.list[i].orderlist[j].urgentlevel==2){
				            	temp+="<div class=\"xx_02\" style=\"padding:0px 15px;\"><span class=\"num w_yellow\">紧急</span>";
				            }else if(data.list[i].orderlist[j].urgentlevel==3){
				            	temp+="<div class=\"xx_02\" style=\"padding:0px 15px;\"><span class=\"num w_red\">非常紧急</span>";
				            }
				            temp+="<span class=\"w_yellow\">￥"+data.list[i].orderlist[j].amount+"</span><i>"+data.list[i].orderlist[j].createtime+"</i></div></li>";
						}
						temp+="</ul>";
					}
					$('#orderdiv').html(temp);
				}else{
					$('#orderdiv').html("");
					$('#orderdiv').nextAll().remove();
					$(".list_none").remove();
					$("body").append(nodata);
				}
			}
		}
	})
	if(typeof(userInfo.powerMap.power5001810) != "undefined"){
		$('#linkadd').show();
	}
}
PageHelper({
	url:projectpath+'/app/getReserveAmountByDate?userid='+userInfo.userid+'&status=1&companyid='+userInfo.companyid+'&starttime='+stime+'&endtime='+etime,
	success:function(data){
		if(data.list.length > 0){
			var temp="";
			for(var i=0;i<data.list.length;i++){
				temp+="<div class=\"time_name\" id=\""+data.list[i].createtime+"_div\"><span>"+data.list[i].createtime+"<i>"+data.list[i].orderlist.length+"</i><em>点</em></span>"
				if(i==0){
					temp+="<b class=\"up\"  onclick=\"changeisshow(this)\">隐藏</b></div><ul id=\""+data.list[i].createtime+"_ul\">"
				}else{
					temp+="<b class=\"down\" onclick=\"changeisshow(this)\">展开</b></div><ul id=\""+data.list[i].createtime+"_ul\" style=\"display:none\">";
				}
				for(var j=0;j<data.list[i].orderlist.length;j++){
					if(userInfo.userid==data.list[i].orderlist[j].examineuserid && data.list[i].orderlist[j].status==0){
						temp+="<li class=\"li_del\" style=\"height:127px;\" onclick=\"location.href=\'reserve_check.html?reserveamountid="+data.list[i].orderlist[j].reserveamountid+"&createid="+data.list[i].orderlist[j].forwarduserid+"\'\">";
					}else{
						temp+="<li class=\"li_del\" style=\"height:127px;\" onclick=\"location.href=\'reserve_detail.html?reserveamountid="+data.list[i].orderlist[j].reserveamountid+"&createid="+data.list[i].orderlist[j].forwarduserid+"\'\">";
					}
					temp += '<div class="li_box" id="'+data.list[i].orderlist[j].forwarduserid+'_libox">';
					if(data.list[i].orderlist[j].isread==0){
						temp+="<div class=\"xx_01\"><span class=\"new\">";
					}else{
						temp+="<div class=\"xx_01\"><span>";
					}
					var result = data.list[i].orderlist[j].result;
					var resulthtml = "";
					if(result == 1){
						resulthtml = '<em class="green">同意</em>';
					}else{
						resulthtml = '<em class="red">拒绝</em>';
					}
					temp+=data.list[i].orderlist[j].createname+"的备用金申请</span>"+resulthtml+"</div>"+
		            "<div class=\"txt\" style=\"overflow:hidden;text-overflow:ellipsis;\"><nobr>"+data.list[i].orderlist[j].reason+"</nobr></div>";
		            temp += '</div>'+
		            '<a class="del_btn" style="width:0px;" onclick="deleteForwardUserInfo(this)" id="'+data.list[i].orderlist[j].forwarduserid+'_delbtn">删除</a>'+
		        	'<div class="clear"></div>';
		            if(data.list[i].orderlist[j].urgentlevel==1){
		            	temp+="<div class=\"xx_02\" style=\"padding:0px 15px;\"><span class=\"num w_green\">普通</span>";
		            }else if(data.list[i].orderlist[j].urgentlevel==2){
		            	temp+="<div class=\"xx_02\" style=\"padding:0px 15px;\"><span class=\"num w_yellow\">紧急</span>";
		            }else if(data.list[i].orderlist[j].urgentlevel==3){
		            	temp+="<div class=\"xx_02\" style=\"padding:0px 15px;\"><span class=\"num w_red\">非常紧急</span>";
		            }
		            temp+="<span class=\"w_yellow\">￥"+data.list[i].orderlist[j].amount+"</span><i>"+data.list[i].orderlist[j].createtime+"</i></div></li>";
				}
				temp+="</ul>";
			}
			$('#orderdiv').append(temp);
		}
	}
});  
function changeisshow(obj){
	if($(obj).attr("class")=="up"){
		$(obj).parent().next().hide();
		$(obj).text("展开");
		$(obj).attr("class","down");
	}else{
		$(obj).parent().next().show();
		$(obj).text("隐藏");
		$(obj).attr("class","up");
	}
}

$(function(){
	var currYear = (new Date()).getFullYear();	
	var opt={};
	opt.date = {preset : 'date', dateFormat: 'yy-mm-dd' };
	//opt.datetime = { preset : 'datetime', minDate: new Date(2012,3,10,9,22), maxDate: new Date(2014,7,30,15,44), stepMinute: 5  };
	opt.datetime = {preset : 'date', dateFormat: 'yy-mm-dd' }; 
	opt.time = {preset : 'time'};
	opt.default = { 
		theme: 'android-ics light', //皮肤样式  
        display: 'modal', //显示方式  
        mode: 'scroller', //日期选择模式
        dateOrder : 'yymmdd',  
		lang:'zh',
        startYear:currYear - 10, //开始年份
        endYear:currYear + 10 //结束年份
	};
	$('input[name="starttime"]').scroller('destroy').scroller($.extend(opt['datetime'], opt['default']));
	$('input[name="endtime"]').scroller('destroy').scroller($.extend(opt['datetime'], opt['default'])); 
})

function getNotIsRead(param){
	$.ajax({
		url:projectpath+"/app/getReserveAmountAllNotRead",
		type:"post",
		data:param,
		success:function(data){
			if(data.status == 0 || data.status == '0'){
				var noexamiennum = data.noexaminenum;
				var examinenum = data.examinenum;
				if(noexamiennum > 0){
					$('.span_nav span:first').prepend(redPoint);
				}
				if(examinenum > 0){
					$('.span_nav span:last').prepend(redPoint);
				}
			}
		}
	});
}

function initPage(){
	var param = new Object();
	param.userid = userInfo.userid;
	param.companyid = userInfo.companyid;
	getNotIsRead(param);
}
</script>
<body onload="onloadData('','');initPage();">
<div class="head_box">
	<a class="ico_back" onclick="location.href='index.html'">返回</a>
    <div class="name">备用金申请</div>
    <div class="link_yellow" onclick="location.href='reserve_add.html'" id="linkadd" >新建</div>
</div>
<div class="head_none"></div>
<div class="span_nav">
	<span onclick="location.href='reserve_list0.html'">待处理</span>
    <span class="last active"  onclick="location.href='reserve_list1.html'">已处理</span>
</div>
<div class="top_sel">
	<div class="time"><input type="text" class="t_time" value="2016-06-13"  readonly="readonly" name="starttime" readonly="readonly" id="starttime" ></div>
    <div class="span">-</div>
    <div class="time"><input type="text" class="t_time" value="2016-06-13"  readonly="readonly" name="endtime" readonly="readonly" id="endtime" ></div>
    <div class="span">&nbsp;</div>
    <div class="btn"><input type="button" value="" onclick="onsubmitdata()"></div>
</div>
<div class="page_list" id="orderdiv">
<!-- 	<div class="time_name"><span>2016-06-16<i>4</i><em>点</em></span><b class="down">隐藏</b></div>
	<ul>
    	<li>
        	<div class="xx_01"><span class="new">李婵的备用金申请</span><em class="green">已处理</em></div>
            <div class="txt">这是一个备用金申请这是一个备用金申请这是一个备用金申请这是一个备用金申请......</div>
            <div class="xx_02"><span class="num w_green">普通</span><span class="w_yellow">￥1,000.00</span><i>2015-06-16 12:30</i></div>
        </li>
        <li>
        	<div class="xx_01"><span>李婵的备用金申请</span><em class="green">已处理</em></div>
            <div class="txt">这是一个备用金申请这是一个备用金申请这是一个备用金申请这是一个备用金申请......</div>
            <div class="xx_02"><span class="num w_green">普通</span><span class="w_yellow">￥1,000.00</span><i>2015-06-16 12:30</i></div>
        </li>
        <li>
        	<div class="xx_01"><span>李婵的备用金申请</span><em class="green">已处理</em></div>
            <div class="txt">这是一个备用金申请这是一个备用金申请这是一个备用金申请这是一个备用金申请......</div>
            <div class="xx_02"><span class="num w_green">普通</span><span class="w_yellow">￥1,000.00</span><i>2015-06-16 12:30</i></div>
        </li>
        <li>
        	<div class="xx_01"><span>李婵的备用金申请</span><em class="green">已处理</em></div>
            <div class="txt">这是一个备用金申请这是一个备用金申请这是一个备用金申请这是一个备用金申请......</div>
            <div class="xx_02"><span class="num w_green">普通</span><span class="w_yellow">￥1,000.00</span><i>2015-06-16 12:30</i></div>
        </li>
    </ul>
    <div class="time_name"><span>2016-06-16<i>4</i><em>点</em></span><b class="up">隐藏</b></div>
    <div class="time_name"><span>2016-06-16<i>4</i><em>点</em></span><b class="up">隐藏</b></div>
    <div class="time_name"><span>2016-06-16<i>4</i><em>点</em></span><b class="up">隐藏</b></div> -->
</div>
<!-- <div class="load_more"><a>加载中...</a></div> -->
<script type="text/javascript">
function onsubmitdata(){
	var starttime=$('#starttime').val();
	var endtime=$('#endtime').val();
	$('#load_more').remove();
	onloadData(starttime,endtime);
}
</script>
</body>
</html>
