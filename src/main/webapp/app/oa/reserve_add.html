<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>新建备用金申请</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" >
<link type="text/css" rel="stylesheet" href="../appcssjs/style/public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/page_public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/oa.css">
<script type="text/javascript" src="../appcssjs/script/jquery-1.10.2.min.js"></script>
<link rel="stylesheet" href="../appcssjs/sweetalert/dist/sweetalert.css">
<script src="../appcssjs/sweetalert/dist/sweetalert-dev.js"></script>  
<script type="text/javascript" src="../appcssjs/script/tab.js"></script>
<script type="text/javascript" src="../appcssjs/script/page.js"></script>

<script type="text/javascript" src="../appcssjs/script/appendjs.js"></script>
<script type="text/javascript" src="../appcssjs/script/appbase.js"></script>
<script type="text/javascript" src="../appcssjs/script/cache.js"></script>
<script type="text/javascript" src="../appcssjs/script/constant.js"></script>
<link href="../appcssjs/style/mobiscroll.custom-2.6.2.min.css" type="text/css" rel="stylesheet"> 
<script src="../appcssjs/script/mobiscroll.custom-2.6.2.min.js"></script> 
</head>
<script type="text/javascript">
var userInfo;
JianKangCache.getGlobalData('userinfo',function(data){
		userInfo=data;
})
function submitdata(){
	var reason=$("#reason").val();
	var amount=$('#amount').val();
	var usetime=$('#usetime').val();
	var returntime=$('#returntime').val();
	if(reason==""){
		swal({
			title : "",
			text : "请填写申请事由",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			$('#reason').focus();
		});
		return;
	}
	if(amount==""){
		swal({
			title : "",
			text : "请填写申请金额",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			$('#amount').focus();
		});
		return;
	}
	if(usetime==""){
		swal({
			title : "",
			text : "请选择使用时间",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			$('#usetime').click();
		});
		return;
	}
	if(returntime==""){
		swal({
			title : "",
			text : "请选择归还时间",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			$('#returntime').click();
		});
		return;
	}
	if($('#examineuserid').val()==""){
		swal({
			title : "",
			text : "请选择审批人",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			
		});
		return;
	}
	
// 	?userid='+userInfo.userid+'&status=0&companyid='+userInfo.companyid
	/* 'companyid='+userInfo.companyid+'&reason='+reason+'&urgentlevel='+$('#urgentlevel').val()+'&amount='+amount+'&usetime='+
	usetime+'&returntime='+returntime+'&remark='+$('#remark').val()+'&examineuserid='+$('#examineuserid').val()+'&createid='+userInfo.userid */
	var param = new Object();
	param.companyid = userInfo.companyid;
	param.reason = reason;
	param.urgentlevel = $('#urgentlevel').val();
	param.amount = amount;
	param.usetime = usetime;
	param.returntime = returntime;
	param.remark = $('#remark').val();
	param.examineuserid = $('#examineuserid').val();
	param.createid = userInfo.userid;
	
	param.userid = userInfo.userid;
	param.status = 0;
	
	param.userlist = $("#userlist").val();
	param.CCusernames = $('#releaserange').text();
	
	$.ajax({
		type:'post',
		beforeSend:function(a,b){
			ajaxbefore();
		},
		complete:function(a,b){
			ajaxcomplete();
		},
		dataType:'json',
		url:projectpath+'/app/insertReserveAmount',
		data:param,
		success:function(data){
			if(data.status==1){
				swal({
					title : "",
					text : data.message,
					type : "error",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					
				});
			}else{
				swal({
					title : "",
					text : "添加成功",
					type : "success",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					location.href="reserve_list0.html";
				});
			}
		}
	})
}
function checklevel(obj,level){
	$(obj).parent().parent().find("a").attr("class","check");
	$(obj).attr("class","check_ed");
	$('#urgentlevel').val(level);
}
$(function(){
	var currYear = (new Date()).getFullYear();	
	var opt={};
	opt.date = {preset : 'date', dateFormat: 'yy-mm-dd' };
	//opt.datetime = { preset : 'datetime', minDate: new Date(2012,3,10,9,22), maxDate: new Date(2014,7,30,15,44), stepMinute: 5  };
	opt.datetime = {preset : 'date', dateFormat: 'yy-mm-dd' }; 
	opt.time = {preset : 'time'};
	opt.default = { 
		theme: 'android-ics light', //皮肤样式  
        display: 'modal', //显示方式  
        mode: 'scroller', //日期选择模式
        dateOrder : 'yymmdd',  
		lang:'zh',
        startYear:currYear - 10, //开始年份
        endYear:currYear + 10 //结束年份
	};
	$('#returntime').scroller('destroy').scroller($.extend(opt['datetime'], opt['default']));
	$('#usetime').scroller('destroy').scroller($.extend(opt['datetime'], opt['default'])); 
})	
</script>
<body>
<div id="htmlbody">
<div class="head_box">
	<a class="ico_back" onclick="location.href='reserve_list0.html'">返回</a>
    <div class="name">新建备用金申请</div>
    <div class="link_yellow" onclick="submitdata()">发送</div>
</div>
<div class="head_none"></div>
<div class="detail_box">
	<ul>
        <li>
        	<span class="em">事由</span>
            <div class="clear"></div>
            <p><textarea class="text_area" placeholder="请输入事由，最多允许输入800字符" maxlength="800" id="reason"></textarea></p>
        </li> 
        <li>
        	<input type="hidden" id="urgentlevel" value="1"/>
        	<span class="em">紧急程度</span>
            <div class="jjcd green"><a class="check_ed" onclick="checklevel(this,1)">选择</a><span>普通</span></div>
            <div class="jjcd yellow"><a class="check" onclick="checklevel(this,2)">选择</a><span>紧急</span></div>
            <div class="jjcd red"><a class="check" onclick="checklevel(this,3)">选择</a><span>非常紧急</span></div>
            <div class="clear"></div>
        </li>
        <li><span>申请金额</span><input type="number" class="text" placeholder="请输入金额" id="amount" oninput="this.value=this.value.replace(/\D/g,'');"></li>
        <li><span>使用日期</span><input type="text" class="text" placeholder="请输入日期" id="usetime"></li>
        <li><span>归还日期</span><input type="text" class="text" placeholder=	"请输入日期" id="returntime"></li>
        <li>
        	<span class="em">备注</span>
            <div class="clear"></div>
            <p><textarea class="text_area" placeholder="请输入备注，最多允许输入800字符" maxlength="800"id="remark"></textarea></p>
        </li>
    </ul>
</div>
<div class="xx_adduser">
	<ul>
		<input type="hidden" id="examineuserid">
    	<li><span>审&nbsp;批&nbsp;人：</span><i id="examinename"></i><a onclick="$('#organizeiframe').show();$('#htmlbody').hide();"><img src="../appcssjs/images/public/btn_add.png"></a></li>
        <li><span>抄&nbsp;送&nbsp;人：</span><i id="releaserange" style="text-overflow:ellipsis ; overflow:hidden; white-space:nowrap; max-width: 59%;"></i><a onclick="$('#morechange_organizeiframe').show();$('#htmlbody').hide();"><img src="../appcssjs/images/public/btn_add.png"></a></li>
        <li><span>申&nbsp;请&nbsp;人：</span><i id="createname"></i></li>
        <li><span>填写时间：</span><i id="createtime"></i></li>
    </ul>
</div>
<script type="text/javascript">
$(document).ready(function(){
	$("#createtime").text(getNowTime());
	$("#createname").text(userInfo.realname);
	$('#createname').attr("onclick","location.href='../member/homepage_info.html?userid="+userInfo.userid+"'");
})
</script>
</div>
<script type="text/javascript" src="../appcssjs/script/selectuser.js"></script>
<script type="text/javascript" src="../appcssjs/script/select_xiebanren.js"></script>
</body>
</html>
