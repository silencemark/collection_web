<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>简报</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" >
<link type="text/css" rel="stylesheet" href="../appcssjs/style/public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/page_public.css">
<script type="text/javascript" src="../appcssjs/script/jquery-1.10.2.min.js"></script>
<link rel="stylesheet" href="../appcssjs/sweetalert/dist/sweetalert.css">
<script src="../appcssjs/sweetalert/dist/sweetalert-dev.js"></script>  
<script type="text/javascript" src="../appcssjs/script/tab.js"></script>
<script type="text/javascript" src="../appcssjs/script/page.js"></script>

<script type="text/javascript" src="../appcssjs/script/appendjs.js"></script>
<script type="text/javascript" src="../appcssjs/script/cache.js"></script>
<script type="text/javascript" src="../appcssjs/script/constant.js"></script>
</head>
<script type="text/javascript">
var moduleid=getUrlParam("moduleid");


var nodata = '<div class="list_none"><span><i class="yellow">Hi,我是大狮！</i><br>列表空空，还没有简报呢~</span><b><img src="'+notDataImageUrl_nopower+'"></b></div>';
var userInfo;
JianKangCache.getGlobalData('userinfo',function(data){
		userInfo=data;
	}
)
var title="";
function getnotice(){
	title=$('#title').val();
	$.ajax({
		type:'post',
		dataType:'json',
		url:projectpath+'/app/getBriefList',
		data:'title='+title+'&userid='+userInfo.userid+'&companyid='+userInfo.companyid+"&moduleid="+moduleid,
		success:function(data){
			if(data.briefList.length>0){
				$(".list_none").remove();
				var temp="";
				for(var i=0;i<data.briefList.length;i++){
					temp+="<li onclick=\"location.href='briefing_detail.html?briefid="+data.briefList[i].briefid+"&moduleid="+moduleid+"'\"><div class=\"xx_01\"><span style=\"text-overflow:ellipsis ; overflow:hidden; white-space:nowrap; width:300px;\">"+data.briefList[i].title+"</span>";
			        if(data.briefList[i].isread==0){
			        	temp+="<em class=\"red\">未查看</em>";
			        }
					temp+="</div><div class=\"xx_02\"><i class=\"fzr\">2015-06-16 12:30</i></div></li>";
				}
				$('#ullist').parent().nextAll().remove();
				$('#ullist').html(temp);
				$(".list_none").remove();
			}else{
				$('#ullist').html("");
				$('#ullist').parent().nextAll().remove();
				$(".list_none").remove();
				$("body").append(nodata);
			}
		}
	})
}

PageHelper({
	url:projectpath+'/app/getBriefList',
	data:'title='+title+'&userid='+userInfo.userid+'&companyid='+userInfo.companyid+"&moduleid="+moduleid,
	success:function(data){
		if(data.briefList.length>0){
			var temp="";
			for(var i=0;i<data.briefList.length;i++){
				temp+="<li onclick=\"location.href='briefing_detail.html?briefid="+data.briefList[i].briefid+"&moduleid="+moduleid+"'\"><div class=\"xx_01\"><span style=\"text-overflow:ellipsis ; overflow:hidden; white-space:nowrap; width:300px;\">"+data.briefList[i].title+"</span>";
		        if(data.briefList[i].isread==0){
		        	temp+="<em class=\"red\">未查看</em>";
		        }
				temp+="</div><div class=\"xx_02\"><i class=\"fzr\">2015-06-16 12:30</i></div></li>";
			}
			$('#ullist').append(temp);
		}
	}
}); 
function initaddbrief(){
	location.href='briefing_add.html?moduleid='+moduleid;
}

$(function(){
	if(typeof(userInfo.powerMap.power5001110) != "undefined"){
		$('#linkadd').show();
		nodata = '<div class="list_none"><span><i class="yellow">Hello,我是大狮！</i><br>还没有简报，赶紧添加一条吧~</span><b><img src="'+notDataImageUrl_havepower+'"></b></div>';
	}
});
</script>
<body onload="getnotice()">
<div class="head_box">
	<a class="ico_back" onclick="location.href='briefing_index.html'">返回</a>
    <div class="name">简报</div>
    <div class="link_yellow" onclick="initaddbrief()" id="linkadd" style="display: none;">新建</div>
</div>
<div class="head_none"></div>
<div class="top_sel">
	<div class="long"><input type="text" class="t_text" placeholder="请输入关键字" id="title"></div>
    <div class="span">&nbsp;</div>
    <div class="btn"><input type="button" value="" onclick="getnotice()"></div>
</div>
<div class="page_list" style="display: none;">
	<ul id="ullist">
    </ul>
</div>

</body>
</html>
