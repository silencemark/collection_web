<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>系统设置</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" >
<link type="text/css" rel="stylesheet" href="../appcssjs/style/public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/page_public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/member.css">
<script type="text/javascript" src="../appcssjs/script/jquery-1.10.2.min.js"></script>
<link rel="stylesheet" href="../appcssjs/sweetalert/dist/sweetalert.css">
<script src="../appcssjs/sweetalert/dist/sweetalert-dev.js"></script>  
<script type="text/javascript" src="../appcssjs/script/tab.js"></script>
<script type="text/javascript" src="../appcssjs/script/page.js"></script>

<script type="text/javascript" src="../appcssjs/script/appendjs.js"></script>
<script type="text/javascript" src="../appcssjs/script/cache.js"></script>
<script type="text/javascript" src="../appcssjs/script/constant.js"></script>
</head>
<script type="text/javascript">
var  num = 1,
	 str = 0,
	 size;
JianKangCache.getGlobalData('userinfo',function(data){
	userInfo=data;
	for ( var i in localStorage) {// 用javascript的for/in循环遍历对象的属性
		if (localStorage.hasOwnProperty(i)) {
			if(i!="userinfo"){
					str +=localStorage[i].length;
			}
		}
	}
	var app_cache = localStorage.APP_CACHE;
	if(app_cache){
		str -= JSON.stringify(app_cache).length;
	}
	str -= JSON.stringify(userInfo).length; 
	var  GB = 1024 * 1024 * 1024;//定义GB的计算常量
	var  MB = 1024 * 1024;//定义MB的计算常量
	var  KB = 1024;//定义KB的计算常量

	if (str / GB >= 1)//如果当前Byte的值大于等于1GB
	{
		num = 1;
	 	this.size = (str /GB).toFixed(2) + "GB";//将其转换成GB
	}else if (str / MB >= 1)//如果当前Byte的值大于等于1MB
	{
		num = 1;
		this.size = (str / MB).toFixed(2) + "MB";//将其转换成MB
	}else if (str / KB >= 1)//如果当前Byte的值大于等于1KB
	{
		num = 1;
		this.size = (str / KB).toFixed(2) + "KB";//将其转换成KB
	}else{
		num = 0;
	}
	
})

function onloadload(){
	if(isiOS){
		$("#jiancebanben_li").remove();
	}
	var companylist;
	JianKangCache.getGlobalData('companylist',function(data){
		companylist=data;
	})
	if(companylist==null || companylist==undefined || companylist.length<=1){
		$("#changetext").css({
			"color":"gray"
		});
		$("#changecompany").removeAttr("onclick");
	}
}

$(function(){
	if(num == 1){
		$("#cache").html("("+size+")");
	}else{
		$("#cache").html("(0KB)");
	} 
})


function changecompany(){
	
	location.href="../login/login_choice.html";
}

function checkout(){
	try{
		cordova.exec(function(data){
			alert("success:"+JSON.stringify(data));
		},function(data){
			alert("error:"+JSON.stringify(data));
		},"GetHtmlResource","GetHtmlResource",[])
	}catch(e){
		alert(e);
	}
		JianKangCache.getGlobalData('userinfo',function(data){
		if(num == 1){
			$("#cache").html("(0KB)");
			num = 0;
			var app_cache = localStorage.APP_CACHE; 
			localStorage.clear();
			localStorage.APP_CACHE = app_cache;
			JianKangCache.setGlobalData("userinfo",data);
			swal({
				title : "",
				text :"清除成功,清除"+size,
				type : "success",
				showCancelButton : false,
				confirmButtonColor : "#ff7922",
				confirmButtonText : "确认",
				cancelButtonText : "取消",
				closeOnConfirm : true
			}, function(){
			
			});
		}else{
			localStorage.clear();
			JianKangCache.setGlobalData("userinfo",data);
			swal({
				title : "",
				text :"暂无缓存",
				type : "success",
				showCancelButton : false,
				confirmButtonColor : "#ff7922",
				confirmButtonText : "确认",
				cancelButtonText : "取消",
				closeOnConfirm : true
			}, function(){
			
			});
		}
	});
}


function checkPersonal(){
	JianKangCache.setGlobalData('userid',userInfo.userid);
	location.href='user_info.html';
}

</script>

<body onload="onloadload()">
<div class="head_box">
	<a class="ico_back"  onclick="goBackPage()">返回</a>
    <div class="name">系统设置</div>
</div>
<div class="head_none"></div>
<div class="sys_set">
	<ul>
   	   <a href="#" onclick="checkPersonal()"><li><span>个人资料</span><i>链级</i></li></a>
   	   <a href="system_password.html"><li><span>修改密码</span><i>链级</i></li></a>
   	   <a href="system_changetel.html"><li><span>更换手机号码</span><i>链级</i></li></a>
   	   <a href="javascript:void(0);" onclick="changecompany();" id="changecompany"><li><span id="changetext">切换餐厅/餐饮公司</span><i>链级</i></li></a>
   	   <a onclick="checkout()"><li><span>清除缓存</span><span id="cache"></span><i>链级</i></li></a>
   	   <a href="system_suggestion.html"><li><span>意见反馈</span><i>链级</i></li></a>
   	   <a href="system_about.html"><li><span>关于餐饮大师</span><i>链级</i></li></a>
		<li id="jiancebanben_li"><span>检测版本</span><i>链级</i></li>
    </ul>
</div>

<div class="out_box"><a href="javascript:void(0)" onclick="tuichu()">退出登录</a></div>
<script type="text/javascript">
function tuichu(){
	JianKangCache.delGlobalData('userinfo');
	location.href='../login/login.html';
}
</script>
</body>
</html>
