<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>个人页</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" >
<link type="text/css" rel="stylesheet" href="../appcssjs/style/public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/page_public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/member.css">
<script type="text/javascript" src="../appcssjs/script/jquery-1.10.2.min.js"></script>
<link rel="stylesheet" href="../appcssjs/sweetalert/dist/sweetalert.css">
<script src="../appcssjs/sweetalert/dist/sweetalert-dev.js"></script>  
<script type="text/javascript" src="../appcssjs/script/tab.js"></script>
<script type="text/javascript" src="../appcssjs/script/page.js"></script>

<script type="text/javascript" src="../appcssjs/script/appendjs.js"></script>
<script type="text/javascript" src="../appcssjs/script/cache.js"></script>
<script type="text/javascript" src="../appcssjs/script/constant.js"></script>
</head>
<script type="text/javascript">
var userInfo;
JianKangCache.getGlobalData('userinfo',function(data){
		userInfo=data;
})

//接收传过来的userid
var userid=getUrlParam("userid");
// var userid=userInfo.userid;
//判断传过来的userid是否有权限编辑
function onloadData(){
	if(userid != userInfo.userid){
		$('#sendmessage').show();
	}
	
	//是否自己
	if(userid == userInfo.userid){
		$("#edit").show();
		
	}else if(userInfo.managerole == 3){
		$("#edit").show();
	}else if(userInfo.managerole == 2){
		var param = new Object();
		param.resourceid = userInfo.userid;
		param.userid = userid;
		$.ajax({
			type:'post',
			dataType:'json',
			url:projectpath+'/app/getPersonalByUserId',
			data:param,
			success:function(data){
				if(data.status==1){
					swal({
						title : "",
						text : data.message,
						type : "error",
						showCancelButton : false,
						confirmButtonColor : "#ff7922",
						confirmButtonText : "确认",
						cancelButtonText : "取消",
						closeOnConfirm : true
					}, function(){
					
					});
				}else{
					if(data != null){
						if(data.releOrganIdList.length > 0){
							for(var i= 0 ; i< data.releOrganIdList.length;i++){
								if(data.userOrganIdLsit.length > 0){
									for(var j=0 ;j > data.userOrganIdLsit.length;i++){
										var releOrganId = data.releOrganIdList[i].organizeid;
										var userorganId = data.userOrganIdLsit[j].organizeid;
										if(releOrganId == userorganId){
											$("#edit").show();
										}
									}
								}
								
							}//releOrganIdList
							
						}
					}
					
					
					
				}
			}
		})
	}
}
$.ajax({
	type:'post',
	dataType:'json',
	url:projectpath+'/app/getUserIndexPage?userid='+userid,
	success:function(data){
		if(data.status==1){
			swal({
				title : "",
				text : data.message,
				type : "error",
				showCancelButton : false,
				confirmButtonColor : "#ff7922",
				confirmButtonText : "确认",
				cancelButtonText : "取消",
				closeOnConfirm : true
			}, function(){
			
			});
		}else{
			if(data.dataMap.userMap != null ){
				var sex = data.dataMap.userMap.sex;
				
				if(sex==0){
					 $(".i_men").removeClass("i_men");
				}
				$('#realname').html(data.dataMap.userMap.realname);		
				$('#position').html((data.dataMap.userMap.position==undefined?"":"("+data.dataMap.userMap.position+")"));
				$('#organizename').html(data.dataMap.userMap.organizename);
				if(data.dataMap.userMap.isshowphone==1){
					$('#phone').html(data.dataMap.userMap.phone);
					$('#phoneimg').attr("onclick","$('#phonea').click();")
				}else{
					var phone = data.dataMap.userMap.phone;
					$('#phone').html(phone.substring(0,3)+"****"+phone.substring(7,11));
				}
			
				$('#phonea').attr("href","tel:"+data.dataMap.userMap.phone);
				$('#email').html(data.dataMap.userMap.email);
				$('#headimage').attr("src",projectpath+data.dataMap.userMap.headimage);
			}
			
			
		}
	}
})

function linkuser(){
	JianKangCache.setGlobalData('userid',userid);
	location.href="user_info.html";
}
function sendmessage(){
	//创建单聊
	$.ajax({
		type:"post",
		dataType:"json",
		url:projectpath+"/app/createOneGroup",
		data:"userid="+userid+"&createid="+userInfo.userid,
		success:function(data){
			//进入聊天会话窗口
			location.href="talk.html?isGroud=2&groupId="+data.groupId;
		}
	})
}

function intosharepage(){
	var realname = $('#realname').text();
	var param = new Object();
	param.userid = userid;
	param.realname = realname;
	JianKangCache.setGlobalData("someoneshareuserinfo",param);
	location.href="../share/someone_index.html";
}
</script>
<body onload="onloadData()">
<div class="head_box">
	<a class="ico_back" onclick="goBackPage()">返回</a>
    <div class="link_yellow" onclick="linkuser()"  id="edit" style="display: none;">编辑</div>
</div>
<div class="head_none"></div>
<div class="homepage_top">
	<div class="user_img"><img src="" id="headimage"></div>
    <div class="name"><span id="realname"></span><i class="i_men i_women"></i></div>
</div>
<div class="homepage_xx">
	<ul>
    	<li><span>部门</span><i><span id="organizename">浦东</span><span id="position"></span></i></li>
        <li><span>电话</span><em><img src="../appcssjs/images/public/ico_tel2.png" id="phoneimg" /></em><i><span id="phone"></span><a id="phonea" style="display:none;"></a></i></li>
        <li><span>邮箱</span><i><span id="email"></span> </i></li>
    </ul>
</div>
<div class="fbtn_none"></div>
<div class="foot_btn">
	<span class="active" onclick="intosharepage();">分享圈</span>
    <span id="sendmessage" style="display:none;" onclick="sendmessage();">发消息</span>
</div>
</body>
</html>
