<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>系统公告</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" >
<link type="text/css" rel="stylesheet" href="../appcssjs//style/public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs//style/page_public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs//style/member.css">
<script type="text/javascript" src="../appcssjs/script/jquery-1.10.2.min.js"></script>
<link rel="stylesheet" href="../appcssjs/sweetalert/dist/sweetalert.css">
<script src="../appcssjs/sweetalert/dist/sweetalert-dev.js"></script>  
<script type="text/javascript" src="../appcssjs/script/tab.js"></script>
<script type="text/javascript" src="../appcssjs/script/page.js"></script>

<script type="text/javascript" src="../appcssjs/script/appendjs.js"></script>
<script type="text/javascript" src="../appcssjs/script/cache.js"></script>
<script type="text/javascript" src="../appcssjs/script/constant.js"></script>
</head>
<script type="text/javascript">
var userInfo;
var userid="";
JianKangCache.getGlobalData('userinfo',function(data){
		userInfo=data;
})
this.userid = userInfo.userid;
$.ajax({
	type:'post',
	dataType:'json',
	url:projectpath+'/app/getSystemMessageListByUser?userid='+userid,
	success:function(data){
		if(data.status==1){
			swal({
				title : "",
				text : data.message,
				type : "error",
				showCancelButton : false,
				confirmButtonColor : "#ff7922",
				confirmButtonText : "确认",
				cancelButtonText : "取消",
				closeOnConfirm : true
			}, function(){
			
			});
		}else{
			if(data.dataList.length > 0){
				var temp = "";
				for(var i=0;i<data.dataList.length;i++){
					var createtime = data.dataList[i].createtime;
					var title =data.dataList[i].title;
					var messageid = data.dataList[i].messageid;
					if(data.dataList[i].status==0){
						temp += "<li>"+
				        	"<div class='xx_01'><span>"+createtime+"</span><em class='red'>未查看</em></div>"+
				            "<div class='txt' onclick=\"checkUpdate('"+messageid+"')\"><span>"+title+"</span></div></li>"
					}else{
						temp += "<li>"+
			        	"<div class='xx_01'><span>"+createtime+"</span></div>"+
			            "<div class='txt'  onclick=\"checkUpdate('"+messageid+"')\"><span>"+title+"</span></div></li>"
					}
				}
				$("#noticeul").append(temp);
			}
		}
	}
})

PageHelper({
	url:projectpath+'/app/getSystemMessageListByUser?userid='+userid,
	success:function(data){
		if(data.dataList.length > 0){
			var temp = "";
			for(var i=0;i<data.dataList.length;i++){
				var createtime = data.dataList[i].createtime;
				var title =data.dataList[i].title;
				var messageid = data.dataList[i].messageid;
				if(data.dataList[i].status==0){
					temp += "<li>"+
			        	"<div class='xx_01'><span>"+createtime+"</span><em class='red'>未查看</em></div>"+
			            "<div class='txt' onclick=\"checkUpdate('"+messageid+"')\"><span>"+title+"</span></div></li>"
				}else{
					temp += "<li>"+
		        	"<div class='xx_01'><span>"+createtime+"</span></div>"+
		            "<div class='txt'  onclick=\"checkUpdate('"+messageid+"')\"><span>"+title+"</span></div></li>"
				}
			}
			$("#noticeul").append(temp);
		}
	}
})



function checkUpdate(messageid){
		location.href='notice_detail.html?messageid='+messageid;
}

function checkSave(){
	var title = "";
	title =$("#savetitle").val();
	$.ajax({
		type:'post',
		dataType:'json',
		url:projectpath+'/app/getSystemMessageListByUser?title='+title+'&userid='+userid,
		success:function(data){
			if(data.status==1){
				swal({
					title : "",
					text : data.message,
					type : "error",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
				
				});
			}else{
				if(data.dataList.length > 0){
					$("#noticeul").html("");
					var temp = "";
					for(var i=0;i<data.dataList.length;i++){
						var createtime = data.dataList[i].createtime;
						var title =data.dataList[i].title;
						var messageid = data.dataList[i].messageid;
						if(data.dataList[i].status==0){
							temp += "<li>"+
					        	"<div class='xx_01'><span>"+createtime+"</span><em class='red'>未查看</em></div>"+
					            "<div class='txt' onclick='checkUpdate("+messageid+")'><span>"+title+"</span></div></li>"
						}else{
							temp += "<li>"+
				        	"<div class='xx_01'><span>"+createtime+"</span></div>"+
				            "<div class='txt'  onclick='checkUpdate("+messageid+")'><span>"+title+"</span></div></li>"
						}
					}
					$("#noticeul").append(temp);
				}else{
					$("#nodata").css("display","block");
				}
			}
		}
	})
	
	PageHelper({
		url:projectpath+'/app/getSystemMessageListByUser?title='+title,
		success:function(data){
			if(data.dataList.length > 0){
				var temp = "";
				for(var i=0;i<data.dataList.length;i++){
					var createtime = data.dataList[i].createtime;
					var title =data.dataList[i].title;
					var id = data.dataList[i].id;
					if(data.dataList[i].status==0){
						temp += "<li>"+
				        	"<div class='xx_01'><span>"+createtime+"</span><em class='red'>未查看</em></div>"+
				            "<div class='txt' onclick='checkUpdate("+messageid+")'><span>"+title+"</span></div></li>"
					}else{
						temp += "<li>"+
			        	"<div class='xx_01'><span>"+createtime+"</span></div>"+
			            "<div class='txt'  onclick='checkUpdate("+messageid+")'><span>"+title+"</span></div></li>"
					}
				}
				$("#noticeul").append(temp);
			}
		}
	})
}



</script>
<body>
<div class="head_box">
	<a class="ico_back"    onclick="goBackPage()">返回</a>
    <div class="name">系统公告</div>
</div>
<div class="head_none"></div>
<div class="top_sel">
	<div class="long"><input type="text" class="t_text" placeholder="请输入关键字"  id ="savetitle"></div>
    <div class="span">&nbsp;</div>
    <div class="btn"><input type="button"  onclick="checkSave()"></div>
</div>
<div class="page_list">
	<ul id = "noticeul">

    </ul>
</div>

<div class="load_more" style="display: none;" id="nodata"><a>暂无数据</a></div>
</body>
</html>
