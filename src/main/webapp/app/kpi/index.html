<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>主页</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" >
<link type="text/css" rel="stylesheet" href="../appcssjs/style/public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/page_public.css">
<script type="text/javascript" src="../appcssjs/script/jquery-1.10.2.min.js"></script>
<link rel="stylesheet" href="../appcssjs/sweetalert/dist/sweetalert.css">
<script src="../appcssjs/sweetalert/dist/sweetalert-dev.js"></script>  

<script type="text/javascript" src="../appcssjs/script/cache.js"></script>
<script type="text/javascript" src="../appcssjs/script/constant.js"></script>
<script type="text/javascript" src="../appcssjs/script/page.js"></script>

<style type="text/css">
/* 	.index_menu ul li span{font-size:12px;} */
</style>
</head>

<body>
<div class="head_box">
	<a class="ico_back" onclick="location.href='../login/index.html'">返回</a>
    <div class="name">KPI星级考核</div>
    <div class="link">帮助</div>
</div>
<div class="head_none"></div>
<div class="contentWrap" style="min-height:125px;">
    <ul id="slider">
<!--     	<li style="display:block"><img src="../appcssjs/images/kpi/banner.png"  alt="" width="100%"></li> -->
    </ul>
    <div id="pagenavi">
<!--     	<a href="javascript:void(0);" class="active">1</a> -->
    </div>
</div>
<script type="text/javascript" src="../appcssjs/script/touchScroll.js"></script>
<script type="text/javascript" src="../appcssjs/script/touchslider.dev.js"></script>
<script type="text/javascript" src="../appcssjs/script/run.js"></script>
<div class="index_menu menu_height">
	<ul>
    	<li onclick="location.href='jobstart_list_noexamine.html'"><b class="bg1"><img src="../appcssjs/images/kpi/menu_01.png"><i id="selfstarnum" style="display: none;">3</i></b><span>岗位星值</span></li>
        <li onclick="location.href='allstart_list_noexamine.html'"><b class="bg2"><img src="../appcssjs/images/kpi/menu_02.png"><i id="generalstarnum" style="display: none;"></i></b><span>综合星值</span></li>
        <li onclick="intorangking()"><b class="bg3"><img src="../appcssjs/images/kpi/menu_03.png"></b><span>KPI星级排行榜</span></li>
    </ul>
    <div class="clear"></div>
</div>
<!-- <input type="hidden" id="current" value="1"/> -->
<!-- <div class="load_more"  id="jiazai" style="display: none;"><a class="show_more">加载更多</a></div> -->
<!-- <div class="load_more"  id="jiazaizhong" style="display: none;"><a class="show_more">努力加载中，请稍后···</a></div> -->
</body>
<script type="text/javascript">
var userInfo = "";
	$(function(){
		var obj = new Object();
		JianKangCache.getGlobalData('userinfo',function(data){
			obj.receiveid = data.userid;
			obj.companyid = data.companyid;
			userInfo = data;
			//
			showNum(obj);
			
			queryBanner(data.companyid);
		});
	});
	//var nodata = '<div class="load_more" style="background:#F7F7F7;"><a class="show_more" style="background: #eee; border:1px solid #eee; color:#aaa;">暂无数据</a></div>';
	
	function intorangking(){
		if(typeof(userInfo.powerMap.power3001010) == "undefined"){
			$.ajax({
				type:"post",
				dataType:"json",
				url:projectpath+"/app/getPromptInfo",
				data:"datacode=personnopower",
				success:function(data){
					swal({
						title : "",
						text :  data.datamap.remark,
						type : "warning",
						showCancelButton : false,
						confirmButtonColor : "#ff7922",
						confirmButtonText : "确认",
						cancelButtonText : "取消",
						closeOnConfirm : true
					}, function(){
					});
				}
			})
		}else{
			location.href="ranking_list.html";
		}
	}
	
	function showNum(obj){
		requestPost('/app/getStarAssessNotreadNum',obj,'index_weidushu',false,function(resultMap){
			if(resultMap != undefined && resultMap != null){
				var generalstarnum = resultMap.generalstarnum;
				var selfstarnum = resultMap.selfstarnum;
				if(generalstarnum == 0 || generalstarnum == '0'){
					$('#generalstarnum').hide();
				}else{
					$('#generalstarnum').show();
				}
				if(selfstarnum == 0 || selfstarnum == '0'){
					$('#selfstarnum').hide();
				}else{
					$('#selfstarnum').show();
				}
				$('#generalstarnum').text(generalstarnum);
				$('#selfstarnum').text(selfstarnum);
			}
		});
	}
	
	//查询banner信息
	function queryBanner(companyid){
		var banner = new Object();
		banner.model = 7;
		requestPost("/app/getBannerList",banner,"banner",true,function(resultMap){
			if(resultMap != undefined && resultMap != null){
				var bannerhtml = '';
				var banner_ahtml = "";
				$.each(resultMap,function(i,map){
					var dis = "none";
					var active = "";
					if(i == 0){
						dis = "block";
						active = 'class="active"';
					}
					bannerhtml += ' <li style="display:'+dis+'"><img src="'+projectpath+"/"+map.imgurl+'"  alt="" width="100%"></li>';
					banner_ahtml += '<a href="javascript:void(0);" '+active+'>'+(i+1)+'</a>';
				});
				var windowheight=(parseInt($(window).height())*24)/100;
				$('#slider').css("max-height",windowheight+"px");
				$('#slider').html(bannerhtml);
				$('#pagenavi').html(banner_ahtml);
				var active=0,
				as=document.getElementById('pagenavi').getElementsByTagName('a');
				
				for(var i=0;i<as.length;i++){
					(function(){
						var j=i;
						as[i].onclick=function(){
							t2.slide(j);
							return false;
						}
					})();
				}
	
				var t1=new TouchScroll({id:'wrapper','width':5,'opacity':0.7,color:'#555',minLength:20});
				var t2=new TouchSlider({id:'slider', speed:600, timeout:6000, before:function(index){
						as[active].className='';
						active=index;
						as[active].className='active';
				}});
			}
		 	var pagediv=$('#pagenavi a');
			for(var i=0;i<pagediv.length;i++){
				if(pagediv[i].text==userInfo.bannerid){
					t2.slide(i);
					return false;
				}
			}
		});
	}
	
	//公共的查询方法
	function requestPost(url,data,identifying,issynchroniz,callback){
		$.ajax({
			url:projectpath+url,
			data:data,
			async:issynchroniz,
			type:"post",
			beforeSend:function(){
				
			},
			success:function(resultMap){
				//保存到当前路径缓存
				JianKangCache.setData("kpi_",resultMap);
				callback(resultMap);
			},error:function(e){
				//取出缓存数据
				JianKangCache.getData("kpi_",function(resultMap){
					callback(resultMap);
				});
			},complete:function(){
				
			}
		});
	}
</script>

</html>
