<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>新建每日报表</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" >
<link type="text/css" rel="stylesheet" href="../appcssjs/style/public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/page_public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/restaurant.css">
<script type="text/javascript" src="../appcssjs/script/jquery-1.10.2.min.js"></script>
<link rel="stylesheet" href="../appcssjs/sweetalert/dist/sweetalert.css">
<script src="../appcssjs/sweetalert/dist/sweetalert-dev.js"></script>  
<script type="text/javascript" src="../appcssjs/script/tab.js"></script>
<script type="text/javascript" src="../appcssjs/script/page.js"></script>

<script type="text/javascript" src="../appcssjs/script/appendjs.js"></script>
<script type="text/javascript" src="../appcssjs/script/cache.js"></script>
<script type="text/javascript" src="../appcssjs/script/constant.js"></script>
<link href="../appcssjs/style/mobiscroll.custom-2.6.2.min.css" type="text/css" rel="stylesheet"> 
<script src="../appcssjs/script/mobiscroll.custom-2.6.2.min.js"></script> 
</head>
<script type="text/javascript">
var userInfo;
JianKangCache.getGlobalData('userinfo',function(data){
		userInfo=data;
})
var organizeid="";
var createtime="";
var keqing=null;
var goutong=null;
function onloadData(){
	keqing=document.getElementById("todaycustomerdivid").innerHTML;
	goutong=document.getElementById("communicationdivid").innerHTML;
	document.getElementById("todaycustomerdivid").innerHTML="";
	document.getElementById("communicationdivid").innerHTML="";
	
	if(userInfo!= null && typeof(userInfo) != "undefined"){
		$('#createname').text(userInfo.realname);
		$('#createname').attr("onclick","location.href='../member/homepage_info.html?userid="+userInfo.userid+"'");
	}
	$.ajax({
		type:'post',
		dataType:'json',
		url:projectpath+'/app/initInsertEverydayReport?companyid='+userInfo.companyid,
		success:function(data){
				createtime=data.createtime;
				$('#createtime').text(createtime);
		}
	})
	
	$.ajax({
		type:'post',
		dataType:'json',
		url:projectpath+'/app/getOrganizeListByDailyReport?userid='+userInfo.userid+'&companyid='+userInfo.companyid,
		success:function(data){
			if(data.status==1){
				swal({
					title : "",
					text : data.message,
					type : "error",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					
				});
			}else{
				if(data.shoplist.length > 0 && data.shoplist != ''){
					var temp="";
					for(var i=0;i<data.shoplist.length;i++){
						temp+="<li ";
						if(i==0){
							temp+="class=\"active\"";
						} 
						if(data.shoplist[i].organizeid == userInfo.organizeid){
							changeorganizestore(data.shoplist[i].datacode);
						}
						temp+="organizeid="+data.shoplist[i].organizeid+" onclick=\"chooseorganize(this,'"+data.shoplist[i].datacode+"')\">"+data.shoplist[i].organizename+"</li>";
					}
					$('#organizeul').html(temp);
					$('#organizeul li').get(0).click();
					//chooseorganize();
				}
			}
		}
	})
}
/* function clickSelect(obj){
	$(obj).parent().find("li").attr("class","");
	$(obj).attr("class","active");
} */
function chooseorganize(obj,datacode){
	var name =$(obj).text();
	var id =$(obj).attr('organizeid');
	$('#organizename').val(name);
	organizeid=id;
	$('#organizeid').val(organizeid);
	//查询模版
	$.ajax({
		type:'post',
		dataType:'json',
		url:projectpath+'/app/getEverydayReportModule?userid='+userInfo.userid+'&organizeid='+organizeid+'&companyid='+userInfo.companyid,
		success:function(data){
			if(data.modulelist.length > 0){
				var temp="";
				for(var i=0;i<data.modulelist.length;i++){
					temp+="<li ";
					if(i==0){
						temp+="class=\"active\"";
					} 
					temp+="templateid="+data.modulelist[i].templateid+" onclick=\"choosetemplate(this)\">"+data.modulelist[i].templatename+"</li>";
				}
				$('#templateul').html(temp);
				//如果只有一个模版直接查询出内容
				$('#templateul li').get(0).click();
				//choosetemplate();
			}
		}
	})
	$('#organizediv').hide();
	$('.div_mask').hide();
	changeorganizestore(datacode);
}
function choosetemplate(obj){
	var name =$(obj).text();
	var templateid =$(obj).attr('templateid');
	$('#templatename').val(name);
	$('#templateid').val(templateid);
	
	//查询内容
	$.ajax({
		type:'post',
		dataType:'json',
		url:projectpath+'/app/getEverydayReportDictList?templateid='+templateid,
		success:function(data){
			if(data.datalist.length > 0){
				//餐别
				var tempmeal="";
				for(var i=0;i<data.datalist.length;i++){
					if(data.datalist[i].typeid==1){
					tempmeal+="<div class=\"daily_xx\" name=\"mealdaily\"><input type=\"hidden\" name=\"mealdataid\" value=\""+data.datalist[i].dataid+"\" />"+
									"<div class=\"name\" name=\"mealdiv\"><span>"+data.datalist[i].dataname+"</span></div>"+
							  "</div>";
					}
				}
				$('#alldata').html(tempmeal);
				
				//今日统计
				var todaytemp="<div class=\"title\"><span>今日统计</span><i class=\"ico_show\" onclick=\"changeshow(this)\">展开</i></div><ul>";
				var todaynum=0;
				for(var k=0;k<data.datalist.length;k++){
					if(data.datalist[k].typeid==3){
						todaytemp+="<li><span>"+data.datalist[k].dataname+"</span>";
						if(data.datalist[k].isnum==1){
							todaytemp+="<input type=\"number\"";
						}else{
							todaytemp+="<input type=\"text\"";
						}
						
						if(data.datalist[k].dataid==10 || data.datalist[k].dataid==11 || data.datalist[k].dataid==12){
							todaytemp+="oninput=\"calculate()\"";
						}
						todaytemp+="class=\"t_text\" name=\"content\" placeholder=\"请输入"+data.datalist[k].dataname+"\"金额><input type=\"hidden\" name=\"dataid\" value=\""+data.datalist[k].dataid+"\"/></li>";
						todaynum++;
					}
				}
				todaytemp+="</ul>";
				if(todaynum > 0){
					$('div[name=mealdiv]').after(todaytemp);
				}
				
				//明细
				var detailtemp="<div class=\"title\"><span>收入详细</span><i class=\"ico_show\" onclick=\"changeshow(this)\">展开</i></div><ul>";
				var detailnum=0;
				for(var j=0;j<data.datalist.length;j++){
					if(data.datalist[j].typeid==2){
						detailtemp+="<li><span>"+data.datalist[j].dataname+"</span>";
						if(data.datalist[j].isnum==1){
							detailtemp+="<input type=\"number\"";
						}else{
							detailtemp+="<input type=\"text\"";
						}
						detailtemp+=" class=\"t_text\" name=\"content\" placeholder=\"请输入"+data.datalist[j].dataname+"金额\"><input type=\"hidden\" name=\"dataid\" value=\""+data.datalist[j].dataid+"\"/></li>";
						detailnum++;
					}
				}
				detailtemp+="</ul>";
				if(detailnum > 0){
					$('div[name=mealdiv]').after(detailtemp);
				}
			    
				//今日培训
				var todaytraintemp="";
				for(var i=0;i<data.datalist.length;i++){
					if(data.datalist[i].typeid==4){
						todaytraintemp+="<li><span>"+data.datalist[i].dataname+"</span><input type=\"hidden\" name=\"dataid\" value=\""+data.datalist[i].dataid+"\"/><input type=\"text\" placeholder=\"请输入"+data.datalist[i].dataname+"\" class=\"text\" name=\"content\"></li>";
					}
				}
				$('#todaytrainul').html(todaytraintemp);
				var todaytrain="<div class=\"daily_xx\" name=\"todaytraindaily\">"+
					"<div class=\"name\" id=\"todaytrain\"><span>今日培训情况</span><i class=\"ico_show\" onclick=\"changeshow1(this)\">展开</i></div>";
				    todaytrain+="<div class=\"btn_box\"><a class=\"add\" onclick=\"$('#todaytraindiv').show();$('.div_mask').show();$('#todaytrainul').find('input[name=content]').val('');\">添加</a></div>";
				    //todaytrain+=$('#todaytraindiv').html();
				    todaytrain+="</div>";
				$('#alldata').append(todaytrain);
				//$('#todaytraindiv').remove();
				
				//今日出勤
				var attendancetemp="<ul id=\"attendanceul\">";
				for(var i=0;i<data.datalist.length;i++){
					if(data.datalist[i].typeid==5){
						attendancetemp+="<li><span>"+data.datalist[i].dataname+"</span><input type=\"hidden\" name=\"dataid\" value=\""+data.datalist[i].dataid+"\"/><input type=\"number\" placeholder=\"请输入"+data.datalist[i].dataname+"\" class=\"t_text\" name=\"content\"></li>";
					}
				}
				attendancetemp+="</ul>";
				$('#attendancediv').html(attendancetemp);
				var attendance="<div class=\"daily_xx\" name=\"attendancedaily\">"+
					"<div class=\"name\" id=\"attendance\"><span>今日出勤情况</span><i class=\"ico_show\" onclick=\"changeshow1(this)\">展开</i></div>";
					//attendance+="<div class=\"btn_box\"><a class=\"add\" onclick=\"$('#attendancediv').show();$('.div_mask').show();$('#attendanceul').find('input[name=content]').val('');\">添加</a></div>";
					attendance+=$('#attendancediv').html();
					attendance+="</div>";
				$('#alldata').append(attendance);
				$('#attendancediv').html("");
				
				
				
				//今日主要客情
				var todaycustomer="<div class=\"daily_xx\"  name=\"todaycustomerdaily\">"+
					"<div class=\"name\" id=\"todaycustomer\"><span>今日主要客情</span><i class=\"ico_show\" onclick=\"changeshow1(this)\">展开</i></div>";
					for(var i=0;i<data.datalist.length;i++){
						if(data.datalist[i].typeid==6){
							
							//todaycustomer+="<div class=\"btn_box\"><a class=\"add\" onclick=\"$('#todaycustomerdiv').show();$('.div_mask').show();$('#todaycustomerdiv').find('textarea[name=content]').val('');\">添加</a></div>";
							$('#todaycustomerdiv').find('input[name=dataid]').val(data.datalist[i].dataid);
							todaycustomer+=keqing;
							
						}
					}
				todaycustomer+="</div>";
				$('#alldata').append(todaycustomer);
				
				//需沟通事项
				var communication="<div class=\"daily_xx\" name=\"communicationdaily\">"+
					"<div class=\"name\" id=\"communication\"><span>需沟通事项</span><i class=\"ico_show\" onclick=\"changeshow1(this)\">展开</i></div>";
					for(var i=0;i<data.datalist.length;i++){
						if(data.datalist[i].typeid==7){
							//communication+="<div class=\"btn_box\"><a class=\"add\" onclick=\"$('#communicationdiv').show();$('.div_mask').show();$('#communicationdiv').find('textarea[name=content]').val('')\">添加</a></div>";
							$('#communicationdiv').find('input[name=dataid]').val(data.datalist[i].dataid);
							communication+=goutong;
							
						}
					}
					communication+="</div>";
				$('#alldata').append(communication);
				
			}
			
			$("input[value=18]").prev().val(data.lastnum);
		}
	})
	$('#templatediv').hide();
	$('.div_mask').hide();
}

function calculate(){
	
	var yin=0;
	$("input[value=11]").prev().each(function(index){
		if($(this).val() != ""){
			yin+=parseFloat($(this).val());
		}
	})
	
	var flow=0;
	$("input[value=12]").prev().each(function(index){
		if($(this).val() != ""){
			flow+=parseInt($(this).val());
		}
	})
	var shi=0;
	$("input[value=10]").prev().each(function(index){
		if($(this).val() != ""){
			shi+=parseFloat($(this).val());
		}
	})
	
	$('#turnoveri').val("￥"+(parseFloat(yin)+parseFloat(shi))+"元");
	$('#guestflowi').val(flow);
	if(flow==0){
		$('#consumptioni').val("￥0元");
		$('#consumption').val(0);
	}else{
		var price=((parseFloat(yin)+parseFloat(shi))*100/flow*100)/10000+"";
		if(price.length > price.indexOf(".")+2 ){
			price=price.substring(0,price.indexOf(".")+3);
		}
		$('#consumptioni').val("￥"+price+"元");
		$('#consumption').val(price);
	}
	
	$('#turnover').val(yin+shi);
	$('#guestflow').val(flow);
	
}

function changeshow(obj){
	if($(obj).attr("class")=="ico_show"){
		$(obj).attr("class","ico_hidden");
		$(obj).parent().next().hide();
	}else{
		$(obj).attr("class","ico_show");
		$(obj).parent().next().show();
	}
}
function changeshow1(obj){
	if($(obj).attr("class")=="ico_show"){
		$(obj).attr("class","ico_hidden");
		$(obj).parent().nextAll().hide();
	}else{
		$(obj).attr("class","ico_show");
		$(obj).parent().nextAll().show();
	}	
}
function submitdata(){

	var alldata={"extendlist":[]}; 
	//餐别
	var status=0;
	$('div[name=mealdaily]').find("li").each(function(index){
		if($(this).find('input[name=dataid]').val()==10 && $(this).find('input[name=content]').val()==""){
			swal({
				title : "",
				text : "请填写食品金额后再提交",
				type : "error",
				showCancelButton : false,
				confirmButtonColor : "#ff7922",
				confirmButtonText : "确认",
				cancelButtonText : "取消",
				closeOnConfirm : true
			}, function(){
				$(this).find('input[name=content]').focus();
			});
			status=1;
			return false;
		}else if($(this).find('input[name=dataid]').val()==11 && $(this).find('input[name=content]').val()==""){
			swal({
				title : "",
				text : "请填写饮品金额后再提交",
				type : "error",
				showCancelButton : false,
				confirmButtonColor : "#ff7922",
				confirmButtonText : "确认",
				cancelButtonText : "取消",
				closeOnConfirm : true
			}, function(){
				$(this).find('input[name=content]').focus();
			});
			status=1;
			return false;
		}
		var extendlist={};
		extendlist['content']=$(this).find('input[name=content]').val();
		extendlist['dataid']=$(this).find('input[name=dataid]').val();
		extendlist['mealdataid']=$(this).parent().parent().find('input[name=mealdataid]').val();
		extendlist['type']=1;
		alldata.extendlist.push(extendlist); 
	})
	if(status==1){
		return;
	}
	
	if($('#organizeid').val()==""){
		swal({
			title : "",
			text : "请选择店面",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
		});
		return;
	}
/* 	if($('div[name=todaytraindaily] .span_box').length==0){
		swal({
			title : "",
			text : "请添加今日培训情况",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
		});
		return;
	} */
	//今日培训情况
	/* $('#todaytrainul li').each(function(index){
		var extendlist={};
		extendlist['content']=$(this).find('input[name=content]').val();
		extendlist['dataid']=$(this).find('input[name=dataid]').val();
		extendlist['remark']=$(this).find('input[name=remark]').val();
		extendlist['type']=2;
		alldata.extendlist.push(extendlist); 
	}) */
	$('div[name=todaytraindaily] .span_box').find("span").each(function(index){
		var extendlist={};
		extendlist['content']=$(this).find('input[name=content]').val();
		extendlist['dataid']=$(this).find('input[name=dataid]').val();
		extendlist['remark']=$(this).find('input[name=remark]').val();
		extendlist['type']=2;
		alldata.extendlist.push(extendlist); 
	})
/* 	if($('div[name=attendancedaily] .span_box').length==0){
		swal({
			title : "",
			text : "请添加今日出勤情况",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
		});
		return;
	} */
	//今日出勤情况
	$('#attendanceul li').each(function(index){
		var extendlist={};
		extendlist['content']=$(this).find('input[name=content]').val();
		extendlist['dataid']=$(this).find('input[name=dataid]').val();
		extendlist['remark']=$(this).find('input[name=remark]').val();
		extendlist['type']=3;
		alldata.extendlist.push(extendlist); 
	})
/* 	if($('div[name=todaycustomerdaily] .txt').length==0){
		swal({
			title : "",
			text : "请添加今日主要客情",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
		});
		return;
	} */
	//今日主要客情
	$('#todaycustomerdiv').each(function(index){
		var extendlist={};
		extendlist['content']=$(this).find('textarea[name=content]').val();
		extendlist['dataid']=$(this).find('input[name=dataid]').val();
		extendlist['remark']=$(this).find('input[name=remark]').val();
		extendlist['type']=4;
		alldata.extendlist.push(extendlist); 
	})
/* 	if($('div[name=communicationdaily] .txt').length==0){
		swal({
			title : "",
			text : "请添加需要沟通事项",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
		});
		return;
	} */
	//需要沟通事项
	$('#communicationdiv').each(function(index){
		var extendlist={};
		extendlist['content']=$(this).find('textarea[name=content]').val();
		extendlist['dataid']=$(this).find('input[name=dataid]').val();
		extendlist['remark']=$(this).find('input[name=remark]').val();
		extendlist['type']=5;
		alldata.extendlist.push(extendlist); 
	})
	
	if($('#examineuserid').val()==""){
		swal({
			title : "",
			text : "请选择抄送人",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			
		});
		return;
	}
	
	if($('#statisticaltime').val()==""){
		swal({
			title : "",
			text : "请选择统计时间",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			
		});
		return;
	}
	
	var datetime=new Date($('#statisticaltime').val());
	if(datetime > new Date()){
		swal({
			title : "",
			text : "统计时间只能选择从今天以前",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			
		});
		return;
	}
	
	var param = new Object();
	param.extendlist = JSON.stringify(alldata);
	param.organizeid = organizeid;
	param.companyid = userInfo.companyid;
	param.createid = userInfo.userid;
	param.datacode = userInfo.datacode;
	param.examineuserid = $('#examineuserid').val();
	param.turnover = $('#turnover').val();
	param.guestflow = $('#guestflow').val();
	param.consumption = $('#consumption').val();
	param.statisticaltime = $('#statisticaltime').val();
	
	param.userlist = $("#userlist").val();
	param.CCusernames = $('#releaserange').text();
	
	var url=projectpath+'/app/insertEverydayReport';
	$.ajax({
		type:'post',
		dataType:'json',
		beforeSend:function(a,b){
			ajaxbefore();
		},
		complete:function(a,b){
			ajaxcomplete();
		},
		data: param,
		url:url,
		success:function(data){
			if(data.status==1){
				swal({
					title : "",
					text : data.message,
					type : "error",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					
				});
			}else{
				swal({
					title : "",
					text : "添加成功",
					type : "success",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					location.href="dailyreport_list0.html";
				});
			}
		},error:function(text){
			alert("添加失败");
		}
	})
}
$(function(){
	$('.div_mask').click(function(){
		$('#templatediv').hide();
		$('#organizediv').hide();
		$('#attendancediv').hide();
		$('#todaytraindiv').hide();
		$('#todaycustomerdiv').hide();
		$('#communicationdiv').hide();
		$(this).hide();
	})
})
function addtodaytrain(){
	var addnum=$('#todaytrain').parent().find("div[class=span_box]").length;
	var status=0;
	var temp="<div class=\"span_box\" ><div class=\"close\" onclick=\"deletediv(this)\"><img src=\"../appcssjs/images/public/close.png\"></div>";
		var num=1;
		$('#todaytrainul li').each(function(index){
/* 			if($(this).find("input[name=content]").val()==""){
				swal({
					title : "",
					text : "请填写完整后再提交",
					type : "error",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					
				});
				status=1;
				return false;
			} */
			temp+="<span><em>"+$(this).find("span").text()+"：</em>"+$(this).find("input[name=content]").val()+
			"<input type=\"hidden\" name=\"content\" value=\""+$(this).find("input[name=content]").val()+"\" />"+
			"<input type=\"hidden\" name=\"dataid\" value=\""+$(this).find("input[name=dataid]").val()+"\" />"+
			"<input type=\"hidden\" name=\"remark\" value=\""+(addnum+1)+"\" /></span>";
		    if(num%2==0){
		    	temp+="<div class=\"clear\"></div>";
		    }
		    num++;
		})
		if(num%2==0){
			temp+="<div class=\"clear\"></div>";
		}
		if(status==1){
			return;
		}
		temp+="</div>";
		$("#todaytrain").after(temp);
		$('#todaytraindiv').hide();
		$('.div_mask').hide();
}
function addattendance(){
	var addnum=$('#attendance').parent().find("div[class=span_box]").length;
	var status=0;
	var temp="<div class=\"span_box\" ><div class=\"close\" onclick=\"deletediv(this)\"><img src=\"../appcssjs/images/public/close.png\"></div>";
		var num=1;
		$('#attendanceul li').each(function(index){
/* 			if($(this).find("input[name=content]").val()==""){
				swal({
					title : "",
					text : "请填写完整后再提交",
					type : "error",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					
				});
				status=1;
				return false;
			} */
			temp+="<span><em>"+$(this).find("span").text()+"：</em>"+$(this).find("input[name=content]").val()+
			"<input type=\"hidden\" name=\"content\" value=\""+$(this).find("input[name=content]").val()+"\" />"+
			"<input type=\"hidden\" name=\"dataid\" value=\""+$(this).find("input[name=dataid]").val()+"\" />"+
			"<input type=\"hidden\" name=\"remark\" value=\""+(addnum+1)+"\" /></span>";
		    if(num%2==0){
		    	temp+="<div class=\"clear\"></div>";
		    }
		    num++;
		})
		if(status==1){
			return;
		}
		if(num%2==0){
			temp+="<div class=\"clear\"></div>";
		}
		temp+="</div>";
		$("#attendance").after(temp);
		$('#attendancediv').hide();
		$('.div_mask').hide();
		$('div[name=attendancedaily]').find('a[class=add]').parent().hide();
}
function addtodaycustomer(){
	if($('#todaycustomerdiv').find("textarea[name=content]").val()==""){
		swal({
			title : "",
			text : "请输入内容再提交",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			
		});
		return;
	}
	var addnum=$('#todaycustomer').parent().find("div[class=txt]").length;
	var temp="<div class=\"txt\"><div class=\"close\" onclick=\"deletediv(this)\"><img src=\"../appcssjs/images/public/close.png\"></div>";
	temp+="<p>"+$('#todaycustomerdiv').find("textarea[name=content]").val()+"</p>"+
	"<input type=\"hidden\" name=\"content\" value=\""+$('#todaycustomerdiv').find("textarea[name=content]").val()+"\" />"+
	"<input type=\"hidden\" name=\"dataid\" value=\""+$('#todaycustomerdiv').find("input[name=dataid]").val()+"\" />"+
	"<input type=\"hidden\" name=\"remark\" value=\""+(addnum+1)+"\" />";
	temp+="</div>";
	$("#todaycustomer").after(temp);
	$('#todaycustomerdiv').hide();
	$('.div_mask').hide();
	$('div[name=todaycustomerdaily]').find('a[class=add]').parent().hide();
}
function addcommunication(){
	if($('#communicationdiv').find("textarea[name=content]").val()==""){
		swal({
			title : "",
			text : "请输入内容再提交",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			
		});
		return;
	}
	var addnum=$('#communication').parent().find("div[class=txt]").length;
	var temp="<div class=\"txt\"><div class=\"close\" onclick=\"deletediv(this)\"><img src=\"../appcssjs/images/public/close.png\"></div>";
	temp+="<p>"+$('#communicationdiv').find("textarea[name=content]").val()+"</p>"+
	"<input type=\"hidden\" name=\"content\" value=\""+$('#communicationdiv').find("textarea[name=content]").val()+"\" />"+
	"<input type=\"hidden\" name=\"dataid\" value=\""+$('#communicationdiv').find("input[name=dataid]").val()+"\" />"+
	"<input type=\"hidden\" name=\"remark\" value=\""+(addnum+1)+"\" />";
	temp+="</div>";
	$("#communication").after(temp);
	$('#communicationdiv').hide();
	$('.div_mask').hide();
	$('div[name=communicationdaily]').find('a[class=add]').parent().hide();
}
function deletediv(obj){
	swal({
		title : "",
		text : "确认删除？删除之后无法恢复",
		type : "warning",
		showCancelButton : true,
		confirmButtonColor : "#ff7922",
		confirmButtonText : "确认",
		cancelButtonText : "取消",
		closeOnConfirm : true
	}, function(){
		if($(obj).parent().prev().attr("id")=="attendance"){
			$('div[name=attendancedaily]').find('a[class=add]').parent().show();
		}else if($(obj).parent().prev().attr("id")=="todaycustomer"){
			$('div[name=todaycustomerdaily]').find('a[class=add]').parent().show();
		}else if($(obj).parent().prev().attr("id")=="communication"){
			$('div[name=communicationdaily]').find('a[class=add]').parent().show();
		}
		
		$(obj).parent().remove();
	});
	
}

$(function(){
	var currYear = (new Date()).getFullYear();	
	var opt={};
	opt.date = {preset : 'date', dateFormat: 'yy-mm-dd' };
	//opt.datetime = { preset : 'datetime', minDate: new Date(2012,3,10,9,22), maxDate: new Date(2014,7,30,15,44), stepMinute: 5  };
	opt.datetime = {preset : 'date', dateFormat: 'yy-mm-dd' }; 
	opt.time = {preset : 'time'};
	opt.default = { 
		theme: 'android-ics light', //皮肤样式  
        display: 'modal', //显示方式  
        mode: 'scroller', //日期选择模式
        dateOrder : 'yymmdd',  
		lang:'zh',
        startYear:currYear - 10, //开始年份
        endYear:currYear + 10 //结束年份
	};
	$('#statisticaltime').scroller('destroy').scroller($.extend(opt['datetime'], opt['default']));
	
	$("#statisticaltime").val(GetDateStr(0));
})

function GetDateStr(AddDayCount) { 
	var dd = new Date(); 
	dd.setDate(dd.getDate()+AddDayCount);//获取AddDayCount天后的日期 
	var y = dd.getFullYear(); 
	var m = dd.getMonth()+1;//获取当前月份的日期 
	if(parseInt(m)<10){
		m="0"+m;
	}
	var d = dd.getDate();
	if(parseInt(d)<10){
		d="0"+d;
	}
	return y+"-"+m+"-"+d; 
} 
</script>
<body onload="onloadData()">
<div id="htmlbody">
<div class="head_box">
	<a class="ico_back" onclick="location.href='dailyreport_list0.html'">返回</a>
    <div class="name">新建每日报表</div>
    <div class="link_yellow" onclick="submitdata()">发送</div>
</div>
<div class="head_none"></div>
<div class="detail_box">
    <ul style="margin-top:0px;">
    	<li>
    		<input type="hidden" id="organizeid" />
    		<span>店面</span><input type="text" placeholder="请选择店面" readonly="readonly"  class="t_sel" id="organizename" onclick="$('#organizediv').show();$('.div_mask').show();">
        </li>
        <li id="module" style="display: none;">
        	<input type="hidden" id="templateid" />
    		<span>模版</span><input type="text" placeholder="请选择模版" readonly="readonly"  class="t_sel" id="templatename" onclick="$('#templatediv').show();$('.div_mask').show();">
        </li>
        <li>
    		<input type="hidden" id="turnover" value="0"/>
    		<span>今日营业额</span><input type="text" readonly="readonly"  class="text" id="turnoveri" value="￥0元">
        </li>
        <li>
    		<input type="hidden" id="guestflow" value="0"/>
    		<span>今日客流量</span><input type="text" readonly="readonly"  class="text" id="guestflowi" value="0">
        </li>
        <li>
    		<input type="hidden" id="consumption" value="0" />
    		<span>今日人均消费</span><input type="text" readonly="readonly"  class="text" id="consumptioni" value="￥0元">
        </li>
    </ul>
</div>
<div id="alldata">

</div>
<div class="xx_adduser">
	<ul>
		<input type="hidden" id="examineuserid" />
    	<li><span>审&nbsp;核&nbsp;人：</span><i id="examinename"></i><a onclick="$('#organizeiframe').show();$('#htmlbody').hide();"><img src="../appcssjs/images/public/btn_add.png"></a></li>
        <li><span>抄&nbsp;送&nbsp;人：</span><i id="releaserange" style="text-overflow:ellipsis ; overflow:hidden; white-space:nowrap; max-width:59%;"></i><a onclick="$('#morechange_organizeiframe').show();$('#htmlbody').hide();"><img src="../appcssjs/images/public/btn_add.png"></a></li>
        <li><span>统计时间：</span><input type="text" placeholder="请选择统计时间" readonly="readonly"  class="t_sel" id="statisticaltime"/></li>
        <li><span>填&nbsp;写&nbsp;人：</span><i id="createname"></i></li>
        <li><span>填写时间：</span><i id="createtime"></i></li>
    </ul>
</div>

<div class="div_mask" style="display:none"></div>
<div class="tc_addsel"  style="display:none" id="organizediv">
	<div class="name"><span>选择店面</span></div>
    <div class="xx_box" style="max-height:250px;overflow:hidden;overflow-y:visible">
    	<ul id="organizeul">
        </ul>
    </div>
</div>
<div class="tc_addsel"  style="display:none" id="templatediv">
	<div class="name"><span>选择模版</span></div>
    <div class="xx_box" style="max-height:250px;overflow:hidden;overflow-y:visible">
    	<ul id="templateul">
        </ul>
    </div>
</div>

<div class="tc_addgoods" style="display:none" id="todaytraindiv">
	<div class="name"><span>新增今日培训情况</span><a onclick="addtodaytrain()">添加</a></div>
    <ul id="todaytrainul">
    </ul>
</div>
<div class="tc_addgoods" style="display:none" id="attendancediv">
	<!-- <div class="name"><span>新增今日出勤情况</span><a onclick="addattendance()">添加</a></div> -->
    <ul id="attendanceul">
    </ul>
</div>
<div id="todaycustomerdivid" style="display:none;">
<div class="tc_commen" style="background:#fff; width:100%;" id="todaycustomerdiv">
	<!-- <div class="name">今日主要客情</div> -->
	<input type="hidden" name="dataid" />
    <div class="text_box" style=" padding:12px 15px;"> 
    <textarea name="content" maxlength="800" placeholder="请输入今日主要客情，最多允许输入800字符" style="width:100%; height:112px; line-height:20px; padding:6px 10px; border-radius:3px; border:1px solid #e5e5e5; resize:none;"></textarea>
    </div>
    
    <!-- <div class="btn_box">
    	<input type="button" value="提交" class="btn_01" onclick="addtodaycustomer();">
        <input type="button" value="取消" class="btn_02" onclick="cancel();">
    </div> -->
</div>
</div>
<div id="communicationdivid" style="display:none;">
<div class="tc_commen" style="background:#fff; width:100%;" id="communicationdiv">
	<!-- <div class="name">需沟通事项</div> -->
	<input type="hidden" name="dataid" />
    <div class="text_box" style=" padding:12px 15px;">
    	<textarea name="content" maxlength="800" placeholder="请输入需沟通事项，最多允许输入800字符" style="width:100%; height:112px; line-height:20px; padding:6px 10px; border-radius:3px; border:1px solid #e5e5e5; resize:none;"></textarea>
    </div>
    <!-- <div class="btn_box">
    	<input type="button" value="提交" class="btn_01" onclick="addcommunication();">
        <input type="button" value="取消" class="btn_02" onclick="cancel();">
    </div> -->
</div>
</div>
<script type="text/javascript">
if(isiOS){
	$("#todaytraindiv").css({
		"top":"35px"
	});
}

function cancel(){
	$('textarea[name=content]').val("");
	$('.tc_comment').find('input[name=dataid]').val("");
	$('.div_mask').hide();
	$('#communicationdiv').hide();
	$('#todaycustomerdiv').hide();	
}
</script>
</div>
<script type="text/javascript" src="../appcssjs/script/selectuser.js"></script>
<script type="text/javascript" src="../appcssjs/script/select_xiebanren.js"></script>
</body>
</html>
