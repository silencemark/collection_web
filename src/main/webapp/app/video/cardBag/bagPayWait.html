<!DOCTYPE html>
 <html lang="en">
 <head>
     <meta charset="UTF-8">
     <title>享GO</title>
     <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=no,width=device-width,initial-scale=1.0"/>
     <link rel="stylesheet" type="text/css" href="../css/public.css"/>
     <link rel="stylesheet" type="text/css" href="../css/myCenter.css"/>
     <script src="../js/jquery-3.4.1.js"></script>
     <script src="../js/vue.js"></script>
     <script src="../js/jq-alert.js"></script>
 </head>
 <body>
    <div class="loading" id="loadingWindow" style="display:block;background:#fff;opacity: 0.9;"><img src="../img/timg.gif"/></div>

<section class="main"  id="app">
    <div class="title">
        <img src="../img/to-left.png" onclick="history.back(-1)"/>
        我的卡包
    </div>

<div class="gabTitle">
    <div onclick="window.location.href='bagPayWait.html'" class="active">抢购中</div>
    <div onclick="window.location.href='bagOwn.html'">已拥有</div>
    <div onclick="window.location.href='bagSale.html'">出售中</div>
    <div onclick="window.location.href='bagHistory.html'">历史VIP卡</div>
    <b class="clear"></b>
</div>

<!--抢购中-->
<div v-for="(item,i) in rushToBuyList" v-cloak>
    <div style="margin-bottom:15px;">
        <div  :class="`vipInfo-active vipInfo  v${item.forder}-c`"
        :style="`background-image:url('../img/V${item.forder}_BG.png')`">
        <span style="margin-bottom:5px;">{{item.typename}}</span>
        即日起购买{{item.typename}} {{item.commentstartdays}} 天后且您再观影好评{{item.commentcount}} 次可转让您的VIP卡！领取{{item.yield}}%观影收益。
            <div class="v-numver" style="width: 90%;margin-top:45px;">
                <div>已抢购时间：{{fmtTimeSecond(item.secondbuy,item)}}</div>
                <div>VIP卡期限：{{item.watchdays}}天</div>
                <div>预计价格：{{item.minprice}} - {{item.maxprice}}</div>
                <div>交易状态： <a style="font-weight:600;color:#BA4A33;">抢购中</a></div>
                <span class="clear">
        </div>
        <img v-if="item.forder" :src="`../img/V${item.forder}_IC.png`" class="v-img" style="width:120px;height:120px;"/>
        </div>
        <div class="clear"></div>
        <input type="button" value="正在抢购中..." :class="`active-but  v${item.forder}-bg`"/>
    </div>
    <div class="payWaitLoad"><img src="../img/timg.gif"/></div>
</div>
<!--待支付-->
<div v-for="(item,i) in waitPayCardList" style="margin-bottom:15px;" v-cloak>
    <div  :class="`vipInfo-active vipInfo  v${item.forder}-c`" 
    :style="`background-image:url('../img/V${item.forder}_BG.png')`">
      <span style="margin-bottom:5px;">{{item.typename}}</span>
      即日起购买{{item.typename}} {{item.commentstartdays}} 天后且您再观影好评{{item.remaincount}} 次可转让您的VIP卡！领取{{item.yield}}%观影收益。
        <div class="v-numver" style="width: 90%;margin-top:45px;">
            <div>交易单号：{{item.ordernum}}</div>
            <div>VIP卡期限：{{item.watchdays}}天</div>
            <div>购买价格：{{item.cardprice}}</div>
            <div>交易状态：
                <a style="font-weight:600;color:#BA4A33;" v-if="item.status==1">待支付</a>
                <a style="font-weight:600;color:#BA4A33;" v-if="item.status==2">待审核</a>
            </div>
            <span class="clear">
      </div>
      <img :src="`../img/V${item.forder}_IC.png`" class="v-img" style="width:120px;height:120px;"/>
    </div>
    <div class="clear"></div>

    <input type="button" v-if="item.status==1" :value="`立即支付(倒计时：${fmtTimeSecond(item.remaintime,item,true)})`" 
        :class="`active-but  v${item.forder}-bg`" :onclick="`window.location.href='bagPay.html?orderid=${item.orderid}'`"/>

    <input type="button" v-if="item.status==2" :value="`剩余自动审核时间(${fmtTimeSecond(item.remaintime,item,true)})`" 
     :class="`active-but  v${item.forder}-bg`"/>
</div>
<div v-if="rushToBuyList.length==0 && waitPayCardList.length==0" class="notList">没有抢购中的记录</div>
</section>


 <!--footer-->
 <br/><br/><br/>
 <footer id="footer">
    <ul id="footer_list">
       <li class="list_li home active">
           <a href="../index.html" class="text">首页</a>
       </li>
       <li class="list_li follow" >
           <a  href="../activity.html" class="text">活动中心</a>
       </li>
       <li class="list_li cart">
           <a  href="../cardBag/bagOwn.html" class="text">卡包</a>
       </li>
       <li class="list_li profile">
           <a  href="../myCenter.html" class="text">我的</a>
       </li>
   </ul>
  </footer>
<!-- end footer-->
</body>

<script>
new Vue({
    el: '#app',
    data: function() {
    return {
        rushToBuyList : [],
        waitPayCardList : [],
        timer : undefined
    }
    },
    created() {
        this.getWaitPayCard();
    },
    methods:{
        //查询抢购中 以及 待支付列表
        getWaitPayCard(){
            var vueThis = this;
            jAjax("/appVipCard/getRushToBuyList",{},function(data){
                vueThis.rushToBuyList = data.resultlist;  
            });
            jAjax("/appVipCard/getWaitPayCard",{},function(data){
                vueThis.waitPayCardList = data.resultlist;
            });
        },
        //格式化 秒 时间显示
        fmtTimeSecond(second,item,isCount){
            if(isCount){
                this.setInterFun(item)
            }
            if(second<60){
                return second+'秒';
            }else{
                return parseInt(second/60)+'分'+(second%60)+'秒';
            }
        },
        //定时函数
        setInterFun(item){
            var vueThis = this;
            if(!vueThis.timer){
                vueThis.timer = setInterval(()=>{
                    item.remaintime -= 1;
                    if(item.remaintime<=0){
                        item.isbuy = 1;
                        clearInterval(vueThis.timer);
                    }
                },1000);
            }
        }

  }
})
</script>

</html>