<!DOCTYPE html>
 <html lang="en">
 <head>
     <meta charset="UTF-8">
     <title>购买VIP</title>
     <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=no,width=device-width,initial-scale=1.0"/>
     <link rel="stylesheet" type="text/css" href="../css/public.css"/>
     <link rel="stylesheet" type="text/css" href="../css/myCenter.css"/>
     <link rel="stylesheet" type="text/css" href="../css/login.css"/>
     <script src="../js/jquery-3.4.1.js"></script>
     <script src="../js/vue.js"></script>
     <script src="../js/jq-alert.js"></script>
     <script src="../js/exif.js"></script>
 </head>
 <body>
    <div class="loading" id="loadingWindow" style="display:block;background:#fff;opacity: 0.9;"><img src="../img/timg.gif"/></div>
<section class="main"  id="app">
    <div class="title">
         <img src="../img/to-left.png" onclick="history.back(-1)"/>
        购买VIP
    </div>
<div>
<!--vipInfo-->
<div style="margin-bottom: 5px;margin-top:10px;border-bottom:1px solid #f2f1f1;padding-bottom: 10px;">
    <div  :class="`vipInfo-active vipInfo  v${orderInfo.forder}-c`" 
    :style="`background-image:url('../img/V${orderInfo.forder}_BG.png')`" v-cloak>
      <span style="margin-bottom:5px;" >{{orderInfo.typename}}专享任务</span>
      即日起购买{{orderInfo.typename}} {{orderInfo.commentstartdays}} 天后且您再完成相应任务要求即可转让您的任务卡！领取{{item.yield}}%任务奖励。
      <img :src="`../img/V${orderInfo.forder}_IC.png`" class="v-img" style="width:120px;height:120px;"/>
    </div>
    <div class="clear"></div>
</div>

<div class="payVipInfoCont">
    <div style="font-weight: 600;">{{orderInfo.forderName}}专享影视</div>
    <div>交易单号 ：{{orderInfo.ordernum}}</div>
    <div>购买日期 ：{{orderInfo.buytime}}</div>
    <div>任务期至 ：{{orderInfo.duetime}}</div>
    <div>交易状态 ：<span style="color:#F36257;font-weight:600;">待支付</span></div>
    <div>购买价格 ：<span style="color:#F36257;font-weight:600;">{{orderInfo.cardprice}}</span></div>
</div>

<div style="font-weight:600;font-size: 0.9rem;color:#555;margin-left:4%;margin-top:10px;">请选择支付方式</div>
<div class="operationEl payOption">
    <img src="../img/XGO-ic.png"/>
    <span>XGO币</span>
    <span class="money"><span style="color:#555;font-weight:500;font-size:0.9em;">余额：</span>{{orderInfo.xgocoin}}</span>
</div>
<div class="operationEl payOption" @click="selectPayType(1)">
    <img src="../img/wx-ic.png"/>
    <img src="../img/sele-ic.png" style="left:180px;" v-if="payType==1"/>
    <span>微信</span>
</div>
<div class="operationEl payOption" @click="selectPayType(2)">
    <img src="../img/zfb-ic.png"/>
    <img src="../img/sele-ic.png" style="left:180px;" v-if="payType==2"/>
    <span>支付宝</span>
</div>
<div class="operationEl payOption" @click="selectPayType(3)">
    <img src="../img/bank-ic.png"/>
    <img src="../img/sele-ic.png" style="left:180px;" v-if="payType==3"/>
    <span>银行卡</span>
</div>
<div class="colUserCont" v-if="payType!=0">
    <div class="colLeft">
        <div style="font-weight:600;margin-top:10px;">收款人信息</div>
        <div v-if="payType==1">
            <div>收款人名称：{{orderInfo.weixinrealname}}</div>
            <div>微信号：{{orderInfo.weixinnum}}</div>
            <div>手机号：{{orderInfo.phone}}</div>
            <div>收款码: 见右图</div>
        </div>
        <div v-if="payType==2">
            <div>收款人名称：{{orderInfo.alipayrealname}}</div>
            <div>支付宝账号：{{orderInfo.alipaynum}}</div>
            <div>手机号：{{orderInfo.phone}}</div>
            <div>收款码: 见右图</div>
        </div>
        <div v-if="payType==3">
            <div>收款人名称：{{orderInfo.bankrealname}}</div>
            <div>银行名称：{{orderInfo.bank}}</div>
            <div>银行卡号：{{orderInfo.banknum}}</div>
            <div>手机号：{{orderInfo.phone}}</div>
        </div>
    </div>
    <div class="colRigth">
        <img v-if="payType==1" :src="reqPath+orderInfo.weixinqrcode" style="width: 100%;height:100%;">
        <img v-if="payType==2" :src="reqPath+orderInfo.alipayqrcode" style="width: 100%;height:100%;">
    </div>
    <div class="clear"></div>
</div>
<div class="payVoucher" v-if="payType!=0">
    <div style="font-weight:600;margin-top:10px;">请上传支付凭证</div> 
    <input onchange="fileChangeFun2(this,'pzImg','pzBase64');" class="imgFileInput" type="file" accept="image/*" multiple="">
    <img src="../img/default-zfpz.png" id="pzImg"/> 
    <input id="pzBase64" ref="pzBase64" type="hidden" />

</div>





<div class="but-cont"v-if="payType!=0">
    <div class="btn btn-200" @click="commitPay">我 已 支 付</div>
</div>
</div>
<br/><br/><br/><br/><br/>

<!--确认支付窗口-->
<div class="payConfirmCont" v-show="payConfirmContStatus">
    <span style="position:absolute;right:15px;margin-top:5px;font-size:0.8rem;color:#999;" @click="payConfirmContStatus = false">关闭</span>
    <div class="inputCont">
        <div style="font-size:1rem;font-weight:600;color:#555;margin-top:20px;margin-bottom:10px;">支付密码：</div>
        <input type="password"  v-model="paypassword" placeholder="请输入您的支付密码" maxlength="16"/>
        <div class="but-cont" style="margin-top: 20px;">
            <div class="btn btn-200"  @click="submitPay"> 确 认 </div>
        </div>
    </div>
</div>
<!--end 确认支付窗口-->

</section>

 <footer id="footer">
    <ul id="footer_list">
       <li class="list_li home active">
           <a href="../index.html" class="text">首页</a>
       </li>
       <li class="list_li follow" >
           <a  href="../activity.html" class="text">活动中心</a>
       </li>
       <li class="list_li cart">
           <a  href="../cardBag/bagOwn.html" class="text">卡包</a>
       </li>
       <li class="list_li profile">
           <a  href="../myCenter.html" class="text">我的</a>
       </li>
   </ul>
  </footer>
<!-- end footer-->




</body>

<script>
new Vue({
    el: '#app',
    data: function() {
        return {
            reqPath : reqPath,
            orderid:'',
            payType:2,
            orderInfo:{},
            payConfirmContStatus:false,
            paypassword:'',
        }
    },
    created() {
        this.orderid = this.GetQueryString('orderid');
        this.getPayVipCardInfo(this.orderid);
    },
    methods:{
        //查询
        getPayVipCardInfo(orderid){
            var vueThis = this;
            jAjax("/appVipCard/getPayVipCardInfo",{orderid:orderid},function(data){
                vueThis.orderInfo = data;  
            });
        },
        //选择支付方式
        selectPayType(payType){
            this.payType = payType;
        },
        //提交支付
        commitPay(){
            var pzBase64 = this.$refs.pzBase64.value;
            if(!pzBase64){
                jqtoast('请上传支付凭证！');
                return;
            }
            this.payConfirmContStatus = true;
        },
        //确认支付
        submitPay(){
            if(!this.paypassword || this.paypassword.length<6){
                jqtoast('请正确输入支付密码！');
                return;
            }
            var pzBase64 = this.$refs.pzBase64.value;
            var reqData = {orderid:this.orderid,payorder:pzBase64,status:2,paypassword:this.paypassword};
            jAjax("/appVipCard/payVipCard",reqData,function(data){
                if(data.status=='0'){
                    jqtoast('提交成功！');
                    window.location.href = "bagPayWait.html";
                }else{
                    jqtoast(data.message);
                }
                
            });
        },
        //获取URL参数
        GetQueryString(name){
            var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if(r!=null)return  unescape(r[2]); return null;
        }
  }
})
</script>

</html>