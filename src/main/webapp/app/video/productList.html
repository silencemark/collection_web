<!DOCTYPE html>
 <html lang="en">
 <head>
     <title>享GO影视</title>
     <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
     <meta name="apple-mobile-web-app-status-bar-style" content="black">
     <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=no,width=device-width,initial-scale=1.0"/>
     <meta name="application-name" content="享GO影视">
     <link rel="apple-touch-icon-precomposed" sizes="120x120" href="img/bitbug_favicon.ico">
     <meta name="apple-mobile-web-app-capable" content="yes">

     <link rel="stylesheet" type="text/css" href="css/public.css"/>
     <link rel="stylesheet" type="text/css" href="css/money.css"/>
     <link rel="stylesheet" type="text/css" href="css/myCenter.css"/>
 </head>
 <body style="background-color:#f6f6f6;">
<section class="main"  id="app">
<div style="position: fixed;top: 0px;width: 100%;background: #fff;max-width: 580px;z-index:2;">
    <div class="title" >
        <img src="img/to-left.png" onclick="history.back(-1)"/>
        专区互动
   </div>
   <img src="img/yq02.png" style="width:98%;margin-left:1%;"  onclick="window.location.href='invite.html'">
   <div class="sqTitle">
       <div class="sqTitleEl sqTitleElActiv" @click="changStype(0)" style="width:25%;">精品推荐</div>
       <div class="sqTitleEl" @click="changStype(1)" style="width:25%;">手办专区</div>
       <div class="sqTitleEl" @click="changStype(1)" style="width:25%;">收藏品</div>
       <div class="sqTitleEl" @click="changStype(1)" style="width:25%;">其他</div>
       <div class="clear"></div>
   </div>
</div>

<div class="commsq" style="margin-top:180px;">
    <div class="commsqLeft">
        <div class="commsqEl" v-for="(sqel , i) in commList" v-if="i%2==0"  v-cloak>
            <img :src="reqPath+sqel.coverimg"  @click="shwoInfo(sqel)"/>
            <!-- <span class="sqTime">{{sqel.createtime?sqel.createtime.substr(0,10):''}}</span> -->
            <span style="display:block;padding:10px;font-size: 0.9rem;font-weight:bold;">GSAD橘右京 是贷款的咖啡店</span>
            <div class="uInfo">
                <span class="uname" style="font-size:1rem;color:rgb(222, 24, 134);">￥155</span>
                <span class="znum">3545人喜欢</span>
            </div>
        </div>
    </div>

    <div class="commsqRight">
        <div class="commsqEl" v-for="(sqel , i) in commList" v-if="i%2!=0"  v-cloak>
            <img :src="reqPath+sqel.coverimg"  @click="shwoInfo(sqel)"/>
            <!-- <span class="sqTime">{{sqel.createtime?sqel.createtime.substr(0,10):''}}</span> -->
            <span style="display:block;padding:10px;font-size: 0.9rem;font-weight:bold;">GSAD橘右京 是贷款的咖啡店</span>
            <div class="uInfo">
                <span class="uname" style="font-size:1rem;color:rgb(222, 24, 134);">￥155</span>
                <span class="znum">3545人喜欢</span>
            </div>
        </div>
    </div>
    <div class="clear"></div>
</div>

<br/><br/><br/><br/>
</section>



 <footer id="footer">
    <ul id="footer_list">
       <li class="list_li home active">
           <a  href="javascript:void(0);" shref="index.html" class="text">首页</a>
       </li>
       <li class="list_li follow" >
           <a   href="javascript:void(0);" shref="community.html" class="text">享互动</a>
       </li>
       <li class="list_li cart">
           <a   href="javascript:void(0);" shref="gameList.html" class="text">享玩游戏</a>
       </li>
       <li class="list_li profile">
           <a   href="javascript:void(0);" shref="myCenter.html" class="text">我的</a>
       </li>
   </ul>
  </footer>
<!-- end footer-->
</body>
</html>

<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/vue.js"></script>
<script src="js/exif.js"></script>
<script>
    $(function(){
        $(".sqTitleEl").click(function(){
            // $(".sqTitleEl").removeClass("sqTitleElActiv");
            // $(this).addClass("sqTitleElActiv");
            jqtoast('没有更多商品了！');
        })
    })
//add bef
function addimgBef(obj){
    if($("#addimgList").find(".addimgEl") && $("#addimgList").find(".addimgEl").length>=3){
        jqtoast('亲，最多只能上传三张哦！');
        return;
    }
    exAddImg(obj,sqAddimg);
}
// add ckb
function sqAddimg(imgUrl,base64){
    var ht = "<div class='addimgEl'><div class='rm' onclick='rmAddimg(this);'>-</div><img src='"+imgUrl+"'></div>";
    $("#addimgList").append(ht);
}
//remore
function rmAddimg(obj){
    $(obj).parent().remove();
}
//add sys
function confirmAdd(){
    if(!$("#addimgList").find(".addimgEl") || $("#addimgList").find(".addimgEl").length<1){
        jqtoast('请上传图片！');
        return;
    }
    var commText = $("#sqAddCommentText").val();
    if(!commText){
        jqtoast('请填写发帖内容！');
        return;
    }
    var imagelist = [];
    $("#addimgList").find(".addimgEl").each(function(){
        imagelist.push({imgurl:$(this).find("img").attr("src").replace(/^data:image\/(png|jpeg);base64,/,"")});
    });
    var reqBo = {
        imagelist:imagelist,
        content:commText
    };
    addIMGSUpload(reqBo);
}
//zan
function sqZan(obj,communityid){
    var status = 0;
    if($(obj).attr("isenable")=='0'){
        $(obj).attr("src","img/zanys.png");
        $(obj).attr("isenable","1");
        $(obj).prev().html(parseInt($(obj).prev().html())+1);
        status = 1;
    }else{
        $(obj).attr("src","img/notzany.png");
        $(obj).attr("isenable","0");
        $(obj).prev().html(parseInt($(obj).prev().html())-1);
    }
    jAjax("/appIndex/likeCommunity",{communityid:communityid,status:status},function(data){
    },null,true);
}
//文档高度
function getDocumentTop() {
        var scrollTop =  0, bodyScrollTop = 0, documentScrollTop = 0;
        if (document.body) {
            bodyScrollTop = document.body.scrollTop;
        }
        if (document.documentElement) {
            documentScrollTop = document.documentElement.scrollTop;
        }
        scrollTop = (bodyScrollTop - documentScrollTop > 0) ? bodyScrollTop : documentScrollTop;
        return scrollTop;
    }
 
    //可视窗口高度
    function getWindowHeight() {
        var windowHeight = 0;
        if (document.compatMode == "CSS1Compat") {
            windowHeight = document.documentElement.clientHeight;
        } else {
            windowHeight = document.body.clientHeight;
        }
        return windowHeight;
    }
 
    //滚动条滚动高度
    function getScrollHeight() {
        var scrollHeight = 0, bodyScrollHeight = 0, documentScrollHeight = 0;
        if (document.body) {
            bodyScrollHeight = document.body.scrollHeight;
        }
        if (document.documentElement) {
            documentScrollHeight = document.documentElement.scrollHeight;
        }
        scrollHeight = (bodyScrollHeight - documentScrollHeight > 0) ? bodyScrollHeight : documentScrollHeight;
        return scrollHeight;
    }

    //下拉加载数据
    var refEnabled = true;//防止重复请求
    $(window).bind("scroll", function () {
        if((getScrollHeight()-2) < getDocumentTop() + getWindowHeight()){
            if(refEnabled){
                refEnabled = false;
                xlref();
            }
        }
    });

    new Vue({
      el: '#app',
      data: function() {
        return {
            reqPath : reqPath,
            showType:0,
            addCommentWinFlg:false,
            commList : [],
            pageNo:1,
            pageSize:10,
            sumPageNumber:1,
            refTxt:'上拉刷新',
        }
      },
      created() {
          this.getCommunityList({});
      },
      mounted() {
        window.addIMGSUpload = this.addIMGSUpload;
        window.xlref = this.xlref;
     },
      methods:{
        //上传
        addIMGSUpload(reqBo){
            var vueThis = this;
            reqBo.imagelist = JSON.stringify(reqBo.imagelist);
            jAjax("/appIndex/addCommunity",reqBo,function(data){
                if(data.status==0){
                    jqtoast('发帖成功！');
                    vueThis.addCommentWinFlg = false;
                    vueThis.getCommunityList({});
                }else{
                    jqtoast(data.message);
                }
            });
        },
        xlref(){
            this.pageNo = this.pageNo +1;
            if(this.pageNo>this.sumPageNumber){
                return;
            }
            if(this.pageNo = this.sumPageNumber){
                this.refTxt = "没有更多数据了";
            }
            this.getCommunityList();
        },
        //资源查找
        getCommunityList(reqBo){
            reqBo = reqBo?reqBo:{};
            if(this.showType==1){
                reqBo.uid = getCptToken();
            }
            reqBo.startnum=(this.pageNo-1)*this.pageSize;
            reqBo.rownum = this.pageSize;
            var vThis = this;
            jAjax("/appIndex/getCommunityList",reqBo,function(data){
                for(var i=0;i<data.communitylist.length;i++){
                    if(!data.communitylist[i].nickname) data.communitylist[i].nickname="";
                    var hdimg = data.communitylist[i].headimage;
                    if(!hdimg){
                        data.communitylist[i].headimage = "img/defaulttx.png";
                    }else{
                        if(hdimg.indexOf("http")<0){
                            data.communitylist[i].headimage = reqPath + data.communitylist[i].headimage;
                        }
                    }
                    vThis.commList.push(data.communitylist[i]);
                }
                vThis.sumPageNumber = Math.ceil(data.communitynum/vThis.pageSize);
                refEnabled = true;
            });
        },
        //查看类型
        changStype(type){
            return;
            this.showType = type;
            this.commList = [];
            this.pageNo=1,
            this.pageSize=10,
            this.communitynum = 1;
            this.getCommunityList();
        },
        //添加窗口
        addCommentWin(){
            addCommentBo={};
            this.addCommentWinFlg = true;
        },
        //查看详情
        shwoInfo(item){
            window.location.href='productInfo.html?communityid='+item.communityid
        }
      }
    })
  </script>
