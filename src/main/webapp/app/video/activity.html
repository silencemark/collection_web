<!DOCTYPE html>
 <html lang="en">
 <head>
     <meta charset="UTF-8">
     <title>活动中心</title>
     <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=no,width=device-width,initial-scale=1.0"/>
     <link rel="stylesheet" type="text/css" href="css/public.css"/>
     <link rel="stylesheet" type="text/css" href="css/myCenter.css"/>
     <!--轮播CSS-->
     <link rel="stylesheet" type="text/css" href="css/slideshow.css">
     <script src="js/jquery-3.4.1.js"></script>
     <script src="js/jq-alert.js"></script>
     <script src="js/vue.js"></script>
     <script src="js/base.js"></script>
     <script src="js/slideshow.js"></script>
 </head>
 <body>
 <div class="loading" id="loadingWindow" style="display:block;background:#fff;opacity: 0.9;"><img src="img/timg.gif"/></div>

<section class="main"  id="app">
    <div class="title">
        <!-- <img src="img/to-left.png" onclick="history.back(-1)"/> -->
        活动中心
    </div>
    <!-- <img src="img/tkg.png" style="width: 100%;"/> -->



<!--轮播-->
<div class="layout">
    <div class="banner">
        <ul class="swipe" id="swipe">
            <!--图片低于5张出问题直接轮播两组-->
            <li><a href="#"><img src="https://puui.qpic.cn/tv/0/928089421_1080607/0"></a></li>
            <li v-for="(item,i) in bannerList" v-cloak>
                <a :href="`cardBag/bagComment.html?mv=${item.httpurl}`" ><img :src="reqPath+item.imgurl"></a>
                <div v-cloak>{{item.description}}</div v-cloak>
            </li>
            <li v-for="(item,i) in bannerList">
                <a :href="`cardBag/bagComment.html?mv=${item.httpurl}`"><img :src="reqPath+item.imgurl"></a>
                <div  v-cloak>{{item.description}}</div>
            </li>
        </ul>
        <ul class="swipe-btn-list" id="swipe-btn-list">
            <li v-for="(item,i) in bannerList"></li>
            <li></li><li></li><li></li>
        </ul>
    </div>
</div>
<!--end 轮播-->



<!--vipInfo-->
<div v-for="(item,i) in vipCardList" v-cloak>
    <div style="margin-bottom:15px;">
        <div  :class="`vipInfo-active vipInfo  v${item.forder}-c`" :style="`background-image:url('img/V${item.forder}_BG.png')`" >
        <span style="margin-bottom:5px;">{{item.typename}}</span>
        领取{{item.typename}} {{item.commentstartdays}} 天后且完成相应任务要求即可转让您的任务卡！领取{{item.yield}}%任务奖励。
            <div class="v-numver" style="width: 90%;">
                <div>价格范围：{{item.minprice}} - {{item.maxprice}}</div>
                <div>任务期限：{{item.watchdays}} 天</div>
                <div>开放时间：{{item.starttime}} - {{item.endtime}}</div>
                <div>消耗XGO币：{{item.xgocoin}}</div>
                <span class="clear">
        </div>
        <!-- <img :src="`img/V${item.forder}_IC.png`" class="v-img" style="width:120px;height:120px;"/> -->
        </div>
        <div class="clear"></div>
        <div v-if="item.secondbuy && item.secondbuy<120 && item.secondbuy>0">
            <input type="button" :value="fmtTimeSecond(item.secondbuy,item)" :class="`active-but  v${item.forder}-bg`"/>
        </div>
        <div v-else>
            <div v-if="item.havebuy==1 || item.havebuy==2">
                <input type="button" v-if="item.havebuy==1" value="任 务 抢 购 中" :class="`active-but  v${item.forder}-bg`"/>
                <input type="button" v-if="item.havebuy==2" value="今日任务已领取" :class="`active-but  v${item.forder}-bg`" 
                    onclick="window.location.href='cardBag/bagPayWait.html'"/>
            </div>
            <div v-else>
                <input type="button" v-if="item.isbuy==1" @click="rushToBuyCard(item.forder,i)" value="领 取 任 务" :class="`active-but  v${item.forder}-bg`" />
                <input type="button" v-if="item.isbuy==0" value="暂 未 开 启" :class="`active-but  v${item.forder}-bg`"/>
            </div>
        </div>
    </div>
    <div class="payWaitLoad" v-if="item.havebuy==1"><img src="img/timg.gif"/></div>
    <div class="payWaitLoad" v-if="item.havebuy==2"></div>

</div>
</section>


 <!--footer-->
 <br/><br/><br/>
 <footer id="footer">
    <ul id="footer_list">
       <li class="list_li home active">
           <a href="index.html" class="text">首页</a>
       </li>
       <li class="list_li follow" >
           <a  href="activity.html" class="text">活动中心</a>
       </li>
       <li class="list_li cart">
           <a  href="cardBag/bagOwn.html" class="text">卡包</a>
       </li>
       <li class="list_li profile">
           <a  href="myCenter.html" class="text">我的</a>
       </li>
   </ul>
  </footer>
<!-- end footer-->
</body>

<script>
new Vue({
    el: '#app',
    data: function() {
    return {
        reqPath : reqPath,
        vipCardList : [],
        bannerList : [],//轮播图
        timer:undefined,//定时函数
    }
    },
    created() {
        this.getVipCardList();
        this.getBanner();
    },
    methods:{
    //获取轮播图片
    getBanner(){
        var vm = this;
        jAjax("/appIndex/getBanner",{type:2},function(data){
            if(data && data.length<3){
                data[1] = data[0];
                data[2] = data[0];
                data[3] = data[0];
            }
            vm.bannerList = data;
        });
    },
    //获取活动
    getVipCardList(){
        var vueThis = this;
        jAjax("/appVipCard/getVipCardList",{},function(data){
            vueThis.vipCardList = data.resultlist;  
        });
    },
    //立即抢购
    rushToBuyCard(cardid,cardIndex){
        var vueThis = this;
        var reqData = {cardid:cardid};
        jAjax("/appVipCard/rushToBuyCard",reqData,function(data){
            if(data.status==0){
                window.location.href='cardBag/bagPayWait.html';
            }else{
                jqalert({
                    prompt:data.message+'  立即前往账户设置？',
                    yestext:'立即前往',
                    notext:'取消',
                    yesfn:function () {
                        window.location.href='user/setUser.html';
                    },
                    nofn:function () {}
                });
            }
        });
    },
    //格式化 秒 时间显示
    fmtTimeSecond(second,item){
        this.setInterFun(item)
        if(second<60){
            return '倒计时'+second+'秒';
        }else{
            return '倒计时'+parseInt(second/60)+'分'+(second%60)+'秒';
        }
    },
    //定时函数
    setInterFun(item){
        var vueThis = this;
        if(!vueThis.timer){
            vueThis.timer = setInterval(()=>{
                item.secondbuy -= 1;
                if(item.secondbuy<=0){
                    item.isbuy = 1;
                    clearInterval(vueThis.timer);
                }
            },1000);
        }
    }

  }
})
</script>

</html>