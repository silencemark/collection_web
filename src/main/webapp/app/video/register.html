<!DOCTYPE html>
 <html lang="en">
 <head>
     <meta charset="UTF-8">
     <title>享GO影视</title>
     <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=no,width=device-width,initial-scale=1.0"/>
     <link rel="stylesheet" type="text/css" href="css/login.css"/>
     <link rel="stylesheet" type="text/css" href="css/public.css"/>
     <script src="js/jquery-3.4.1.js"></script>
     <script src="js/vue.js"></script>
     <script src="js/jq-alert.js"></script>
 </head>
 <body>

<section class="main"  id="app">
    <div class="logoCont">
        <img src="img/logo.png" />
    </div>
    <div class="inputCont" style="margin-top:30px;">
        <!-- <div>请输入手机号码</div> -->
        <input type="tel" v-model="user.phone" maxlength="11" placeholder="输入注册手机号码" onkeyup="value=value.replace(/[^\d]/g,'')" >
        <span class="errMsgCont">{{phoneErrMsg}}</span>
    </div>
    <div class="inputCont">
        <!-- <div>请设置登录密码</div> -->
        <input type="password"  v-model="user.password" placeholder="设置6-16位密码" maxlength="16"/>
        <span class="errMsgCont">{{passwordErrMsg}}</span>
    </div>
    <div class="inputCont">
        <!-- <div>确认登录密码</div> -->
        <input type="password"  v-model="user.confirmPassword" placeholder="确认登录密码" maxlength="16"/>
        <span class="errMsgCont">{{confirmPwdErrMsg}}</span>
    </div>
    <div class="inputCont">
        <!-- <div>您的邀请码</div> -->
        <input :value="user.invitecode" readonly  placeholder="您的邀请码" maxlength="16"/>
    </div>
    <div class="inputCont">
        <!-- <div>请输入验证码</div> -->
        <input type="tel" v-model="user.checkcode" placeholder="输入4位数验证码" maxlength="4" style="width:65%;" />
        <div class="btn sendYzm" @click="sendYzm" >{{sendYzmMsg}}</div>
        <span class="errMsgCont">{{yzmErrMsg}}</span>
    </div>
    <div style="width: 84%;text-align:left;margin:-36px 8% 20px;font-size: 0.9rem;color:#777">
        <span onclick="window.location.href='login.html'">已有账号,立即登录</span>&nbsp;&nbsp;
    </div>
    <div class="but-cont">
        <div class="btn btn-200" @click="regSubmit">立 即 注 册</div>
    </div>
</section>
</body>

<script>
    new Vue({
      el: '#app',
      data: function() {
        return {
            sendYzmMsg :'获取验证码',
            sendYzmSleep:0,//验证码按钮睡眠时间
            user:{
                phone:'',
                password:'',
                confirmPassword:'',
                invitecode:'',
                checkcode:''
            },
            phoneErrMsg:'',
            passwordErrMsg:'',
            confirmPwdErrMsg:'',
            yzmErrMsg:'',
        }
      },
      created() {
          this.user.invitecode = this.GetQueryString('invitecode');
      },
      methods:{
          //发送验证码
          sendYzm(){
            if(this.sendYzmSleep>0) return;
            var myreg = /^[1][3,4,5,7,8][0-9]{9}$/;
            if (!myreg.test(this.user.phone)) {
                this.yzmErrMsg = '手机号码不正确';
                return false;
            }
            //发送短信
            var sendSuc = false;
            jAjax("/appLogin/getVerificationCode",this.user,function(data){
                if(data.status==0){
                    sendSuc = true;
                    jqtoast('验证码已发送至您的手机！');
                }else{
                    jqtoast(data.message);
                }
            });
            if(sendSuc){
                this.sendYzmSleep = 60;
                this.sendYzmMsg = '倒计时'+this.sendYzmSleep+'S';
                var timer = setInterval(()=>{
                    this.sendYzmSleep -= 1;
                    this.sendYzmMsg = '倒计时'+this.sendYzmSleep+'S';
                    if(this.sendYzmSleep<=0){
                        clearInterval(timer);
                        this.sendYzmMsg = '获取验证码';
                        this.sendYzmSleep = 0;
                    }
                },1000);
            }
          },
          //提交注册
           regSubmit(){
            if(this.chkRegForm()){
                jAjax("/appLogin/register",this.user,function(data){
                    if(data.status==0){
                        jqalert({
                            prompt:'注册成功,请前往浏览器下载APP！',
                            yesfn:function () {
                                window.location.href='login.html';
                            }
                        })
                    }else{
                        jqtoast(data.message);
                    }
                })
            }
          },
          //验证注册参数
          chkRegForm(){
            var flg = true;
            var myreg = /^[1][3,4,5,7,8][0-9]{9}$/;
            if (!myreg.test(this.user.phone)) {
                this.phoneErrMsg = '手机号码不正确';  flg = false;
            }else this.phoneErrMsg = '';
            if(!this.user.password || this.user.password.length<6  || this.user.password.length>16){
                this.passwordErrMsg = '密码必须是6至16位'; flg = false;
            }else this.passwordErrMsg = '';
            if(this.user.confirmPassword != this.user.password) {
                this.confirmPwdErrMsg = '两次密码不一致';  flg = false
            }else this.confirmPwdErrMsg = '';
            if(this.user.checkcode.length!=4) {
                this.yzmErrMsg = '验证码有误'; flg = false;
            }else this.yzmErrMsg = '';
            return flg;
          },
          //获取URL参数
          GetQueryString(name){
            var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if(r!=null)return  unescape(r[2]); return null;
        }

      }
    })
  </script>

</html>


<!-- 
加载窗口
 /*
            jqalert({
                title:'提示',
                prompt:'您的信息有误确定要提交嘛？',
                yestext:'提交',
                notext:'取消',
                yesfn:function () {
                    jqtoast('提交成功');
                },
                nofn:function () {
                    jqtoast('取消了');
                }
            }) 
            */
-->