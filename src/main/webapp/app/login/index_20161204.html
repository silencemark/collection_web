<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>首页</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" >
<link type="text/css" rel="stylesheet" href="../appcssjs/style/public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/index.css">
<script type="text/javascript" src="../appcssjs/script/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="../appcssjs/script/page.js"></script>
<script type="text/javascript" src="../appcssjs/script/appendjs.js"></script>
<script type="text/javascript" src="../appcssjs/script/cache.js"></script>
<link rel="stylesheet" href="../appcssjs/sweetalert/dist/sweetalert.css">
<script src="../appcssjs/sweetalert/dist/sweetalert-dev.js"></script> 
<script type='text/javascript' src='../appcssjs/script/touchScroll.js'></script>
<script type='text/javascript' src='../appcssjs/script/touchslider.dev.js'></script>
<script type="text/javascript" src="../appcssjs/script/index.js"></script>

<script type="text/javascript" src="../appcssjs/script/constant.js"></script>
<script type="text/javascript">
	var isSetRegId = false;
	var userInfo;
	JianKangCache.getGlobalData('userinfo',function(data){
			userInfo=data;
			if(data==null){
				location.href="login.html";
			}
		}
	)

	var pageWidth = window.innerWidth;
	var pageHeight = window.innerHeight;
	var menuWidth;
	var menuspanWidth ;
	if (typeof pageWidth != "number")
	{
		if(document.compatMode == "CSS1Compat")
		{
			pageWidth = document.documentElement.clientWidth;
			pageHeight = document.documentElement.clientHeight;
		}
		else
		{
			pageWidth = document.body.clientWidth;
			pageHeight = document.body.clientHeight;
		}
	}
	menuWidth = pageWidth/3;
	
	$(document).ready(function(){
	 $(".index_menu li").width(menuWidth);
	 menuspanWidth = $(".index_menu .span_box").children().length;
	 $(".index_menu .span_box").width(menuspanWidth*28);
});
	
function getnotice(){
	//更新底部新消息数量
	try{
		RongIMClient.getInstance().getTotalUnreadCount({
			  onSuccess:function(count){
				  if(parseInt(count)>0){
					  $('#messagecount').text(count);
					  $('#messagecount').show();
				  }
			  },
			  onError:function(error){
			      // error => 获取总未读数错误码。
			  }
		});
	}catch(e){
		console.log(e);
	}
	
	//查询代办事项
	getTodoList();
	
	$.ajax({
		type:'post',
		dataType:'json',
		url:projectpath+'/app/getHomePageBanner?model=1&companyid='+userInfo.companyid,
		success:function(data){
			if(data.length>0){
				var slidertemp="";
				var pagediv="";
				for(var i=0;i<data.length;i++){
					slidertemp+="<li style=\"display: block;\"><img src=\""+projectpath+"/"+data[i].imgurl+"\"  alt=\"\" width=\"100%\"></li>";
					pagediv+="<a href=\"javascript:void(0);\">"+data[i].id+"</a>";
				}
				var windowheight=(parseInt($(window).height())*24)/100;
				$('#slider').css("height",windowheight+"px");
				$('#slider').html(slidertemp);
				$('#pagenavi').html(pagediv);
				var active=0,
				as=document.getElementById('pagenavi').getElementsByTagName('a');
				
				for(var i=0;i<as.length;i++){
					(function(){
						var j=i;
						as[i].onclick=function(){
							t2.slide(j);
							return false;
						}
					})();
				}
	
				var t1=new TouchScroll({id:'wrapper','width':5,'opacity':0.7,color:'#555',minLength:20});
				var t2=new TouchSlider({id:'slider', speed:600, timeout:6000, before:function(index){
						as[active].className='';
						active=index;
						as[active].className='active';
				}});
			}
		 	var pagediv=$('#pagenavi a');
			for(var i=0;i<pagediv.length;i++){
				if(pagediv[i].text==userInfo.bannerid){
					t2.slide(i);
					return false;
				}
			}
		}
	})
	$.ajax({
		type:'post',
		dataType:'json',
		url:projectpath+'/app/getHomeNotreadNum?companyid='+userInfo.companyid+'&receiveid='+userInfo.userid,
		success:function(data){
			if(data.status==1){
				swal({
					title : "",
					text : data.message,
					type : "error",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					
				});
			}else{
				if(parseInt(data.purchasenum)> 0){
					$('#purchasenum').show();
					$('#purchasenum').html(data.purchasenum);
				}
				if(parseInt(data.warehousenum)> 0){
					$('#warehousenum').show();
					$('#warehousenum').html(data.warehousenum);
				}
				if(parseInt(data.worksheetnum)> 0){
					$('#worksheetnum').show();
					$('#worksheetnum').html(data.worksheetnum);
				}
				if(parseInt(data.OAofficenum)> 0){
					$('#OAofficenum').show();
					$('#OAofficenum').html(data.OAofficenum);
				}
				if(parseInt(data.storefrontnum)> 0){
					$('#storefrontnum').show();
					$('#storefrontnum').html(data.storefrontnum);
				}
				if(parseInt(data.starassessnum)> 0){
					$('#starassessnum').show();
					$('#starassessnum').html(data.starassessnum);
				}
			}
		}
	})
	
}

//查询代办事项
function getTodoList(){
	$.ajax({
		type:'post',
		dataType:'json',
		url:projectpath+'/app/getRemindList?userid='+userInfo.userid,
		success:function(data){
			if(data.remindlist.length>0){
				var temp="";
				for(var i=0;i<data.remindlist.length;i++){
					temp+="<li class=\"word_hidden\" onclick=\"window.location.href='../"+data.remindlist[i].linkurl+"'\">【"+data.remindlist[i].title+"】"+data.remindlist[i].content+"</li>";
				}
				if(parseInt(data.remindnum) > 0){
					$('#noticenum').html(data.remindnum);
					$('#noticenum').show();
				}
				$('#noticeul').append(temp);
			}
		}
	});
}
PageHelper({
	url:projectpath+'/app/getRemindList?userid='+userInfo.userid,
	success:function(data){
		if(data.remindlist.length>0){
			var temp="";
			for(var i=0;i<data.remindlist.length;i++){
				temp+="<li class=\"word_hidden\" onclick=\"location.href='../"+data.remindlist[i].linkurl+"'\">【"+data.remindlist[i].title+"】"+data.remindlist[i].content+"</li>";
			}
			$('#noticenum').html(data.remindnum);
			$('#noticeul').append(temp);
		}
	}
});  
</script>
</head>

<body onload="getnotice()">
<div class="head_none2"></div>
<div class="contentWrap" style="height:161px;">
    <ul id="slider" >
<!--     	<li style="display:block"><img src="../appcssjs/images/index/banner_img.png"  alt="" width="100%"></li> -->
    </ul>
    <div id="pagenavi">
<!--     	 <a href="javascript:void(0);" class="active">1</a> -->
    </div>
</div>
<div class="index_menu">
	<ul>
    	<li onclick="location.href='../purchase/purchase_index.html'"><b class="bg1" ><img src="../appcssjs/images/index/menu_01.png"><i id="purchasenum" style="display: none"></i></b><span style="font-size:15px;">采购管理</span></li>
        <li onclick="location.href='../warehouse/warehouse_index.html'" class="mid" ><b class="bg2"><img src="../appcssjs/images/index/menu_02.png"><i id="warehousenum"  style="display: none"></i></b><span style="font-size:15px;">仓库管理</span></li>
        
        
        <li onclick="location.href='../oa/index.html'"><b class="bg4"><img src="../appcssjs/images/index/menu_04.png"><i id="OAofficenum" style="display: none"></i></b><span style="font-size:15px;">OA办公</span></li>
        <li onclick="location.href='../worksheet/index.html'"><b class="bg3"><img src="../appcssjs/images/index/menu_03.png"><i id="worksheetnum" style="display: none"></i></b><span style="font-size:15px;">工作表单</span></li>
        <li onclick="location.href='../restaurant/restaurant_index.html'"class="mid"><b class="bg5"><img src="../appcssjs/images/index/menu_05.png"><i id="storefrontnum" style="display: none"></i></b><span style="font-size:15px;">店面管理</span></li>
        <li onclick="location.href='../kpi/index.html'"><b class="bg6"><img src="../appcssjs/images/index/menu_06.png"><i id="starassessnum" style="display: none"></i></b><span style="font-size:15px;">KPI星级考核</span></li>
    </ul>
    
    <div class="clear"></div>
</div>
<div class="clear"></div>
<div class="db_list">
	<div class="name"><span>待办事项<i id="noticenum" style="display:none;color:white;border:0px;background: #fa302e;font-weight: normal;line-height:20px;width:20px;height:20px;">0</i></span></div>
    <ul id="noticeul">
    	
    </ul>
</div>

<div class="bt_none"></div>
<div class="bt_menu">
	<ul>
    	<li class="dq"><a ><b class="bg_home"></b><span>首页</span></a></li>
        <li><a href="../message/index.html"><b class="bg_msg"></b><span>消息</span></a><em id="messagecount" style="display:none"></em></li>
        <li><a href="../memorandum/memorandum_index.html"><b class="bg_memo"></b><span>备忘录</span></a></li>
        <li><a href="../share/index.html"><b class="bg_share"></b><span>分享圈</span></a><em id="sharenum" style="display: none;"></em></li>
        <li><a href="../member/member_index.html"><b class="bg_user"></b><span>我的</span></a></li>
    </ul>
</div>
<script type="text/javascript">
	$(function(){
		var param = new Object();
		param.createid = userInfo.userid;
		$.ajax({
			url:projectpath+"/app/getShareNotReadNumByUser",
			type:"post",
			data:param,
			success:function(data){
				var num = data.num;
				if(num > 0){
					$('#sharenum').show().text(num);
				}
			}
		});
	});
</script>
</body>
</html>
