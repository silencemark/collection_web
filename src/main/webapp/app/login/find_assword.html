<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>忘记密码</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" >
<link type="text/css" rel="stylesheet" href="../appcssjs/style/public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/login.css">
<script type="text/javascript" src="../appcssjs/script/jquery-1.10.2.min.js"></script>
<link rel="stylesheet" href="../appcssjs/sweetalert/dist/sweetalert.css">
<script src="../appcssjs/sweetalert/dist/sweetalert-dev.js"></script>  

<script type="text/javascript" src="../appcssjs/script/appendjs.js"></script>
<script type="text/javascript" src="../appcssjs/script/cache.js"></script>
<script type="text/javascript" src="../appcssjs/script/constant.js"></script>
</head>
<script type="text/javascript">
function getVaildeCode(obj){
	
	var phone=$('#phone').val();
	if(phone==""){
		swal({
			title : "",
			text : "请输入手机号",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			$('#phone').focus();
		});
		return;
	}
	$.ajax({
		type:'post',
		dataType:'json',
		url:projectpath+'/app/getVerificationCode?type=1&phone='+phone,
		success:function(data){
			if(data.status==1){
				swal({
					title : "",
					text : data.message,
					type : "error",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					
				});
			}else{
				swal({
					title : "",
					text : "获取验证码成功",
					type : "success",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					$('#validecode').focus();
				});
				sendSms(60,$(obj)); 
			}
		}
	})
}
function sendSms(i,dom){
  	if(i==0){
  		$(dom).val("获取验证码");
  		$(dom).css("background-color","#ff9b30");
  		$(dom).attr("disabled",false);
  		return;
  	}else{ 
  		$(dom).val(i+"s后再试");
  		$(dom).css("background-color","#ffc383");
  		$(dom).attr("disabled",true);
  	}
  	setTimeout(function(){
  		sendSms(i-1,dom);
  	},1000);
  }
function nextstep(){
	var phone=$('#phone').val();
	var validecode=$('#validecode').val();
	if(phone==""){
		swal({
			title : "",
			text : "请输入手机号",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			$('#phone').focus();
		});
		return;
	}
	if(validecode==""){
		swal({
			title : "",
			text : "请输入验证码",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			$('#validecode').focus();
		});
		return;
	}
	$.ajax({
		type:'post',
		dataType:'json',
		url:projectpath+'/app/getCompanyByPhone?code='+validecode+'&phone='+phone,
		success:function(data){
			if(data.status==1){
				swal({
					title : "",
					text : data.message,
					type : "error",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					
				});
			}else{
				JianKangCache.setGlobalData("findcompanylist",data.companylist);
				location.href="find_choice.html";
			}
		}
	})
}
</script>
<body class="body_bg">
<div class="head_box">
	<a class="ico_back" onclick="goBackPage();">返回</a>
    <div class="name">忘记密码</div>
</div>
<div class="head_none"></div>
<div class="text_box pad_top20">
	<span class="wid_02"><i>手&nbsp;&nbsp;机</i><input type="number" placeholder="请输入手机号" id="phone" maxlength="11"></span>
    <span class="wid_02"><i>验证码</i><input type="number" placeholder="请输入验证码" id="validecode"><input type="button" value="获取验证码" class="yzm_btn" onclick="getVaildeCode(this);" style="background: #ff9b30;"></span>
    <b><input type="button" value="下一步" onclick="nextstep()"></b>
</div>
</body>
</html>
