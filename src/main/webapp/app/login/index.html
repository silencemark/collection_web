<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>首页</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/index.css">
<script type="text/javascript" src="../appcssjs/script/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="../appcssjs/script/page.js"></script>
<script type="text/javascript" src="../appcssjs/script/appendjs.js"></script>
<script type="text/javascript" src="../appcssjs/script/cache.js"></script>
<link rel="stylesheet" href="../appcssjs/sweetalert/dist/sweetalert.css">
<script src="../appcssjs/sweetalert/dist/sweetalert-dev.js"></script>
<script type='text/javascript' src='../appcssjs/script/touchScroll.js'></script>
<script type='text/javascript' src='../appcssjs/script/touchslider.dev.js'></script>
<script type="text/javascript" src="../appcssjs/script/index.js"></script>
<link type="text/css" rel="stylesheet" href="../appcssjs/style/public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/page_public.css">

<script type="text/javascript" src="../appcssjs/script/constant.js"></script>
<script type="text/javascript">
	var isSetRegId = false;
	var userInfo;
	JianKangCache.getGlobalData('userinfo', function(data) {
		userInfo = data;
		if (data == null) {
			//location.href = "login.html";
		}
	})

	var pageWidth = window.innerWidth;
	var pageHeight = window.innerHeight;
	var menuWidth;
	var menuspanWidth;
	if (typeof pageWidth != "number") {
		if (document.compatMode == "CSS1Compat") {

			pageWidth = document.documentElement.clientWidth;
			pageHeight = document.documentElement.clientHeight;
		} else {

			pageWidth = document.body.clientWidth;
			pageHeight = document.body.clientHeight;
		}
	}
	menuWidth = pageWidth / 4;

	$(document).ready(function() {
		//$(".index_menu li").width(menuWidth);
		menuspanWidth = $(".index_menu .span_box").children().length;
		$(".index_menu .span_box").width(menuspanWidth * 28);
	});

	function getnotice() {
		//更新底部新消息数量
		try {
			RongIMClient.getInstance().getTotalUnreadCount({
				onSuccess : function(count) {
					if (parseInt(count) > 0) {
						$('#messagecount').text(count);
						$('#messagecount').show();
					}
				},
				onError : function(error) {
					// error => 获取总未读数错误码。
				}
			});
		} catch (e) {
			console.log(e);
		}

		//查询代办事项
		getTodoList();

		$.ajax({
			type : 'post',
			dataType : 'json',
			url : projectpath
					+ '/app/getHomePageBanner?model=1&companyid='
					+ userInfo.companyid,
			success : function(data) {
				if (data.length > 0) {
					var slidertemp = "";
					var pagediv = "";
					for (var i = 0; i < data.length; i++) {
						slidertemp += "<li style=\"display: block;\"><img src=\""
								+ projectpath
								+ "/"
								+ data[i].imgurl
								+ "\"  alt=\"\" width=\"100%\"></li>";
						pagediv += "<a href=\"javascript:void(0);\">"
								+ data[i].id + "</a>";
					}
					var windowheight = (parseInt($(window).height()) * 24) / 100;
					$('#slider').css("max-height", windowheight + "px");
					$('#slider').html(slidertemp);
					$('#pagenavi').html(pagediv);
					var active = 0, as = document.getElementById(
							'pagenavi').getElementsByTagName('a');

					for (var i = 0; i < as.length; i++) {
						(function() {
							var j = i;
							as[i].onclick = function() {
								t2.slide(j);
								return false;
							}
						})();
					}

					var t1 = new TouchScroll({
						id : 'wrapper',
						'width' : 5,
						'opacity' : 0.7,
						color : '#555',
						minLength : 20
					});
					var t2 = new TouchSlider({
						id : 'slider',
						speed : 600,
						timeout : 6000,
						before : function(index) {
							as[active].className = '';
							active = index;
							as[active].className = 'active';
						}
					});
				}
				var pagediv = $('#pagenavi a');
				for (var i = 0; i < pagediv.length; i++) {
					if (pagediv[i].text == userInfo.bannerid) {
						t2.slide(i);
						return false;
					}
				}
			}
		})
		$.ajax({
			type : 'post',
			dataType : 'json',
			url : projectpath + '/app/getHomeNotreadNum?companyid='
					+ userInfo.companyid + '&receiveid=' + userInfo.userid,
			success : function(data) {
				if (data.status == 1) {
					swal({
						title : "",
						text : data.message,
						type : "error",
						showCancelButton : false,
						confirmButtonColor : "#ff7922",
						confirmButtonText : "确认",
						cancelButtonText : "取消",
						closeOnConfirm : true
					}, function() {

					});
				} else {
					if (parseInt(data.purchasenum) > 0) {
						$('#purchasenum').show();
						$('#purchasenum').html(data.purchasenum);
					}
					if (parseInt(data.warehousenum) > 0) {
						$('#warehousenum').show();
						$('#warehousenum').html(data.warehousenum);
					}
					if (parseInt(data.worksheetnum) > 0) {
						$('#worksheetnum').show();
						$('#worksheetnum').html(data.worksheetnum);
					}
					if (parseInt(data.OAofficenum) > 0) {
						$('#OAofficenum').show();
						$('#OAofficenum').html(data.OAofficenum);
					}
					if (parseInt(data.storefrontnum) > 0) {
						$('#storefrontnum').show();
						$('#storefrontnum').html(data.storefrontnum);
					}
					if (parseInt(data.starassessnum) > 0) {
						$('#starassessnum').show();
						$('#starassessnum').html(data.starassessnum);
					}
				}
			}
		})

	}

	//查询代办事项
	function getTodoList() {
		$.ajax({
			type : 'post',
			dataType : 'json',
			url : projectpath + '/app/getRemindList?userid='+ userInfo.userid,
			success : function(data) {
				if (data.remindlist.length > 0) {
					$("#nonemsg").hide();
					var temp = "";
					for (var i = 0; i < data.remindlist.length; i++) {
						temp += "<li class=\"word_hidden\" onclick=\"window.location.href='../"+data.remindlist[i].linkurl+"'\">【"
								+ data.remindlist[i].title
								+ "】"
								+ data.remindlist[i].content + "</li>";
					}
					if (parseInt(data.remindnum) > 0) {
						$('#noticenum').html(data.remindnum);
						$('#noticenum').show();
					}
					$('#noticeul').append(temp);
				}else{
					$("#nonemsg").show();
				}
			}
		});
	}
	PageHelper({
		url : projectpath + '/app/getRemindList?userid=' + userInfo.userid,
		success : function(data) {
			if (data.remindlist.length > 0) {
				var temp = "";
				for (var i = 0; i < data.remindlist.length; i++) {
					temp += "<li class=\"word_hidden\" onclick=\"location.href='../"+data.remindlist[i].linkurl+"'\">【"
							+ data.remindlist[i].title
							+ "】"
							+ data.remindlist[i].content + "</li>";
				}
				$('#noticenum').html(data.remindnum);
				$('#noticeul').append(temp);
			}
		}
	});
</script>
</head>

<body onload="getnotice()" style="-webkit-overflow-scrolling: touch;">
	<div class="head_none2"></div>
	<div class="contentWrap" style="min-height: 125px;">
		<ul id="slider">
			<!--     	<li style="display:block"><img src="../appcssjs/images/index/banner_img.png"  alt="" width="100%"></li> -->
		</ul>
		<div id="pagenavi">
			<!--     	 <a href="javascript:void(0);" class="active">1</a> -->
		</div>
	</div>
	<script type="text/javascript" src="../appcssjs/script/touchScroll.js"></script>
	<script type="text/javascript" src="../appcssjs/script/touchslider.dev.js"></script>
	<script type="text/javascript" src="../appcssjs/script/run.js"></script>
	<div class="index_menu menu_height" id="left_and_right" style="">
		<ul id="left" style="display: block; float: left;">
			<li onclick="location.href='../purchase/purchase_index.html'"><b class="bg1"><img src="../appcssjs/images/index/menu_01.png"><i id="purchasenum" style="display: none"></i></b><span style="font-size: 15px;height: 20px;">采购管理</span></li>
			<li onclick="location.href='../warehouse/warehouse_index.html'" ><b class="bg2"><img src="../appcssjs/images/index/menu_02.png"><i id="warehousenum" style="display: none"></i></b><span style="font-size: 15px;height: 20px;">仓库管理</span></li>
			<li onclick="location.href='../menu/index.html'"><b class="bg7"><img src="../appcssjs/images/index/menu_07.png"><i style="display: none"></i></b><span style="font-size: 15px;height: 20px;">菜单管理</span></li>
			<li onclick="location.href='../collectmoney/index.html'"><b class="bg8"><img src="../appcssjs/images/index/menu_08.png"><i style="display: none"></i></b><span style="font-size: 15px;height: 20px;">收银管理</span></li>
			<li onclick="location.href='../oa/index.html'"><b class="bg4"><img src="../appcssjs/images/index/menu_03.png"><i id="OAofficenum" style="display: none"></i></b><span style="font-size: 15px;height: 20px;">OA办公</span></li>
			<li onclick="location.href='../worksheet/index.html'"><b class="bg3"><img src="../appcssjs/images/index/menu_04.png"><i id="worksheetnum" style="display: none"></i></b><span style="font-size: 15px;height: 20px;">工作表单</span></li>
			<li onclick="location.href='../restaurant/restaurant_index.html'" ><b class="bg5"><img src="../appcssjs/images/index/menu_05.png"><i id="storefrontnum" style="display: none"></i></b><span style="font-size: 15px;height: 20px;">店面管理</span></li>
			<li onclick="location.href='../kpi/index.html'"><b class="bg6"><img src="../appcssjs/images/index/menu_06.png"><i id="starassessnum" style="display: none"></i></b><span style="font-size: 15px;height: 20px;">星级考核</span></li>
		</ul>
		<ul id="right" style="display: none; width: 0px; float: right;">
			<li onclick="location.href='../customer/index.html'"><b class="bg9"><img src="../appcssjs/images/index/menu_09.png"></b><span style="font-size: 15px;height: 20px;">客户管理</span></li>
			<li onclick="location.href='../market/index.html'"><b class="bg10"><img src="../appcssjs/images/index/menu_10.png"></b><span style="font-size: 15px;height: 20px;">营销管理</span></li>
		</ul>
		<div class="span_box">
			<span class="active" id="brandone" onclick="checkul(this)" style="width: 8px; height: 8px;">1</span><span id="brandtwo" onclick="checkul(this)" style="width: 8px; height: 8px;">2</span>
		</div>
		<div class="clear"></div>
	</div>
	<div class="clear"></div>
	<div class="db_list">
		<div class="name"> <span>待办事项<i id="noticenum" style="display: none; color: white; border: 0px; background: #fa302e; font-weight: normal; line-height: 20px; width: 20px; height: 20px;">0</i></span></div>
		<div class="none_msg" id="nonemsg" style="display: none;"><b><img src="../appcssjs/images/public/none_msg.png"></b><span>您暂时还没有通知以及待审批的事项<br>（请先休息会儿吧）</span></div>
		<ul id="noticeul">

		</ul>
	</div>

	<div class="bt_none"></div>
	<div class="bt_menu">
		<ul>
			<li class="dq"><a><b class="bg_home"></b><span>首页</span></a></li>
			<li><a href="../message/index.html"><b class="bg_msg"></b><span>消息</span></a><em id="messagecount" style="display: none"></em></li>
			<li><a href="../memorandum/memorandum_index.html"><b class="bg_memo"></b><span>备忘录</span></a></li>
			<li><a href="../share/index.html"><b class="bg_share"></b><span>分享圈</span></a><em id="sharenum" style="display: none;"></em></li>
			<li><a href="../member/member_index.html"><b class="bg_user"></b><span>我的</span></a></li>
		</ul>
	</div>
	<script type="text/javascript">
		$(function() {
			var param = new Object();
			param.createid = userInfo.userid;
			$.ajax({
				url : projectpath + "/app/getShareNotReadNumByUser",
				type : "post",
				data : param,
				success : function(data) {
					var num = data.num;
					if (num > 0) {
						$('#sharenum').show().text(num);
					}
				}
			});
		});
	</script>
	<script type="text/javascript">
		$(function() {
			var startX, startY, endX, endY;
			var isstart = 0;
			var ismove = 0;
			document.getElementById("left_and_right").addEventListener(
					"touchstart", touchStart, false);
			document.getElementById("left_and_right").addEventListener(
					"touchmove", touchMove, false);
			document.getElementById("left_and_right").addEventListener(
					"touchend", touchEnd, false);
			function touchStart(event) {
				isstart = 1;
				var touch = event.touches[0];
				startY = touch.pageY;
				startX = touch.pageX;
			}
			function touchMove(event) {
				ismove = 1;
				var touch = event.touches[0];
				//endY = (startY - touch.pageY);
				endX = touch.pageX;
			}
			function touchEnd(event) {
				if (isstart == 1 && ismove == 1) {
					var pagenum = 0;
					if ((startX - endX) > 20) {
						$("#brandtwo").click();
						pagenum = 2;
					} else if ((endX - startX) > 20) {
						$("#brandone").click();
						pagenum = 1;
					}
					JianKangCache.setGlobalData("mainpage", pagenum);
				}
				isstart = 0;
				ismove = 0;
			}
		})
	</script>

	<script type="text/javascript">
		JianKangCache.getGlobalData("mainpage", function(data) {
			var nonewidth = $(window).width();
			if (data.mainpage == 1) {
				$("#brandtwo").parent().find("span").attr("class", "");
				$("#brandone").attr("class", "active");
				$('#left').show();
				$("#left").css({
					"width" : nonewidth
				});
				$("#right").css({
					"width" : 0
				});
				$('#right').hide();
			} else if (data.mainpage == 2) {
				$("#brandone").parent().find("span").attr("class", "");
				$("#brandtwo").attr("class", "active");
				$('#right').show();
				$("#right").css({
					"width" : nonewidth
				});
				$("#left").css({
					"width" : 0
				});
				$('#left').hide();
			}
		});
		function checkul(obj) {
			var nonewidth = $(window).width();
			$(obj).parent().find("span").attr("class", "");
			$(obj).attr("class", "active");

			if ($(obj).text() == 1) {
				$('#left').show();
				$("#left").animate({
					width : nonewidth
				}, "normal");
				$("#right").animate({
					width : 0
				}, "normal");
				
				$('#right').hide();
			} else {
				$('#right').show();
				$("#right").animate({
					width : nonewidth
				}, "normal");
				$("#left").animate({
					width : 0
				}, "normal");
				$('#left').hide();

			}
		}

		function intohonourpage() {
			location.href = 'honour.html';
		}

		function intoWelfarePage() {
			location.href = 'welfare.html';
		}
	</script>
</body>
</html>
