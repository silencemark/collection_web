<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>首页</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" >
 <script type="text/javascript" src="appcssjs/script/jquery-1.10.2.min.js"></script>
 <script type="text/javascript" src="../../cordova.js"></script>
 <script type="text/javascript" src="../../cordova_plugins.js"></script>
<script type="text/javascript">
	
	var pictureSource; // picture source
	
	var destinationType; // sets the format of returned value

	document.addEventListener("deviceready", onDeviceReady, false);

	function onDeviceReady() {
		pictureSource = navigator.camera.PictureSourceType;
		destinationType = navigator.camera.DestinationType;
	}
	function onPhotoDataSuccess(imageData) {

		var smallImage = document.getElementById('smallImage');
		smallImage.style.display = 'block';
		smallImage.src = imageData;
	}

	function onPhotoURISuccess(imageURI) {
		var largeImage = document.getElementById('largeImage');
		largeImage.style.display = 'block';
		largeImage.src = imageURI;
	}


	function capturePhoto() {

		navigator.camera.getPicture(uploadPhoto, onFail, {

			quality : 50,

			destinationType : navigator.camera.DestinationType.FILE_URI,//这里要用FILE_URI，才会返回文件的URI地址

			//destinationType : Camera.DestinationType.DATA_URL,

			sourceType : Camera.PictureSourceType.CAMERA,

			allowEdit : true,

			encodingType : Camera.EncodingType.JPEG,

			popoverOptions : CameraPopoverOptions,

			saveToPhotoAlbum : true

		});

	}

	function capturePhotoEdit() {

		navigator.camera.getPicture(uploadPhoto, onFail, {

			quality : 50,

			allowEdit : true,

			destinationType : destinationType.DATA_URL,

			saveToPhotoAlbum : true

		});

	}

	function getPhoto(source) {

		navigator.camera.getPicture(uploadPhoto, onFail, {

			quality : 50,

			destinationType : destinationType.FILE_URI,//这里要用FILE_URI，才会返回文件的URI地址

			sourceType : source

		});

	}

	function onFail(message) {

		alert('Failed because: ' + message);

	}

	function uploadPhoto(imageURI) {

		var options = new FileUploadOptions();
		
		options.fileKey = "fileAddPic";//用于设置参数，对应form表单里控件的name属性，这是关键，废了一天时间，完全是因为这里，这里的参数名字，和表单提交的form对应

		options.fileName = imageURI.substr(imageURI.lastIndexOf('/') + 1);
		

		//如果是图片格式，就用image/jpeg，其他文件格式上官网查API

		options.mimeType = "image/jpeg";

		//options.mimeType = "multipart/form-data";//这两个参数修改了，后台就跟普通表单页面post上传一样 enctype="multipart/form-data"

		//这里的uri根据自己的需求设定，是一个接收上传图片的地址

		var uri = encodeURI("http://192.168.1.58/com-hoheng-file-upload/file/upload");

		//alert(imageURI);

		//alert(uri);

		options.chunkedMode = false;
		
		var params = new Object();

		 params.FileDirectory = "FileDirectory";

		 options.params = params;

		var ft = new FileTransfer();

		ft.upload(imageURI, uri, win, fail, options);

	}

	function win(r) {
        
        alert(r.response);
        $("#value").val(r.response);
		var imageURI = JSON.parse(r.response)[0].httpUrl;
		alert(imageURI);
		onPhotoDataSuccess(imageURI); 
		onPhotoURISuccess(imageURI); 

	}

	function fail(error) {

		alert("An error has occurred: Code = " + error.code);

		alert("upload error source " + error.source);

		alert("upload error target " + error.target);

		console.log("upload error source " + error.source);

		console.log("upload error target " + error.target);

	}
</script>

</head>

<body>
 
			<button onclick="capturePhoto();">点击拍照</button> 
			<button onclick="getPhoto(pictureSource.PHOTOLIBRARY);">从相册选择图片</button>
            <input id="value">
			<img style="display: none; width: 120px; height: 120px;"
				id="smallImage" src="" /> <img
				style="display: none; width: 240px; height: 240px;" id="largeImage"
				src="" />

		 

</body>

</html>