<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>新建采购(入库)单</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" >
<link type="text/css" rel="stylesheet" href="../appcssjs/style/public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/purchase.css">
<script type="text/javascript" src="../appcssjs/script/jquery-1.10.2.min.js"></script>
<link rel="stylesheet" href="../appcssjs/sweetalert/dist/sweetalert.css">
<script src="../appcssjs/sweetalert/dist/sweetalert-dev.js"></script>  
<script type="text/javascript" src="../appcssjs/script/tab.js"></script>
<script type="text/javascript" src="../appcssjs/script/page.js"></script>
<script type="text/javascript" src="../appcssjs/script/appbase.js"></script>
<script type="text/javascript" src="../appcssjs/script/appendjs.js"></script>
<script type="text/javascript" src="../appcssjs/script/cache.js"></script>
<script type="text/javascript" src="../appcssjs/script/constant.js"></script>

<link href="../appcssjs/style/mobiscroll.custom-2.6.2.min.css" type="text/css" rel="stylesheet"> 
<script src="../appcssjs/script/mobiscroll.custom-2.6.2.min.js"></script> 
</head>
<script type="text/javascript">
var userInfo;
JianKangCache.getGlobalData('userinfo',function(data){
		userInfo=data;
})
var orderno="";
var organizeid="";
var createtime="";
function onloadData(){
	if(userInfo!= null && typeof(userInfo) != "undefined"){
		$('#createname').text(userInfo.realname);
		$('#createname').attr("onclick","location.href='../member/homepage_info.html?userid="+userInfo.userid+"'");
	}
	$.ajax({
		type:'post',
		dataType:'json',
		url:projectpath+'/app/initInsertPurchase?companyid='+userInfo.companyid,
		success:function(data){
			if(data.status==1){
				swal({
					title : "",
					text : data.message,
					type : "error",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					
				});
			}else{
				orderno=data.orderno;
				createtime=fomartDate(data.createtime);
				$('#createtime').text(fomartDate(createtime));
				$('#orderno').html("采购(入库)单编号："+orderno);
				if(userInfo.organizeid != null && typeof(userInfo.organizeid) != "undefined"){
					$('#organizename').val(userInfo.organizename);
					organizeid=userInfo.organizeid;
					$('#organizeid').val(organizeid);
				}
				
				var temp="";
				for(var i=0;i<data.dictlistone.length;i++){
					temp+="<li  dataid="+data.dictlistone[i].dataid+" onclick=\"choosespecificationstwo(this)\">"+data.dictlistone[i].cname+"</li>";
				}
				$('#specificationstwoul').html(temp);
				var temp1="<li dataid=\"\" onclick=\"choosespecificationsone(this)\">请选择</li>";
				for(var j=0;j<data.dictlisttwo.length;j++){
					temp1+="<li  dataid="+data.dictlisttwo[j].dataid+" onclick=\"choosespecificationsone(this)\">"+data.dictlisttwo[j].cname+"</li>";
				}
				$('#specificationsoneul').html(temp1);
				var temp2="<li dataid=\"\" onclick=\"choosesupplier(this)\">请选择</li>";
				for(var k=0;k<data.supplierlist.length;k++){
					temp2+="<li dataid="+data.supplierlist[k].supplierid+" onclick=\"choosesupplier(this)\">"+data.supplierlist[k].suppliername+"</li>";
				}
				$('#supplierul').html(temp2);
			}
			
			
			initmaterial();
		}
	})
	$.ajax({
		type:'post',
		dataType:'json',
		url:projectpath+'/app/getShopListByUser?userid='+userInfo.userid+'&companyid='+userInfo.companyid,
		success:function(data){
			if(data.status==1){
				swal({
					title : "",
					text : data.message,
					type : "error",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					
				});
			}else{
				if(data.shoplist.length > 0 && data.shoplist != ''){
					var temp="";
					for(var i=0;i<data.shoplist.length;i++){
						if(data.shoplist[i].organizeid == userInfo.organizeid){
							changeorganizestore(data.shoplist[i].datacode);
						}
						temp+="<li organizeid="+data.shoplist[i].organizeid+" onclick=\"chooseorganize(this,'"+data.shoplist[i].datacode+"')\">"+data.shoplist[i].organizename+"</li>";
					}
					$('#organizeul').html(temp);
				}
			}
		}
	})

}
/* function clickSelect(obj){
	$(obj).parent().find("li").attr("class","");
	$(obj).attr("class","active");
} */
function chooseorganize(obj,datacode){
	var name =$(obj).text();
	var id =$(obj).attr('organizeid');
	$('#organizename').val(name);
	organizeid=id;
	$('#organizeid').val(organizeid);
	$('#organizediv').hide();
	$('.div_mask').hide();
	changeorganizestore(datacode);
}
function choosespecificationsone(obj){
	var name =$(obj).text();
	var id =$(obj).attr('dataid');
	
	$('#addul input[name=specificationsone]').val(id);
	$('#addul input[name=specificationsonevalue]').val(name);
	
	$('#specificationsonediv').hide();
	$('#materaildiv').show();
}

function choosespecificationstwo(obj){
	var name =$(obj).text();
	var id =$(obj).attr('dataid');
	
	$('#addul input[name=specificationstwo]').val(id);
	$('#addul input[name=specificationstwovalue]').val(name);
	
	$('#specificationstwodiv').hide();
	$('#materaildiv').show();
}
function choosesupplier(obj){
	var name =$(obj).text();
	var id =$(obj).attr('dataid');
	
	$('#addul input[name=supplierid]').val(id);
	$('#addul input[name=suppliername]').val(name);
	
	$('#supplierdiv').hide();
	$('#materaildiv').show();
}

function initmaterial(){
	$('#purchasetypename').attr("readonly", true);
	
	$(".div_maskk").show();
	$("#materaildiv").show();
	$('#addul input[name=type]').val("");
	$('#addul input[name=name]').val("");
	$('#addul input[name=sumprice]').val("");
	$('#addul input[name=num]').val("");
	$('#addul input[name=price]').val("");
	$('#addul input[name=unit]').val("");
	$('#addul input[name=specifications]').val("");
	$('#addul input[name=specificationsone]').val("");
	$('#addul input[name=specificationstwo]').val("");
	$('#addul input[name=specificationsonevalue]').val("");
	$('#addul input[name=specificationstwovalue]').val("");
	$('#addul input[name=supplierid]').val("");
	$('#addul input[name=suppliername]').val("");
	
	var name =$('#specificationstwoul li').first().text();
	var id =$('#specificationstwoul li').first().attr('dataid');
	
	$('#addul input[name=specificationstwo]').val(id);
	$('#addul input[name=specificationstwovalue]').val(name);
	
	//回显数据
	goBackPurchaseAddHtml();
}
function addmaterial(){
	if($('#addul input[name=type]').val()=="" ||
		$('#addul input[name=name]').val()=="" ||
		$('#addul input[name=sumprice]').val()=="" ||
		$('#addul input[name=num]').val()=="" ||
		$('#addul input[name=price]').val()=="" || 
		$('#addul input[name=specificationstwo]').val()==""){
		swal({
			title : "",
			text : "请填写完整后再提交",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			
		});
		return;
	}
	if($('#addul input[name=specifications]').val()=="" && $('#addul input[name=specificationsone]').val() !="" ){
		swal({
			title : "",
			text : "请填写规格数量",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			
		});
		return;
	}
	if($('#addul input[name=specifications]').val() !="" && $('#addul input[name=specificationsone]').val() =="" ){
		swal({
			title : "",
			text : "请选择规格",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			$('#materaildiv').hide();$('#specificationsonediv').show();
		});
		return;
	}
	var temp="<li>"+
    	"<div class=\"close\" onclick=\"deleteorder(this,'"+$('#addul input[name=sumprice]').val()+"')\"><img src=\"../appcssjs/images/public/close.png\"></div>"+
        "<span class=\"wid_01\">类&nbsp;&nbsp;别：<em name='type'>"+$('#addul input[name=type]').val()+"</em></span>"+
        "<span class=\"wid_02\">名称：<em name='name'>"+$('#addul input[name=name]').val()+"</em></span>"+
        "<span class=\"wid_03\" style=\"display:none;\">单位：<em name='unit'>"+$('#addul input[name=specificationstwovalue]').val()+"</em></span>"+
        
        "<span class=\"wid_03\">数&nbsp;&nbsp;量：<em name='num'>"+$('#addul input[name=num]').val()+"</em></span>"+
        "<div class=\"clear\"></div>"+
        "<span class=\"wid_01\">规格：<em name='specifications'>"+$('#addul input[name=specifications]').val()+"</em>&nbsp;"+
        "<em name='specificationstwo'>"+$('#addul input[name=specificationstwovalue]').val()+"</em>&nbsp;<input type=\"hidden\" name=\"specificationstwo\" value=\""+$('#addul input[name=specificationstwo]').val()+"\">"+
        "<em>"+($('#addul input[name=specificationsonevalue]').val()=="请选择" || $('#addul input[name=specificationsonevalue]').val()==""?"":"/"+$('#addul input[name=specificationsonevalue]').val())+"</em><input type=\"hidden\" name=\"specificationsone\" value=\""+$('#addul input[name=specificationsone]').val()+"\"></span>"+
        "<span class=\"wid_02\">单价：￥<em name='price'>"+$('#addul input[name=price]').val()+"</em></span>"+
        "<span class=\"wid_03\">总价：￥<em name='sumprice'>"+$('#addul input[name=sumprice]').val()+"</em></span>"+
        "<div class=\"clear\"></div>"+
        "<span class=\"wid_01\">供应商：<em name='suppliername'>"+($('#addul input[name=suppliername]').val()=="请选择" || $('#addul input[name=suppliername]').val()==""?"":$('#addul input[name=suppliername]').val())+"</em></span><input type=\"hidden\" name=\"supplierid\" value=\""+$('#addul input[name=supplierid]').val()+"\">"+
       
        "</span><div class=\"clear\"></div>"+
        "</li>";
     var materialprice=parseFloat($('#materialprice').text())+parseFloat($('#addul input[name=sumprice]').val());
     $('#materialprice').text(materialprice);
     
     var payAmount = $('#payAmount').val();
     if(payAmount == ""){
    	 payAmount = 0;
     }
     payAmount = parseFloat(payAmount)+parseFloat($('#addul input[name=sumprice]').val())+"";
     var numlength = payAmount.length;
     $('#payAmount').css("width",10*numlength);
     
     $('#payAmount').val(payAmount);
     
     $('#materialul').append(temp);
     
     var maternum=$('#materialul li').length;
     $('#maternum').text(maternum);
     $(".div_mask").hide();
     $(".div_maskk").hide();
 	 $("#materaildiv").hide();
 	 
 	$("body").scrollTop($("body")[0].scrollHeight);
}
function deleteorder(obj,price){
	swal({
		title : "",
		text : "确定要删除？",
		type : "error",
		showCancelButton : true,
		confirmButtonColor : "#ff7922",
		confirmButtonText : "确认",
		cancelButtonText : "取消",
		closeOnConfirm : true
	}, function(){
		$(obj).parent().remove();
		 var materialprice=parseFloat($('#materialprice').text())-parseFloat(price);
	     $('#materialprice').text(materialprice);
	     var payAmount = parseFloat($('#payAmount').val())-parseFloat(price);
	     
	     var numlength = (payAmount+"").length;
	     $('#payAmount').css("width",10*numlength);
	     
	     $('#payAmount').val(payAmount);
	     var maternum=$('#materialul li').length;
	     $('#maternum').text(maternum);
	});
	
}
function submitdata(){
	if($('#organizeid').val()==''){
		swal({
			title : "",
			text : "请选择店面",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			$('#organizename').click();
		});
		return;
	}
	
	
	var alldata={"materiallist":[]};  
	$('#materialul li').each(function(index){
		var specifications=$(this).find('em[name=specifications]').text();
		var price=$(this).find('em[name=price]').text();
		var materiallist={};
		materiallist['type']=$(this).find('em[name=type]').text();
		materiallist['name']=$(this).find('em[name=name]').text();
		
		materiallist['realprice']=$(this).find('em[name=price]').text();
		if(specifications!=""){
			materiallist['price']=price/specifications;
			materiallist['specifications']=$(this).find('em[name=specifications]').text();
			
			materiallist['num']=accMul($(this).find('em[name=num]').text(),$(this).find('em[name=specifications]').text());
			materiallist['realnum']=$(this).find('em[name=num]').text();
		}else{
			materiallist['price']=price;
			
			materiallist['num']=$(this).find('em[name=num]').text();
			materiallist['realnum']=$(this).find('em[name=num]').text();
		}
		
		materiallist['sumprice']=$(this).find('em[name=sumprice]').text();
		materiallist['specificationsone']=$(this).find('input[name=specificationsone]').val();
		materiallist['unit']=$(this).find('em[name=specificationstwo]').text();
			//$('#addul input[name=specificationstwovalue]').val();
		materiallist['specificationstwo']=$(this).find('input[name=specificationstwo]').val();
		materiallist['supplierid']=$(this).find('input[name=supplierid]').val();
		alldata.materiallist.push(materiallist);
	})
	if(alldata.materiallist.length==0){
		swal({
			title : "",
			text : "请添加物料明细",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			$('#initmaterial').click();
		});
		return;
	}
	if($('#examineuserid').val()==""){
		swal({
			title : "",
			text : "请选择审批人",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			
		});
		return;
	}
	var url=projectpath+'/app/insertPurchase';
	var param = new Object();
	param.materiallist = JSON.stringify(alldata);
	param.orderno = orderno;
	param.organizeid = organizeid;
	param.companyid = userInfo.companyid;
	param.createid = userInfo.userid;
	param.datacode = userInfo.datacode;
	param.examineuserid = $('#examineuserid').val();
	param.materialprice = $('#materialprice').text();
	param.maternum = $('#maternum').text();
	param.userlist = $('#userlist').val();
	param.CCusernames = $('#releaserange').text();
	param.purchasetime = $("#purchase_time").val();
	param.payamount = $('#payAmount').val();
	$.ajax({
		type:'post',
		dataType:'json',
		data:param,
		beforeSend:function(a,b){
			ajaxbefore();
		},
		complete:function(a,b){
			ajaxcomplete();
		},
		url:url,
		success:function(data){
			if(data.status==1){
				swal({
					title : "",
					text : data.message,
					type : "error",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					
				});
			}else{
				swal({
					title : "",
					text : "添加成功",
					type : "success",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					location.href="purchase_list0.html";
				});
			}
		},error:function(text){
			alert("添加失败");
		}
	})
}
function jisuanprice(){
	var price=$('#addul input[name=price]').val();
	var num=$('#addul input[name=num]').val();
	//var reg=/^\d+(\.\d{0,2}?)?$/;
	//var ex = /^\d+$/;
	var ex = /^\+?(\d*\.{0,1}\d{0,2})$/;

/* 	if(price != "" && !reg.test(price)){
		swal({
			title : "",
			text : "价格请输入数字",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			$('#addul input[name=price]').val("");
		});
		return;
	} */
	if(num!="" && (!ex.test(num) || parseFloat(num) < 0)){
		swal({
			title : "",
			text : "数量请输入数字",
			type : "error",
			showCancelButton : false,
			confirmButtonColor : "#ff7922",
			confirmButtonText : "确认",
			cancelButtonText : "取消",
			closeOnConfirm : true
		}, function(){
			$('#addul input[name=num]').val("");
		});
		return;
	}
	if(price==""){
		$('#addul input[name=sumprice]').val(0);
		return;
	}
	if(num==""){
		$('#addul input[name=sumprice]').val(0);
		return;
	}
	var tempSumprice = fomatFloatFloor(accMul(price,num),2);
	$('#addul input[name=sumprice]').val(tempSumprice);
}
function accMul(arg1,arg2){  
	var m=0,s1=arg1.toString(),
	s2=arg2.toString();  
	try{
	m+=s1.split(".")[1].length}catch(e){}  
	try{
	m+=s2.split(".")[1].length}catch(e){}  
	return Number(s1.replace(".",""))*Number(s2.replace(".",""))/Math.pow(10,m)
}
$(function(){
	$('.div_mask').click(function(){
		$('#materaildiv').hide();
		$('#organizediv').hide();
		$('#specificationsonediv').hide();
		$('#specificationstwodiv').hide();
		$('#supplierdiv').hide();
		$("#purchase_name_div").hide();
		$(this).hide();
	})
	$('.div_maskk').click(function(){
		$('#materaildiv').hide();
		$('#organizediv').hide();
		$('#specificationsonediv').hide();
		$('#specificationstwodiv').hide();
		$('#supplierdiv').hide();
		$("#purchase_name_div").hide();
		$(this).hide();
	})
})


function queryPurchaseTypeInfo(){
	var param = new Object();	
	if(userInfo!= null && typeof(userInfo) != "undefined"){
		param.companyid=userInfo.companyid;
	}
	
	$.ajax({		
		data:param,		
		type:"post",
		url:projectpath+'/app/getPurchaseTypeList',
		success:function(resultMap){
			if(resultMap != undefined && resultMap != null){				
				var purchasetypelist = resultMap.data;
				showPurchaseTyepeInfo(purchasetypelist);				
			}
		},error:function(e){
			
		}
	});
}

function showPurchaseTyepeInfo(lists){
	//<li name="organize_li" organizeid="'+map.dataid+'" organizename="'+map.cname+'">'+map.cname+'</li>
	if(lists.length > 0 && lists != null){
		var html = "";
		$.each(lists,function(i,list){			
			html+='<li onclick="choosePurchaseType(this)">'+list.type+'</li>';						
		});				
		$('#organize_option').html(html);
	}else{
		
	}
}

function choosePurchaseType(e){
	var text=$(e).html();
	$('#purchasetypename').val(text);
	$('#organize_mask').hide();
	$('#organize_div').hide();
	$(".div_maskk").show();
	$("#materaildiv").show();
}


function close_open_purchasetypeDiv(){
	$("#purchasetypename").blur();
	$('#purchasetypename').attr("readonly", true);
	var disk = $('#organize_div').css("display");
	if(disk == "none"){
		queryPurchaseTypeInfo();
		
	}else{		
		
	}
	close_open_organizeDiv();
}

//类型选择康打开或者关闭区域选择层
function close_open_organizeDiv(){
	var disk = $('#organize_mask').css("display");
	var organize = $('#organize_div').css("display");
	if(disk == "none" && organize == "none"){
		$("#materaildiv").hide();
		$(".div_maskk").hide();
		$('#organize_mask').show();
		$('#organize_div').show();
	}else{
		$('#organize_div').hide();
		$('#organize_mask').hide();
		$(".div_maskk").show();
		$("#materaildiv").show();
	}
}
//直接关闭类型选择框
function close_organizeDiv(){
	$('#organize_mask').hide();
	$('#organize_div').hide();
}
//类型输入
function typewrite(){
	$('#purchasetypename').attr("readonly", false);
	close_open_organizeDiv();
	$("#purchasetypename").focus();
}

function hideinput(){
	$("#purchasetype_div").hide();
}

$(function(){
	$("#purchasetype_div").mouseover(function(){
		$("#purchasetypename").attr("onblur","");
	});
	$("#purchasetype_div").mouseout(function(){
		$("#purchasetypename").attr("onblur","hideinput()");
	});
})

function goBackPurchaseAddHtml(){
	JianKangCache.getGlobalData("purchaseAddHtml",function(data){
		if(data != "" && data != undefined){
			$('.xx_one').html(data.dianmian);
			$("#wuliaomingxi").html(data.wuliaomingxi);
			$('.xx_four').html(data.shenhezhe);
			var mxmap = data.mxmap;
			if(mxmap != undefined && mxmap != "null"){
				$('#purchasetypename').val(mxmap.purchasetypename);
				$('#addul input[name="name"]').val(mxmap.name);
				$('#addul input[name="num"]').val(mxmap.num);
				$('#addul input[name="suppliername"]').val(mxmap.suppliername);
				$('#addul input[name="supplierid"]').val(mxmap.supplierid);
				$('#addul input[name="specificationsonevalue"]').val(mxmap.specificationsonevalue);
				$('#addul input[name="specificationsone"]').val(mxmap.specificationsone);
				$('#addul input[name="specificationstwovalue"]').val(mxmap.specificationstwovalue);
				$('#addul input[name="specificationstwo"]').val(mxmap.specificationstwo);
				$('#addul input[name="specifications"]').val(mxmap.specifications);
				$('#addul input[name="price"]').val(mxmap.price);
				$('#addul input[name="sumprice"]').val(mxmap.sumprice);
			}
			$('#organizename').val(data.organizename);
			JianKangCache.delGlobalData("purchaseAddHtml");
		}
	});
}

function intoPageSupplierAdd(){
	var dianmian = $('.xx_one').html();
	var wuliaomingxi = $("#wuliaomingxi").html();
	var shenhezhe = $('.xx_four').html();
	var addmingxi = $('#addul').html();
	var param = new Object();
	param.dianmian = dianmian;
	param.wuliaomingxi = wuliaomingxi;
	param.shenhezhe = shenhezhe;
	param.addmingxi = addmingxi;
	param.organizename = $('#organizename').val();
	
	var mxmap = new Object();
	mxmap.purchasetypename = $('#purchasetypename').val();
	mxmap.name = $('#addul input[name="name"]').val();
	mxmap.num = $('#addul input[name="num"]').val();
	mxmap.suppliername = $('#addul input[name="suppliername"]').val();
	mxmap.supplierid = $('#addul input[name="supplierid"]').val();
	mxmap.specificationsonevalue = $('#addul input[name="specificationsonevalue"]').val();
	mxmap.specificationsone = $('#addul input[name="specificationsone"]').val();
	mxmap.specificationstwovalue = $('#addul input[name="specificationstwovalue"]').val();
	mxmap.specificationstwo = $('#addul input[name="specificationstwo"]').val();
	mxmap.specifications = $('#addul input[name="specifications"]').val();
	mxmap.price = $('#addul input[name="price"]').val();
	mxmap.sumprice = $('#addul input[name="sumprice"]').val();
	
	param.mxmap = mxmap;
	
	JianKangCache.setGlobalData("purchaseAddHtml",param);
	location.href='../supplier/supplier_add.html';
}

//打开采购单名称列表
function open_purchasename_div(obj){
	$(obj).blur();
	//取类别
	var typename=$("#purchasetypename").val();
	//查询数据
	$.ajax({
		type:'post',
		async:false,
		dataType:'json',
		url:projectpath+'/app/getPurchaseMaterial?type='+typename+'&companyid='+userInfo.companyid+'&organizeid='+$('#organizeid').val()+"&groupname=1",
		success:function(data){
			if(data.status==0){
				var temp1="";
				if(data.materialList.length>0){
					for(var j=0;j<data.materialList.length;j++){
						temp1+="<li ";
						if(j==0){
							temp1+="class=\"active\"";
						} 
						temp1+=" name="+data.materialList[j].name+"  onclick=\"optionpurchasename(this)\">"+data.materialList[j].name+"</li>";
					}
					$('#purchase_name_option').html(temp1);
				}else{
					$('#purchase_name_option').html("");
				}
			}
		}
	})
	$(".div_maskk").hide();
	$(".div_mask").show();
	$('#materaildiv').hide();
	$('#purchase_name_div').show();
}

//点击选项
function optionpurchasename(obj){
	$("#purchasename").val($(obj).attr("name"));
	namewrite1();
}

//点击输入
function namewrite1(){
	$(".div_maskk").show();
	$(".div_mask").hide();
	$('#purchase_name_div').hide();
	$('#materaildiv').show();
	$("#purchasename").removeAttr("readonly");
	$("#purchasename").focus();
}

$(function(){
	$('#purchase_time').val(appBase.parseDate(new Date()));
	var currYear = (new Date()).getFullYear();	
	var opt={};
	opt.date = {preset : 'date', dateFormat: 'yy-mm-dd' };
	//opt.datetime = { preset : 'datetime', minDate: new Date(2012,3,10,9,22), maxDate: new Date(2014,7,30,15,44), stepMinute: 5  };
	opt.datetime = {preset : 'datetime', dateFormat: 'yy-mm-dd' }; 
	opt.time = {preset : 'time'};
	opt.default = { 
		theme: 'android-ics light', //皮肤样式  
        display: 'modal', //显示方式  
        mode: 'scroller', //日期选择模式
        dateOrder : 'yymmdd',  
		lang:'zh',
        startYear:currYear - 10, //开始年份
        endYear:currYear + 10 //结束年份
	};
	//初始化时间插件
	$("#purchase_time").scroller('destroy').scroller($.extend(opt['date'], opt['default']));
});
</script>
<body onload="onloadData()">
<div id="htmlbody">
<div class="head_box">
	<a class="ico_back"  onclick="goBackPage()">返回</a>
    <div class="name">采购(入库)单新建</div>
    <div class="link_yellow" onclick="submitdata()">发送</div>
</div>
<div class="head_none"></div>
<div class="xx_one">
    <span id="orderno" style="font-size: 17px;"></span>
    <input type="hidden" id="organizeid" />
    <div class="txt"><span>店面</span><input type="text" placeholder="请选择店面" readonly="readonly" class="sel" id="organizename" onclick="$('#organizediv').show();$('.div_mask').show();"></div>
</div>
<div class="xx_two" id="wuliaomingxi">
    <div class="name"><span>物料明细</span></div>
     <ul id="materialul">
        <!-- <li>
        	<div class="close"><img src="../images/public/close.png"></div>
            <span class="wid_01">类&nbsp;&nbsp;别：<em>主食</em></span>
            <span class="wid_02">名称：<em>大米</em></span>
            <span class="wid_03">总价：<em>40,000.00</em></span>
            <div class="clear"></div>
            <span class="wid_01">数&nbsp;&nbsp;量：<em>100</em></span>
            <span class="wid_02">单价：<em>40.00</em></span>
            <div class="clear"></div>
            <span class="wid_01">供应商：<em>供应商一</em></span>
            <span class="wid_02">规格：<em>规格一</em></span>
            <div class="clear"></div>
        </li> -->
    </ul>
    <div class="total" style="height:82px;">
        <span style="width:70%;">合计：￥<em id="materialprice" style="color:#424242;">0.00</em>元</span>
        <i style="float:right;">共<em id="maternum">0</em>项</i>
        <div class="clear"></div>
        <span style="width:70%;">实付金额：￥ <input type="text" style="font-size:14px; width:30px; color:#ff9b30;" id="payAmount" value="0.00"/>元</span>
        <a class="add" onclick="initmaterial()">添加</a>
    </div>
</div>

<div class="xx_four">
	<ul>
    	<input type="hidden" id="examineuserid" >
<!--     	<li><span>实付金额：</span>￥<input type="text" style="font-size:14px; width:100px; border-bottom:1px solid #e5e5e5; color:#ff9b30;" id="payAmount" value="0.00"/>元</li> -->
    	<li><span>审&nbsp;核&nbsp;人：</span><i id="examinename"></i><a onclick="$('#organizeiframe').show();$('#htmlbody').hide();"><img src="../appcssjs/images/public/btn_add.png"></a></li>
    	<li><span>抄&nbsp;送&nbsp;人：</span><i id="releaserange" style="text-overflow:ellipsis ; overflow:hidden; white-space:nowrap; max-width: 59%;"></i><a onclick="$('#morechange_organizeiframe').show();$('#htmlbody').hide();"><img src="../appcssjs/images/public/btn_add.png"></a></li>
        <li><span>入库时间：</span><input type="text" style="font-size:14px; color:#666;" readonly="readonly" id="purchase_time"/></li>
        <li><span>采&nbsp;购&nbsp;人：</span><i id="createname"></i></li>
        <li><span>填写时间：</span><i id="createtime"></i></li>
    </ul>
</div>

<div class="div_mask" style="display:none;"></div>
<div class="div_maskk" style="display:none;position:fixed; left: 0px; top: 76px; width: 100%; height:100%; _height:0px; z-index: 501; background: #000; FILTER: alpha(opacity:60); opacity: 0.6;"></div>
<div class="tc_addgood" style="display:none;position:fixed; width:100%; background:#fff; left:0px; top:76px; z-index:999;" id="materaildiv">
	<div class="name" style="line-height:42px; height:43px; border-bottom:1px solid #d5d5d5; padding:0px 15px; font-size:16px;"><span style="display:block; float:left; color:#424242;">新增物料</span><a onclick="addmaterial()" style="display:block; float:right; color:#ff9b30;">确认</a></div>
    <ul id="addul" style="padding:5px 10px;">
    	<li style="border-bottom:1px solid #e5e5e5; padding:0px 5px; line-height:36px; height:36px;">
    		<span style="display:block; float:left;font-size: 17px;"><font color="red">*</font>类别</span><input readonly="true" type="text" placeholder="请输入类别" class="text" maxlength="6" id="purchasetypename" onblur="hideinput()" name="type" onclick="close_open_purchasetypeDiv()" style="display:block; float:right; border:0px; height:24px; line-height:24px; color:#666; margin:6px 0px; text-align:right; width:80%;font-size: 17px;">
    		<div class="sel_xx" id="purchasetype_div"></div>
    	</li>
        <li style="border-bottom:1px solid #e5e5e5; padding:0px 5px; line-height:36px; height:36px;"><span style="display:block; float:left;font-size: 17px;"><font color="red">*</font>名称</span><input id="purchasename" readonly="true" type="text" readonly="true" onclick="open_purchasename_div(this)" maxlength="6" placeholder="请输入名称" class="text" name="name" style="display:block; float:right; border:0px; height:24px; line-height:24px; color:#666; margin:6px 0px; text-align:right; width:80%;font-size: 17px;"></li>
        <li style="border-bottom:1px solid #e5e5e5; padding:0px 5px; line-height:36px; height:36px;"><span style="display:block; float:left;font-size: 17px;"><font color="red">*</font>数量</span><input type="text" placeholder="请输入数量" class="text" name="num" oninput="jisuanprice()" style="display:block; float:right; border:0px; height:24px; line-height:24px; color:#666; margin:6px 0px; text-align:right; width:80%;font-size: 17px;"></li>
        <li style="border-bottom:1px solid #e5e5e5; padding:0px 5px; line-height:36px; height:36px;"><span style="display:block; float:left;font-size: 17px;"><font color="red">*</font>规格</span><input type="text" readonly="readonly" placeholder="请选择" class="t_sel" name="specificationsonevalue" onclick="$('#materaildiv').hide();$('#specificationsonediv').show();" style="float:right; border:0px; line-height:24px; color:#666; height:24px; margin:6px 0px; text-align:right; width:25%; background:url(../appcssjs/images/public/sel2.png) no-repeat right; background-size:12px 7px; padding-right:18px;font-size: 17px;"> <input type="hidden" name="specificationsone">
        <input type="text" placeholder="请选择" readonly="readonly" class="t_sel" name="specificationstwovalue" onclick="$('#materaildiv').hide();$('#specificationstwodiv').show();" style="float:right; border:0px; line-height:24px; color:#666; height:24px; margin:6px 0px; text-align:center; width:25%; background:url(../appcssjs/images/public/sel2.png) no-repeat right; background-size:12px 7px; padding-right:18px;font-size: 17px;"> <input type="hidden" name="specificationstwo">
        <input type="number" placeholder="规格数量" class="text_2" name="specifications" style="display:block; float:right; border:0px; height:24px; line-height:24px; color:#666; margin:6px 0px; text-align:right; width:28%;font-size: 17px;"></li>
  		<li style="border-bottom:1px solid #e5e5e5; padding:0px 5px; line-height:36px; height:36px;"><span style="display:block; float:left;font-size: 17px;"><font color="red">*</font>单价</span><input type="number" placeholder="请输入单价" class="text" name="price" oninput="jisuanprice();" style="display:block; float:right; border:0px; height:24px; line-height:24px; color:#666; margin:6px 0px; text-align:right; width:80%;font-size: 17px;"></li>
        <li style="border-bottom:1px solid #e5e5e5; padding:0px 5px; line-height:36px; height:36px;"><span style="display:block; float:left;font-size: 17px;">总价</span><input type="text" placeholder="" class="text" name="sumprice" readonly="readonly" style="display:block; float:right; border:0px; height:24px; line-height:24px; color:#666; margin:6px 0px; text-align:right; width:80%;font-size: 17px;background-color: white;"></li>
        <li style="border-bottom:1px solid #e5e5e5; padding:0px 5px; line-height:36px; height:36px;"><span style="display:block; float:left;font-size: 17px;">供应商</span><input type="text" readonly="readonly" style="width:65%;float:right; border:0px; line-height:24px; color:#666; height:24px; margin:6px 0px; text-align:right; width:25%; background:url(../images/public/sel2.png) no-repeat right; background-size:12px 7px; padding-right:18px;font-size: 17px;" placeholder="请选择" class="t_sel" name="suppliername" onclick="$('#materaildiv').hide();$('#supplierdiv').show();"><input type="hidden" name="supplierid"></li>
    </ul>
</div>

<div class="tc_addsel"  style="display:none" id="organizediv">
	<div class="name"><span>选择店面</span></div>
    <div class="xx_box" style="max-height:250px;overflow:hidden;overflow-y:visible">
    	<ul id="organizeul">
        </ul>
    </div>
</div>

<div class="tc_addsel" style="display:none" id="purchase_name_div">
	<div class="name"><span>选择名称</span><a id="sure_btn" onclick="namewrite1()">输入</a></div>
    <div class="xx_box" style="height: 253px;overflow:hidden;overflow-y:visible">
    	<ul id="purchase_name_option">
        	<!-- <li>浦东店</li>
            <li>浦东店</li>
            <li class="active">长安街店</li>
            <li>浦东店</li>
            <li>浦东店</li>
            <li>浦东店</li>
            <li>浦东店</li> -->
        </ul>
    </div>
</div>

<div class="tc_addsel"  style="display:none" id="supplierdiv">
	<div class="name"><span>选择供应商</span><a onclick="intoPageSupplierAdd()">添加供应商</a></div>
    <div class="xx_box" style="max-height:250px;overflow:hidden;overflow-y:visible">
    	<ul id="supplierul">
        </ul>
    </div>
</div>
<div class="tc_addsel"  style="display:none" id="specificationsonediv">
	<div class="name"><span>选择规格</span></div>
    <div class="xx_box" style="max-height:250px;overflow:hidden;overflow-y:visible">
    	<ul id="specificationsoneul">
        </ul>
    </div>
</div>
<div class="tc_addsel"  style="display:none" id="specificationstwodiv">
	<div class="name"><span>选择规格</span></div>
    <div class="xx_box" style="max-height:250px;overflow:hidden;overflow-y:visible">
    	<ul id="specificationstwoul">
        </ul>
    </div>
</div>
<div class="div_maskkk" onclick="close_organizeDiv()" style="display:none;position:fixed; left: 0px; top: 0px; width: 100%; height:100%; _height:0px; z-index: 501; background: #000; FILTER: alpha(opacity:60); opacity: 0.6;" id="organize_mask"></div>
<div class="tc_addsel" style="display:none" id="organize_div">
	<div class="name"><span>选择类别</span><a id="sure_btn" onclick="typewrite()">输入</a></div>
    <div class="xx_box" style="height: 253px;overflow:hidden;overflow-y:visible">
    	<ul id="organize_option">
        	<!-- <li>浦东店</li>
            <li>浦东店</li>
            <li class="active">长安街店</li>
            <li>浦东店</li>
            <li>浦东店</li>
            <li>浦东店</li>
            <li>浦东店</li> -->
        </ul>
    </div>
</div>
</div>
</body>
<script type="text/javascript" src="../appcssjs/script/selectuser.js"></script>
<script type="text/javascript" src="../appcssjs/script/select_xiebanren.js"></script>
</html>
