<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>供应商列表</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" >
<link type="text/css" rel="stylesheet" href="../appcssjs/style/public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/purchase.css">
<script type="text/javascript" src="../appcssjs/script/jquery-1.10.2.min.js"></script>

<script type="text/javascript" src="../appcssjs/script/cache.js"></script>
<script type="text/javascript" src="../appcssjs/script/constant.js"></script>
<script type="text/javascript" src="../appcssjs/script/page.js"></script>
</head>
<script type="text/javascript">
var nodata = '<div class="list_none"><span><i class="yellow">Hi,我是大狮！</i><br>列表空空，还没有供应商呢~</span><b><img src="'+notDataImageUrl_nopower+'"></b></div>';
var userInfo;
JianKangCache.getGlobalData('userinfo',function(data){
		userInfo=data;
})
function onloaddata(){
	if(typeof(userInfo.powerMap.power1001010) != "undefined"){
		$('#linkadd').show();
		nodata = '<div class="list_none"><span><i class="yellow">Hello,我是大狮！</i><br>还没有供应商，赶紧添加一个吧~</span><b><img src="'+notDataImageUrl_havepower+'"></b></div>';
	}
}
function gomyback(){
	location.href="../purchase/purchase_index.html";
}
</script>
<body onload="onloaddata()">
<div class="head_box">
	<a class="ico_back" onclick="gomyback();">返回</a>
	<form  onsubmit="return search()">
      <div class="find"><input type="text" id="suppliername"  placeholder="请输入供应商名称"></div>
    </form>
    <div class="link_yellow" onclick="window.location.href='supplier_add.html'" id="linkadd" style="display: none;">新建</div>
</div>
<div class="head_none"></div>
<div class="supplier_list">
	<ul id="supplier_ul">
    	
    </ul>
</div>
</body>
<script type="text/javascript">
function loadSupplier(suppliername){
	JianKangCache.getGlobalData("userinfo",function(user){
	    var url = projectpath+'/app/getSupplierList';
	    var key = "supplier_data_list"
	    var suppliername =  $("#suppliername").val().trim();
		$.ajax({
		    type:"post",
		    url:url,
		    data:{companyid:user.companyid,suppliername:suppliername},
		    success:function(data){
		    	//console.log(data);
		    	//console.log(user);
		    	if(data.supplierlist != null && data.supplierlist.length>0){
		    		$(".list_none").remove();
		    		$.each(data.supplierlist,function(index,value){
		    			
		    			if(value.position!=null && value.position!=undefined && value.position!=""){
		    				value.position="("+value.position+")";
		    			}else{
		    				value.position="";
		    			}
		    			
		    			var temp = $("#supplier_temp").html();
		    			$("#supplier_ul").append(replaceTemp(temp,value));
		    		});
		    		JianKangCache.setData(key,data.supplierlist);
		    	}else{
		    		$(".list_none").remove();
// 		    		 $("#supplier_ul").append("<div class=\"load_more\"><a>暂无数据</a></div>");
						$("body").append(nodata);
		    	}
		    },error:function(e){
		    	JianKangCache.getData(key,function(result){
		    		$.each(result,function(index,value){
		    			var temp = $("#supplier_temp").html();
		    			$("#supplier_ul").append(replaceTemp(temp,value));
		    		});
		    	});
		    }
		}); 
		
	   PageHelper({
			url:url,
			data:{companyid:user.companyid,suppliername:suppliername},
			success:function(data){
				if(data.supplierlist != null){
		    		$.each(data.supplierlist,function(index,value){
		    			var temp = $("#supplier_temp").html();
		    			$("#supplier_ul").append(replaceTemp(temp,value));
		    		});
		    	}  
			}
		});  
	});
	
}

function search(){
	$("#supplier_ul").html("");
	loadSupplier();
	return false;
}

$(function(){
	loadSupplier();
});
function tiaozhuan(supplierid){
	
	window.location.href="supplier_detail.html?supplierid="+supplierid;
}
</script>
<script type="text/temple" id="supplier_temp">
  <li onclick="tiaozhuan('{supplierid}')">
        	<div class="xx_01"><span class="word_hidden">{suppliername}</span><i>{supplierno}</i></div>
            <div class="xx_02"><span class="name">{contactsname}{position}</span><span class="tel">{phone}</span>
            </div>
  </li>
</script>
</html>
