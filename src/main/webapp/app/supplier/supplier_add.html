<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title id="title2">新建供应商</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" >
<link type="text/css" rel="stylesheet" href="../appcssjs/style/public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/purchase.css">
<script type="text/javascript" src="../appcssjs/script/jquery-1.10.2.min.js"></script>

<script type="text/javascript" src="../appcssjs/script/cache.js"></script>
<script type="text/javascript" src="../appcssjs/script/constant.js"></script>
<script type="text/javascript" src="../appcssjs/script/page.js"></script>
<script type="text/javascript" src="../appcssjs/script/appbase.js"></script>
<link rel="stylesheet" href="../appcssjs/sweetalert/dist/sweetalert.css">
<script src="../appcssjs/sweetalert/dist/sweetalert-dev.js"></script>  
<script type="text/javascript" src="../appcssjs/script/jquery.touchSwipe.min.js"></script>


</head>

<body>
<div class="head_box">
	<a class="ico_back" onclick="goBackPage();">返回</a>
    <div class="name" id="title1">新建供应商</div>
    <div class="link_yellow" id="save_click">保存</div>
</div>
<div class="head_none"></div>
<div class="detail_box">
<form id="supplier_form">
	<ul>
<!-- 		<li><span><font color="red">*</font>类型</span><input type="text" placeholder="请输入类型" class="text" name="type"></li> -->
    	<li><span><font color="red">*</font>供应商编号</span> <input type="text" id="supplierno" name="supplierno" readonly="readonly" class="text" style="font-size: 12px" value=""/></li>
        <li><span><font color="red">*</font>供应商名称</span><input type="text" maxlength="30" id="suppliername" name="suppliername" class="text" placeholder="请输入供应商名称"></li>
        <li><span><font color="red">*</font>供应商类型</span><input type="text" id="suppliertype" maxlength="20" name="suppliertype" class="text" placeholder="请输入供应商类型"></li>
        <li><span><font color="red">*</font>联系人</span><input type="text" id="contactsname" name="contactsname" class="text" placeholder="请输入联系人"></li>
        <li><span><font color="red">*</font>联系人电话</span><input type="text" maxlength="11"  id="phone" name="phone" class="text" placeholder="请输入联系方式"></li>
        <li><span>职务</span><input type="text" class="text" maxlength="20" id="position" name="position" placeholder="请输入职务"></li>
        <li><span>所属区域</span><input type="text" class="text" id="area_text" readonly="readonly" placeholder="请选择所属区域"></li>
        <li><span>详细地址</span><input type="text" id="address" maxlength="100" name="address" class="text" placeholder="请输入详细地址"></li>
        <li><span>纳税人识别号</span><input type="text" maxlength="100" id="taxpayernum" name="taxpayernum" class="text" placeholder="请输入纳税人识别号"></li>
        <li><span>开户行</span><input type="text" maxlength="20" class="text" id="bankname" name="bankname" placeholder="请输入开户行"></li>
        <li><span>银行账号</span><input type="text" class="text" maxlength="36" id="bankaccount" name="bankaccount" placeholder="请输入银行账号"></li>
        <li><span class="name">简介</span><div class="clear"></div><p><textarea id="introduction" maxlength="800" name="introduction" class="text_area" placeholder="请输入详细内容，不超过800字"></textarea></p></li>
    </ul>
    <input type="hidden" id="provinceid" name = "provinceid"/>
    <input type="hidden" id="cityid" name = "cityid"/>
    <input type="hidden" id="districtid" name = "districtid"/>
    <input type="hidden" id="companyid" name = "companyid"/>
    <input type="hidden" id="createid" name = "createid"/>
    <input type="hidden" id="userid" name = "userid"/>
    <input type="hidden" id="supplierid" name = "supplierid"/>
</form>
</div>
<div class="div_mask"  style="display:none"></div>
<div class="tc_addsel" style="display:none" id="province_div">
	<div class="name"><span>选择省</span><a><!-- 确定 --></a></div>
    <div class="xx_box" style="height: 253px;overflow:hidden;overflow-y:visible">
    	<ul id="area_li">
        	<!-- <li>浦东店</li>
            <li>浦东店</li>
            <li class="active">长安街店</li>
            <li>浦东店</li>
            <li>浦东店</li>
            <li>浦东店</li>
            <li>浦东店</li> -->
        </ul>
    </div>
</div>

 <div class="tc_addsel" style="display:none" id="city_div">
	<div class="name"><span>选择市</span><a><!-- 确定 --></a></div>
    <div class="xx_box" style="height: 253px;overflow:hidden;overflow-y:visible">
    	  <ul id="area_li_city"  >
        	<!-- <li>浦东店</li>
            <li>浦东店</li>
            <li class="active">长安街店</li>
            <li>浦东店</li>
            <li>浦东店</li>
            <li>浦东店</li>
            <li>浦东店</li> -->
        </ul>  
    </div>
</div>


<div class="tc_addsel"  style="display:none" id="district_div">
	<div class="name"><span>选择区</span><a><!-- 确定 --></a></div>
    <div class="xx_box" style="height: 253px;overflow:hidden;overflow-y:visible">
    	 <ul id="area_li_district" >
        	<!-- <li>浦东店</li>
            <li>浦东店</li>
            <li class="active">长安街店</li>
            <li>浦东店</li>
            <li>浦东店</li>
            <li>浦东店</li>
            <li>浦东店</li> -->
        </ul> 
    </div>
</div>  

<script type="text/javascript">
  $(function(){
	  var suid = appBase.getQueryString("supplierid");
	  if(suid != null && suid != ""){
		  $("#title1").text("编辑供应商");
		  $("#title2").text("编辑供应商");
		  $.ajax({
				url:projectpath+"/app/getSupplierInfo",
				data:{supplierid:appBase.getQueryString("supplierid")},
				type:"post",
				success:function(data){
					var value = data.supplierInfo
					$("#supplierno").val(value.supplierno);
					$("#suppliername").val(value.suppliername);
					$("#suppliertype").val(value.suppliertype);
					$("#contactsname").val(value.contactsname);
					$("#phone").val(value.phone);
					$("#position").val(value.position);
					$("#address").val(value.address);
					$("#taxpayernum").val(value.taxpayernum);
					$("#bankname").val(value.bankname);
					$("#bankaccount").val(value.bankaccount);
					$("#introduction").val(value.introduction);
					$("#provinceid").val(value.provinceid);
					$("#cityid").val(value.cityid);
					$("#districtid").val(value.districtid);
					$("#supplierid").val(suid);
					$("#area_text").val(value.provincename+" "+value.cityname+" "+value.districtname);
					//console.log(value);
				}
			 });
	  }
	  
	  var flg = 0;
	  $("#save_click").click(function(){
		// console.log(getFormBean("supplier_form"));
		 if($("#suppliername").val().trim() == ""){
			 
				swal({
					title : "",
					text : "供应商名称不能为空",
					type : "error",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					$("#suppliername").focus();
				});
				
			 return false;
		 }
		 
		 if($("#contactsname").val().trim() == ""){
			swal({
					title : "",
					text : "联系人姓名不能为空",
					type : "error",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					 $("#contactsname").focus();
				});
			
			 return false;
		 }
		 
		 if($("#phone").val().trim() == ""){
			 swal({
					title : "",
					text : "联系人电话不能为空",
					type : "error",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					$("#phone").focus();
				});
			  
			 
			 return false;
		 }
		 
		 if(!/^\d{11}$/.test($("#phone").val().trim())){
			 swal({
					title : "",
					text : "手机号不合法",
					type : "error",
					showCancelButton : false,
					confirmButtonColor : "#ff7922",
					confirmButtonText : "确认",
					cancelButtonText : "取消",
					closeOnConfirm : true
				}, function(){
					$("#phone").focus();
				});
			 return false;
			 
		 }
		 
		 
		 var jsonData = getFormBean("supplier_form");
		 var url = projectpath+"/app/editSupplier";
		 if(flg == 0){
			 flg = 1;
			 $.ajax({
					type:"post",
					url:url,
					beforeSend:function(a,b){
						ajaxbefore();
					},
					complete:function(a,b){
						ajaxcomplete();
					},
					data:jsonData,
					success:function(data){
						 swal({
								title : "",
								text : "保存成功！",
								type : "success",
								showCancelButton : false,
								confirmButtonColor : "#ff7922",
								confirmButtonText : "确认",
								cancelButtonText : "取消",
								closeOnConfirm : true
							}, function(){
								window.history.go(-1);
							});
						flg = 0;
					},error:function(e){
						swal({
							title : "",
							text : "保存失败,请稍后再试！",
							type : "error",
							showCancelButton : false,
							confirmButtonColor : "#ff7922",
							confirmButtonText : "确认",
							cancelButtonText : "取消",
							closeOnConfirm : true
						}, function(){
							  
						});
						flg = 0;
					}
					 
				 });
		 }
		 
	  });
      
	  //得到初始数据
	  var key = "area_supplier_data";
	  JianKangCache.getGlobalData("userinfo",function(user){
	  $.ajax({
		  url:projectpath+'/app/initInsertSupplier',
		  type:"post",
		  data:{companyid:user.companyid},
		  success:function(data){
			  if(suid == null || suid == ""){
				
				  $("#supplierno").val(data.supplierno);
			  }
			  $("#companyid").val(user.companyid);
			  $("#createid").val(user.userid);
			  $("#userid").val(user.userid);
			  if(data.provincelist != null){
			  $.each(data.provincelist,function(index,value){
				  var temp = $("#temple").html();
				  $("#area_li").append(replaceTemp(temp,value));
			  });
			    JianKangCache.setData(key,data);
			  }
		  },error:function(e){
			  JianKangCache.getData(key,function(result){
		    		$.each(result.provincelist,function(index,value){
		    			var temp = $("#temple").html();
		    			$("#area_li").append(replaceTemp(temp,value));
		    		});
		    		if(suid == null || suid == ""){
		    		 $("#supplierno").val(result.supplierno);
		    		 
		    		}
		    		 $("#companyid").val(user.companyid);
					 $("#createid").val(user.userid);
					 $("#userid").val(user.userid);
		    	});
		  }
	    });
	  });
	  
	  //点击选择区域
	  $("#area_text").click(function(){
		  $("#province_div").show();
		  $(".div_mask").show();
	  });
	  
	  
	  //背景色点击
	  $(".div_mask").click(function(){
		  $("#province_div").hide();
		  $("#city_div").hide();
		  $("#district_div").hide();
		  $(this).hide();
	  });
  });
 
//区域名称
  var areaname = "";
  //选择省
  function changeprovince(item){
	  areaname = "";
	  areaname+=$(item).text()+" ";
	  $("#provinceid").val($(item).attr("areaid"));
	  $("#districtid").val("");
	  $("#cityid").val("");
	  getAreaData($(item).attr("areaid"),function(data){
		  $("#area_li_city").html("");
		  $.each(data.dataList,function(index,value){
			  var temp = '<li areaid="'+value.areaid+'" onclick="changecity(this)">'+value.cname+'</li>';
			  $("#area_li_city").append(temp);
		  });
		  $("#province_div").hide();
		  $("#city_div").show();
	  });
  };
  
  //选择市
  function changecity(item){
	  areaname+=$(item).text()+" ";
	  $("#cityid").val($(item).attr("areaid"));
	  getAreaData($(item).attr("areaid"),function(data){
		  $("#area_li_district").html("");
		  $.each(data.dataList,function(index,value){
			  var temp = '<li areaid="'+value.areaid+'" onclick="changearea(this)">'+value.cname+'</li>';
			  $("#area_li_district").append(temp);
		  });
		  $("#province_div").hide();
		  $("#city_div").hide();
		  $("#district_div").show();
	  });
  };
  
  //选择区
   function changearea(item){
	  areaname+=$(item).text();
	  $("#districtid").val($(item).attr("areaid"));
	  getAreaData($(item).attr("areaid"),function(data){
		  $("#area_text").val(areaname);
		  $("#district_div").hide();
		  $(".div_mask").hide();
	  });
  };
  
  function getAreaData(parentid,call){
	  $.ajax({
		  url:projectpath+'/app/getAreaList',
		  type:"post",
		  data:{parentid:parentid},
		  success:function(data){
			   call(data);
		  },error:function(e){
			  call();
		  }
		  
	  });
	  
  }
  
</script>
<script type="text/temple" id="temple">
  <li areaid={areaid} onclick="changeprovince(this)">{cname}</li>
</script>
</body>
</html>
