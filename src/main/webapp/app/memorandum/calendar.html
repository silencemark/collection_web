<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>日历</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" >
<link type="text/css" rel="stylesheet" href="../appcssjs/style/public.css">
<link type="text/css" rel="stylesheet" href="../appcssjs/style/memo.css">
<script type="text/javascript" src="../appcssjs/script/jquery-1.10.2.min.js"></script>
<link rel="stylesheet" href="../appcssjs/sweetalert/dist/sweetalert.css">
<script src="../appcssjs/sweetalert/dist/sweetalert-dev.js"></script>  
<script type="text/javascript" src="../appcssjs/script/tab.js"></script>
<script type="text/javascript" src="../appcssjs/script/page.js"></script>

<script type="text/javascript" src="../appcssjs/script/appendjs.js"></script>
<script type="text/javascript" src="../appcssjs/script/cache.js"></script>
<script type="text/javascript" src="../appcssjs/script/constant.js"></script>
<link rel="stylesheet" href="../appcssjs/style/calendar.css">

<style type="text/css">
a {
	text-decoration: none;
}
ul, ol, li {
	list-style: none;
	padding: 0;
	margin: 0;
}
#demo {
	width: 100%;
	margin: auto;
	background: white;
}
p {
	margin: 0;
}
#dt {
	margin: 30px auto;
	height: 28px;
	width: 200px;
	padding: 0 6px;
	border: 1px solid #ccc;
	outline: none;
}
</style>
<script type="text/javascript">
var date1= getUrlParam("datetime");
if(date1=="null" || date1 ==''){
	date1=null;
}
var userInfo;
JianKangCache.getGlobalData('userinfo',function(data){
		userInfo=data;
})
var timestr="";
var yearmonth="";
function onloadData(datetime){
	if(datetime != null && datetime != ''){
		timestr=datetime;
	}else{
		datetime="";
	}
	$.ajax({
		type:'post',
		dataType:'json',
		url:projectpath+'/app/getMemorandumList?companyid='+userInfo.companyid+'&createid='+userInfo.userid+'&datetime='+datetime,
		success:function(data){
			if(data.memorandumlist.length > 0){
				var temp="";
				for(var i=0;i<data.memorandumlist.length;i++){
					temp+="<li  onclick=\"location.href=\'meno_detail.html?memorandumid="+data.memorandumlist[i].memorandumid+"&datetime="+timestr+"\'\"><div class=\"point\"></div><i>"+data.memorandumlist[i].hourtime+"</i><span class=\"word_hidden\">"+data.memorandumlist[i].content+"</span></li>";
				}
				$('#memoul').html(temp);
			}else{
				$('#memoul').html("");
			}
			yearmonth=data.yearmonth;
		}
	})
	//加载所有的红点
	$.ajax({
		type:'post',
		dataType:'json',
		url:projectpath+'/app/getAllMemorandumTime?companyid='+userInfo.companyid+'&createid='+userInfo.userid,
		success:function(data){
				$('#ca').calendar({
			        width: 320,
			        height: 350,
			        data: data.timelist,
			        onSelected: function (view, date, data) {
			            onloadData(date.format('yyyy-mm-dd'));
			        }
			    });

			    $('#dd').calendar({
			        trigger: '#dt',
			        zIndex: 999,
					format: 'yyyy-mm-dd',
			        onSelected: function (view, date, data) {
			            console.log('event: onSelected')
			        },
			        onClose: function (view, date, data) {
			            console.log('event: onClose')
			            console.log('view:' + view)
			            console.log('date:' + date)
			            console.log('data:' + (data || 'None'));
			        }
			    });
		}
	})
	
	
}
PageHelper({
	url:projectpath+'/app/getMemorandumList?companyid='+userInfo.companyid+'&createid='+userInfo.userid+'&datetime='+timestr,
	success:function(data){
		if(data.memorandumlist.length > 0){
			var temp="";
			for(var i=0;i<data.memorandumlist.length;i++){
				temp+="<li  onclick=\"location.href=\'meno_detail.html?memorandumid="+data.memorandumlist[i].memorandumid+"&datetime="+timestr+"\'\"><div class=\"point\"></div><i>"+data.memorandumlist[i].hourtime+"</i><span class=\"word_hidden\">"+data.memorandumlist[i].content+"</span></li>";
			}
			$('#memoul').append(temp);
		}
	}
});
</script>
</head>

<body onload="onloadData(date1);">
<div class="head_box">
	<a class="ico_back" onclick="location.href='memorandum_index.html'">返回</a>
    <div class="name">备忘录</div>
</div>
<div class="head_none"></div>
	<div id="demo">
	  <div id="ca" style="height:390px;"></div>
	</div>
<div class="memo_list">
	<div class="name">
    	<span>我的安排</span>
        <a onclick="location.href='meno_add.html?datetime='+timestr;">添加</a>
    </div>
    <div class="li_list" style="padding: 10px 15px 16px 18px">
    	<div class="ul_head"></div>
    	<ul id="memoul">

        </ul>        
        <div class="ul_foot"></div>
    </div>
</div>
<script src="../appcssjs/script/jquery.js"></script> 
<script src="../appcssjs/script/calendar.js"></script> 
</body>
</html>
